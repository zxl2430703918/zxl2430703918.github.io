

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="1. 权限管理及文本编辑工具1.1. 默认权限管理1.1.1. umask 值用来保留在创建文件或目录的权限 新建文件和目录默认权限  新建文件默认权限：666-umask，如果所得结果某位存在执行（奇数）权限，则将其权限+1,偶数不变。  新建目录的默认权限: 777-umask    用户默认权限  非特权用户umask默认是 002 root的umask 默认是 022   选项 12345">
<meta property="og:type" content="article">
<meta property="og:title" content="第二周作业">
<meta property="og:url" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/index.html">
<meta property="og:site_name" content="5-12 23:30">
<meta property="og:description" content="1. 权限管理及文本编辑工具1.1. 默认权限管理1.1.1. umask 值用来保留在创建文件或目录的权限 新建文件和目录默认权限  新建文件默认权限：666-umask，如果所得结果某位存在执行（奇数）权限，则将其权限+1,偶数不变。  新建目录的默认权限: 777-umask    用户默认权限  非特权用户umask默认是 002 root的umask 默认是 022   选项 12345">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdn.net/20171117235553427">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220807121025252.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808133324301.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808211858098.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808214705263.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808220000419.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808194202831.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808194327241.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808194419858.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808194838522.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808195159631.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808202630521.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204528987.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204519244.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204506716.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204455966.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204332052.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204444295.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204627603.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204707557.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204750255.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808204844236.png">
<meta property="og:image" content="http://example.com/2022/08/04/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20220808205033306.png">
<meta property="article:published_time" content="2022-08-04T09:03:47.000Z">
<meta property="article:modified_time" content="2022-08-08T16:13:35.956Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img-blog.csdn.net/20171117235553427">
  
  
  <title>第二周作业 - 5-12 23:30</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="第二周作业">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-08-04 09:03" pubdate>
        August 4, 2022 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      87k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      725 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">第二周作业</h1>
            
            <div class="markdown-body">
              <h1 id="1-权限管理及文本编辑工具"><a href="#1-权限管理及文本编辑工具" class="headerlink" title="1. 权限管理及文本编辑工具"></a>1. 权限管理及文本编辑工具</h1><h2 id="1-1-默认权限管理"><a href="#1-1-默认权限管理" class="headerlink" title="1.1. 默认权限管理"></a>1.1. 默认权限管理</h2><h3 id="1-1-1-umask-值用来保留在创建文件或目录的权限"><a href="#1-1-1-umask-值用来保留在创建文件或目录的权限" class="headerlink" title="1.1.1. umask 值用来保留在创建文件或目录的权限"></a>1.1.1. umask 值用来保留在创建文件或目录的权限</h3><ul>
<li><p>新建文件和目录默认权限</p>
<ul>
<li><p>新建文件默认权限：666-umask，如果所得结果某位存在执行（奇数）权限，则将其权限+1,偶数不变。</p>
</li>
<li><p>新建目录的默认权限: 777-umask</p>
</li>
</ul>
</li>
<li><p>用户默认权限</p>
<ul>
<li>非特权用户umask默认是 002</li>
<li>root的umask 默认是 022</li>
</ul>
</li>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs http">umask<br>#模式方式显示<br>umask –S<br>#输出可被调用<br>umask –p<br></code></pre></td></tr></table></figure></li>
<li><p>用法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#查询umask的值</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask </span><br>0022<br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask -p</span><br><span class="hljs-built_in">umask</span> 0044<br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask -S</span><br>u=rwx,g=wx,o=wx<br><br><span class="hljs-comment">#umask值022新建文件和目录默认权限</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask </span><br>0022<br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># ls</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># touch file</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># mkdir dir</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># ll</span><br>总用量 0<br>drwxr-xr-x. 2 root root 6 8月   4 09:42 <span class="hljs-built_in">dir</span><br>-rw-r--r--. 1 root root 0 8月   4 09:42 file<br><br><span class="hljs-comment">#修改 umask的值</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask -S 044</span><br>u=rwx,g=wx,o=wx<br><br><span class="hljs-comment">#umask值044新建文件和目录默认权限</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># umask </span><br>0044<br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># touch file02</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># mkdir dir02</span><br>[root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment"># ll</span><br>总用量 0<br>drwxr-xr-x. 2 root root 6 8月   4 09:42 <span class="hljs-built_in">dir</span><br>drwx-wx-wx. 2 root root 6 8月   4 09:43 dir02<br>-rw-r--r--. 1 root root 0 8月   4 09:42 file<br>-rw--w--w-. 1 root root 0 8月   4 09:43 file02<br><br><br><span class="hljs-comment">#umask一次性临时修改值，新建文件默认权限</span><br>[10:47:06 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#umask </span><br>0044<br>[10:47:19 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#(umask 066;touch file03 ; mkdir dir03)</span><br>[10:48:01 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#umask </span><br>0044<br>[10:48:18 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 0<br>drwx--x--x. 2 root root 6 8月   4 10:48 dir03<br>-rw-------. 1 root root 0 8月   4 10:48 file03<br><br><br></code></pre></td></tr></table></figure></li>
<li><p>永久保存umask</p>
<ul>
<li><p>全局设置： /etc/bashrc</p>
</li>
<li><p>用户设置：~/.bashrc</p>
</li>
</ul>
</li>
</ul>
<h2 id="1-2-特殊权限和属性及ACL"><a href="#1-2-特殊权限和属性及ACL" class="headerlink" title="1.2. 特殊权限和属性及ACL"></a>1.2. 特殊权限和属性及ACL</h2><ul>
<li>特殊权限：SUID, SGID, Sticky</li>
<li>特殊权限<ul>
<li>SUID 作用于二进制可执行文件上,用户将继承此程序所有者的权限</li>
<li>SGID<ul>
<li>作用于二进制可执行文件上,用户将继承此程序所有组的权限</li>
<li>作于于目录上, 此目录中新建的文件的所属组将自动从此目录继承</li>
</ul>
</li>
<li>STICKY 作用于目录上,此目录中的文件只能由所有者自已来删除</li>
</ul>
</li>
</ul>
<h3 id="1-2-1-特殊权限SUID"><a href="#1-2-1-特殊权限SUID" class="headerlink" title="1.2.1. 特殊权限SUID"></a>1.2.1. 特殊权限SUID</h3><ul>
<li><p>前提：进程有属主和属组；文件有属主和属组</p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程,取决发起者对程序文件是否拥有执行权限</li>
<li>启动为进程之后，其进程的属主为发起者,进程的属组为发起者所属的组</li>
<li>进程访问文件时的权限，取决于进程的发起者</li>
</ul>
</li>
<li><p>二进制的可执行文件上SUID权限功能：</p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程：取决发起者对程序文件是否拥有执行权限</li>
<li>启动为进程之后，其进程的属主为原程序文件的属主</li>
<li>SUID只对二进制可执行程序有效</li>
<li>SUID设置在目录上无意义</li>
</ul>
</li>
<li><p>SUID权限设定：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">chmod u+s FILE...<br>chmod 4xxx FILE<br>chmod u-s FILE...<br></code></pre></td></tr></table></figure></li>
<li><p>用法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">[11:14:29 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 36<br>-rwxr-xr-x. 1 root root 33600 8月   4 11:11 passwd<br><br>[11:14:33 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#chmod u+s passwd </span><br>[11:15:00 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 36<br>-rwsr-xr-x. 1 root root 33600 8月   4 11:11 passwd<br><br>[11:15:02 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#chmod u-s passwd </span><br>[11:15:37 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 36<br>-rwxr-xr-x. 1 root root 33600 8月   4 11:11 passwd<br><br>[11:15:40 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#chmod 4777 passwd </span><br>[11:16:04 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 36<br>-rwsrwxrwx. 1 root root 33600 8月   4 11:11 passwd<br><br>[11:16:28 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#chmod 0755 passwd </span><br>[11:16:35 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll</span><br>总用量 36<br>-rwxr-xr-x. 1 root root 33600 8月   4 11:11 passwd<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-2-2-特殊权限SGID"><a href="#1-2-2-特殊权限SGID" class="headerlink" title="1.2.2. 特殊权限SGID"></a>1.2.2. 特殊权限SGID</h3><ul>
<li><p>二进制的可执行文件上SGID权限功能：</p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程：取决发起者对程序文件是否拥有执行权限</li>
<li>启动为进程之后，其进程的属组为原程序文件的属组</li>
</ul>
</li>
<li><p>SGID权限设定：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">chmod g+s FILE...<br>chmod 2xxx FILE<br>chmod g-s FILE...<br></code></pre></td></tr></table></figure></li>
<li><p>目录上的SGID权限功能</p>
<p>默认情况下，用户创建文件时，其属组为此用户所属的主组，一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件所属的组为此目录的属组，通常用于创建一个协作目录</p>
</li>
<li><p>SGID权限设定：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">chmod g+s DIR...<br>chmod 2xxx DIR<br>chmod g-s DIR...<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-2-3-特殊权限-Sticky-位"><a href="#1-2-3-特殊权限-Sticky-位" class="headerlink" title="1.2.3. 特殊权限 Sticky 位"></a>1.2.3. 特殊权限 Sticky 位</h3><ul>
<li><p>权限说明：具有写权限的目录通常用户可以删除该目录中的任何文件，无论该文件的权限或拥有权<br>在目录设置Sticky 位，只有文件的所有者或root可以删除该文件<br>sticky 设置在文件上无意义。</p>
</li>
<li><p>Sticky权限设定：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">chmod o+t DIR...<br>chmod 1xxx DIR<br>chmod o-t DIR...<br></code></pre></td></tr></table></figure></li>
<li><p>用法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh">[11:32:54 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#touch dir/file</span><br>[11:33:53 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll dir/file </span><br>-rw-r--r--. 1 root root 0 8月   4 11:33 <span class="hljs-built_in">dir</span>/file<br>[11:34:00 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#chmod 777 dir/file </span><br>[11:34:48 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll dir/file </span><br>-rwxrwxrwx. 1 root root 0 8月   4 11:33 <span class="hljs-built_in">dir</span>/file<br>[11:34:58 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#su zxl</span><br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">rm</span> -fr <span class="hljs-built_in">dir</span>/file <br><span class="hljs-built_in">rm</span>: 无法删除<span class="hljs-string">&#x27;dir/file&#x27;</span>: 不允许的操作<br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">touch</span> <span class="hljs-built_in">dir</span>/file_zxl<br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ ll <span class="hljs-built_in">dir</span>/*<br>-rwxrwxrwx. 1 root root 0 8月   4 11:33 <span class="hljs-built_in">dir</span>/file<br>-rw-rw-r--. 1 zxl  zxl  0 8月   4 11:35 <span class="hljs-built_in">dir</span>/file_zxl<br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>[11:37:57 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#rm rf dir/filez_zxl</span><br><span class="hljs-built_in">rm</span>: 无法删除<span class="hljs-string">&#x27;rf&#x27;</span>: 没有那个文件或目录<br><span class="hljs-built_in">rm</span>: 无法删除<span class="hljs-string">&#x27;dir/filez_zxl&#x27;</span>: 没有那个文件或目录<br>[11:38:32 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ls dir/</span><br>file  file_zxl<br>[11:38:47 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#rm dir/file_zxl</span><br><span class="hljs-built_in">rm</span>：是否删除普通空文件 <span class="hljs-string">&#x27;dir/file_zxl&#x27;</span>？y<br>[11:39:53 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#ll dir/file </span><br>-rwxrwxrwx. 1 root root 0 8月   4 11:33 <span class="hljs-built_in">dir</span>/file<br>[11:40:32 root@localhost <span class="hljs-built_in">umask</span>]<span class="hljs-comment">#su zxl</span><br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">rm</span> -fr <span class="hljs-built_in">dir</span>/file <br><span class="hljs-built_in">rm</span>: 无法删除<span class="hljs-string">&#x27;dir/file&#x27;</span>: 不允许的操作<br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;写入文件内容&quot;</span> &gt; <span class="hljs-built_in">dir</span>/file <br>[zxl@localhost <span class="hljs-built_in">umask</span>]$ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">dir</span>/file <br>写入文件内容<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="1-3-文本编辑工具vim"><a href="#1-3-文本编辑工具vim" class="headerlink" title="1.3. 文本编辑工具vim"></a>1.3. 文本编辑工具vim</h2><p>vim是Linux或者类unix系统下非常实用的文本编辑处理工具。</p>
<p><img src="https://img-blog.csdn.net/20171117235553427" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><p>参考链接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://www.w3cschool.cn/vim/<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-1-vim-命令格式"><a href="#1-3-1-vim-命令格式" class="headerlink" title="1.3.1. vim 命令格式"></a>1.3.1. vim 命令格式</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">vim [<span class="hljs-keyword">OPTION</span>]... <span class="hljs-keyword">FILE</span>...<br></code></pre></td></tr></table></figure>

<ul>
<li><p>常用选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">+<span class="hljs-comment"># 打开文件后，让光标处于第#行的行首，+默认行尾</span><br>+/PATTERN 让光标处于第一个被PATTERN匹配到的行行首<br>-b file 二进制方式打开文件<br>-d file1 file2… 比较多个文件，相当于 vimdiff<br>-m file 只读打开文件<br>-e file 直接进入ex模式，相当于执行ex file<br>-y file Easy mode (like <span class="hljs-string">&quot;evim&quot;</span>, modeless)，直接可以操作文件，ctrl+o:wq|q! 保存和不<br>保存退出<br></code></pre></td></tr></table></figure></li>
<li><p>说明</p>
<ul>
<li>如果该文件存在，文件被打开并显示内容</li>
<li>如果该文件不存在，当编辑后第一次存盘时创建它</li>
</ul>
</li>
</ul>
<h3 id="1-3-2-三种主要模式和转换"><a href="#1-3-2-三种主要模式和转换" class="headerlink" title="1.3.2. 三种主要模式和转换"></a>1.3.2. 三种主要模式和转换</h3><p>vim 是 一个模式编辑器，击键行为是依赖于 vim的 的“模式”</p>
<ul>
<li><p>VIM四种常见模式：</p>
<ul>
<li>命令或普通(Normal)模式：默认模式，可以实现移动光标，剪切/粘贴文本</li>
<li>插入(Insert)或编辑模式：用于修改文本</li>
<li>扩展命令(extended command )或命令(末)行模式：保存，退出等</li>
<li>可视模式：在正常模式按下<code>v, V, &lt;Ctrl&gt;+v</code>，可以进入可视模式</li>
</ul>
</li>
<li><p>模式转换</p>
</li>
</ul>
<p><img src="image-20220807121025252.png" srcset="/img/loading.gif" lazyload alt="image-20220807121025252"></p>
<ul>
<li><p>命令模式 –&gt; 插入模式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">i insert, 在光标所在处输入<br>I 在当前光标所在行的行首输入<br>a append, 在光标所在处后面输入<br>A 在当前光标所在行的行尾输入<br>o 在当前光标所在行的下方打开一个新行<br>O 在当前光标所在行的上方打开一个新行<br></code></pre></td></tr></table></figure></li>
<li><p>插入模式 — ESC—–&gt; 命令模式<br>命令模式 —- : —-&gt; 扩展命令模式<br>扩展命令模式 —-ESC,enter—-&gt; 命令模式</p>
</li>
<li><p>案例: 插入颜色字符</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">1 切换至插入模式<br>2 按ctrl+v+[ 三个键,显示^[<br>3 后续输入颜色信息,如:^[[32mhello^[[0m<br>4 切换至扩展命令模式,保存退出<br>5 cat 文件可以看到下面显示<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-3-扩展命令模式"><a href="#1-3-3-扩展命令模式" class="headerlink" title="1.3.3. 扩展命令模式"></a>1.3.3. 扩展命令模式</h3><p>按“:”进入Ex模式 ，创建一个命令提示符: 处于底部的屏幕左侧</p>
<ul>
<li><p>扩展命令模式基本命令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http">w 写（存）磁盘文件<br>wq 写入并退出<br>x 写入并退出<br>X 加密<br>q 退出<br>q！ 不存盘退出，即使更改都将丢失<br>r filename 读文件内容到当前文件中<br>w filename 将当前文件内容写入另一个文件<br>!command 执行命令<br>r!command 读入命令的输出<br></code></pre></td></tr></table></figure></li>
<li><p>地址定界</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">:start_pos,end_pos CMD<br></code></pre></td></tr></table></figure>
<ul>
<li><p>地址定界格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"># #具体第#行，例如2表示第2行<br>#,# #从左侧#表示起始行，到右侧#表示结尾行<br>#,+# #从左侧#表示的起始行，加上右侧#表示的行数，范例：2,+3 表示2到5行<br>. #当前行<br>$ #最后一行<br>.,$-1 #当前行到倒数第二行<br>% #全文, 相当于1,$<br>/pattern/ #从当前行向下查找，直到匹配pattern的第一行,即:正则表达式<br>/pat1/,/pat2/ #从第一次被pat1模式匹配到的行开始，一直到第一次被pat2匹配到的行结束<br>#,/pat/ #从指定行开始，一直找到第一个匹配pattern的行结束<br>/pat/,$ #向下找到第一个匹配patttern的行到整个文件的结尾的所有行<br></code></pre></td></tr></table></figure></li>
<li><p>地址定界后跟一个编辑命令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">d #删除<br>y #复制<br>w file #将范围内的行另存至指定文件中<br>r file #在指定位置插入指定文件中的所有内容<br>t#行号 将前面指定的行复制到#行后<br>m#行号 将前面指定的行移动到#行后<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>查找并替换</p>
<ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">%s/要查找的内容/替换为的内容/修饰符<br></code></pre></td></tr></table></figure></li>
<li><p>说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">要查找的内容：可使用基本正则表达式模式<br>替换为的内容：不能使用模式，但可以使用\1, \2, ...等后向引用符号；还可以使用“&amp;”引用前面查找时查找到的整个内容<br></code></pre></td></tr></table></figure></li>
<li><p>修饰符</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">i #忽略大小写<br>g #全局替换，默认情况下，每一行只替换第一次出现<br>gc #全局替换，每次替换前询问<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">[12:33:09 root@localhost ~]<span class="hljs-comment">#cat f1</span><br>abc<br>123<br>qqq<br>ccc<br>[12:33:16 root@localhost ~]<span class="hljs-comment">#vim f1</span><br>:%s<span class="hljs-comment">#123#6#g</span><br>[12:40:22 root@localhost ~]<span class="hljs-comment">#cat f1</span><br>abc<br>6<br>qqq<br>ccc<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>定制vim的工作特性</p>
<p>扩展命令模式的配置只是对当前vim进程有效，可将配置存放在文件中持久保存</p>
<ul>
<li><p>配置文件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">/etc/vimrc #全局<br>~/.vimrc #个人<br></code></pre></td></tr></table></figure></li>
<li><p>行号</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">显示：set number，简写 set nu<br>取消显示：set nonumber, 简写 set nonu<br></code></pre></td></tr></table></figure></li>
<li><p>忽略字符的大小写</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set ignorecase，简写 set ic<br>不忽略：set noic<br></code></pre></td></tr></table></figure></li>
<li><p>自动缩进</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set autoindent，简写 set ai<br>禁用：set noai<br></code></pre></td></tr></table></figure></li>
<li><p>复制保留格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set paste<br>禁用：set nopaste<br></code></pre></td></tr></table></figure></li>
<li><p>显示Tab ^I和换行符 和$显示</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set list<br>禁用：set nolist<br></code></pre></td></tr></table></figure></li>
<li><p>高亮搜索</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set hlsearch<br>禁用：set nohlsearch 简写：nohl<br></code></pre></td></tr></table></figure></li>
<li><p>语法高亮</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：syntax on<br>禁用：syntax off<br></code></pre></td></tr></table></figure></li>
<li><p>文件格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">启用windows格式：set fileformat=dos<br>启用unix格式：set fileformat=unix<br>简写 set ff=dos|unix<br></code></pre></td></tr></table></figure></li>
<li><p>Tab 用空格代替</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set expandtab 默认为8个空格代替Tab<br>禁用：set noexpandtab<br>简写：set et<br></code></pre></td></tr></table></figure></li>
<li><p>Tab用指定空格的个数代替</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set tabstop=# 指定#个空格代替Tab<br>简写：set ts=4<br></code></pre></td></tr></table></figure></li>
<li><p>设置缩进宽度</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">#向右缩进 命令模式&gt;&gt;<br>#向左缩进 命令模式&lt;&lt;<br>#设置缩进为4个字符<br>set shiftwidth=4<br></code></pre></td></tr></table></figure></li>
<li><p>设置文本宽度</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">set textwidth=65 (vim only) #从左向右计数<br>set wrapmargin=15 #从右到左计数<br></code></pre></td></tr></table></figure></li>
<li><p>设置光标所在行的标识线</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用：set cursorline，简写 set cul<br>禁用：set nocursorline<br></code></pre></td></tr></table></figure></li>
<li><p>加密</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">启用： set key=password<br>禁用： set key=<br></code></pre></td></tr></table></figure></li>
<li><p>set 帮助</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">:help option-list<br>:set or :set all<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="1-3-4-命令模式"><a href="#1-3-4-命令模式" class="headerlink" title="1.3.4. 命令模式"></a>1.3.4. 命令模式</h3><p>命令模式，又称为Normal模式，功能强大，只是此模式输入指令并在屏幕上显示，所以需要记忆大量<br>的快捷按键才能更好的使用</p>
<ul>
<li><p>退出VIM</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">ZZ 保存退出<br>ZQ 不保存退出<br></code></pre></td></tr></table></figure></li>
<li><p>光标跳转</p>
<ul>
<li><p>字符间跳转</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">h</span><span class="hljs-punctuation">: </span>左<br><span class="hljs-attribute">L</span><span class="hljs-punctuation">: </span>右<br><span class="hljs-attribute">j</span><span class="hljs-punctuation">: </span>下<br><span class="hljs-attribute">k</span><span class="hljs-punctuation">: </span>上<br>#COMMAND：跳转由#指定的个数的字符<br></code></pre></td></tr></table></figure></li>
<li><p>单词间跳转</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">w：下一个单词的词首<br>e：当前或下一单词的词尾<br>b：当前或前一个单词的词首<br>#COMMAND：由#指定一次跳转的单词数<br></code></pre></td></tr></table></figure></li>
<li><p>当前页跳转</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">H：页首<br>M：页中间行<br>L：页底<br>zt：将光标所在当前行移到屏幕顶端<br>zz：将光标所在当前行移到屏幕中间<br>zb：将光标所在当前行移到屏幕底端<br></code></pre></td></tr></table></figure></li>
<li><p>行首行尾跳转</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">^ 跳转至行首的第一个非空白字符<br>0 跳转至行首<br>$ 跳转至行尾<br></code></pre></td></tr></table></figure></li>
<li><p>行间移动</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">#G 或者扩展命令模式下<br>:# 跳转至由第#行<br>G 最后一行<br>1G, gg 第一行<br></code></pre></td></tr></table></figure></li>
<li><p>句间移动</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">) 下一句<br>( 上一句<br></code></pre></td></tr></table></figure></li>
<li><p>命令模式翻屏操作</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">Ctrl+f 向文件尾部翻一屏,相当于Pagedown<br>Ctrl+b 向文件首部翻一屏,相当于Pageup<br>Ctrl+d 向文件尾部翻半屏<br>Ctrl+u 向文件首部翻半屏<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>字符编辑</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">x 剪切光标处的字符<br>#x 剪切光标处起始的#个字符<br>xp 交换光标所在处的字符及其后面字符的位置<br>~ 转换大小写<br>J 删除当前行后的换行符<br></code></pre></td></tr></table></figure></li>
<li><p>替换命令(replace)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">r 只替换光标所在处的一个字符<br>R 切换成REPLACE模式（在末行出现-- REPLACE -- 提示）,按ESC回到命令模式<br></code></pre></td></tr></table></figure></li>
<li><p>删除命令(delete)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http">d 删除命令，可结合光标跳转字符，实现范围删除<br>d$ 删除到行尾<br>d^ 删除到非空行首<br>d0 删除到行首<br>dw<br>de<br>db<br>#COMMAND<br>dd： 剪切光标所在的行<br>#dd 多行删除<br>D：从当前光标位置一直删除到行尾，等同于d$<br></code></pre></td></tr></table></figure></li>
<li><p>复制命令(yank)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http">y 复制，行为相似于d命令<br>y$<br>y0<br>y^<br>ye<br>yw<br>yb<br>#COMMAND<br>yy：复制行<br>#yy 复制多行<br>Y：复制整行<br></code></pre></td></tr></table></figure></li>
<li><p>粘贴命令(paste)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http">c$<br>c^<br>c0<br>cb<br>ce<br>cw<br>#COMMAND<br>cc #删除当前行并输入新内容，相当于S<br>#cc<br>C #删除当前光标到行尾，并切换成插入模式,相当于c$<br></code></pre></td></tr></table></figure></li>
<li><p>查找</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">/PATTERN：从当前光标所在处向文件尾部查找<br>?PATTERN：从当前光标所在处向文件首部查找<br>n：与命令同方向<br>N：与命令反方向<br></code></pre></td></tr></table></figure>

<ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[12:55:28 root@localhost ~]<span class="hljs-comment">#vim f1 </span><br>abc<br>6 <br>qqq<br>ccc<br><br>:/qqq<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>撤消更改</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">u 撤销最近的更改，相当于windows中ctrl+z<br>#u 撤销之前多次更改<br>U 撤消光标落在这行后所有此行的更改<br>Ctrl-r 重做最后的“撤消”更改，相当于windows中crtl+y<br>. 重复前一个操作<br>#. 重复前一个操作#次<br></code></pre></td></tr></table></figure></li>
<li><p>高级用法</p>
<ul>
<li><p>常见Command：y 复制、d 删除、gU 变大写、gu 变小写</p>
</li>
<li><p>范例</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">0y$ 命令<br>0 → 先到行头<br>y → 从这里开始拷贝<br>$ → 拷贝到本行最后一个字符<br></code></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">di&quot; 光标在” “之间，则删除” “之间的内容<br>yi( 光标在()之间，则复制()之间的内容<br>vi[ 光标在[]之间，则选中[]之间的内容<br>dtx 删除字符直到遇见光标之后的第一个 x 字符<br>ytx 复制字符直到遇见光标之后的第一个 x 字符<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="1-3-5-可视化模式"><a href="#1-3-5-可视化模式" class="headerlink" title="1.3.5. 可视化模式"></a>1.3.5. 可视化模式</h3><ul>
<li><p>说明</p>
<ul>
<li>在末行有”– VISUAL – “指示，表示在可视化模式</li>
<li>可视化键可用于与移动键结合使用</li>
<li>w ) } 箭头等突出显示的文字可被删除，复制，变更，过滤，搜索，替换等</li>
</ul>
</li>
<li><p>允许选择的文本块</p>
<ul>
<li>v 面向字符，– VISUAL –</li>
<li>V 面向整行，– VISUAL LINE –</li>
<li>ctrl-v 面向块，– VISUAL BLOCK –</li>
</ul>
</li>
<li><p>案例1：在文件指定行的行首插入#</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">1、先将光标移动到指定的第一行的行首<br>2、输入ctrl+v 进入可视化模式<br>3、向下移动光标，选中希望操作的每一行的第一个字符<br>4、输入大写字母 I 切换至插入模式<br>5、输入 #<br>6、按 ESC 键<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：在指定的块位置插入相同的内容</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">1、光标定位到要操作的地方<br>2、CTRL+v 进入“可视块”模式，选取这一列操作多少行<br>3、SHIFT+i(I)<br>4、输入要插入的内容<br>5、按 ESC 键<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-6-多文件模式"><a href="#1-3-6-多文件模式" class="headerlink" title="1.3.6. 多文件模式"></a>1.3.6. 多文件模式</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">vim FILE1 FILE2 FILE3 ...<br>:next 下一个<br>:prev 前一个<br>:first 第一个<br>:last 最后一个<br>:wall 保存所有<br>:qall 不保存退出所有<br>:wqall保存退出所有<br></code></pre></td></tr></table></figure>

<h3 id="1-3-7-多窗口模式"><a href="#1-3-7-多窗口模式" class="headerlink" title="1.3.7. 多窗口模式"></a>1.3.7. 多窗口模式</h3><ul>
<li><p>多文件分割</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">vim -o|-O FILE1 FILE2 ...<br>-o: 水平或上下分割<br>-O: 垂直或左右分割（vim only）<br>在窗口间切换：Ctrl+w, Arrow<br></code></pre></td></tr></table></figure></li>
<li><p>单文件窗口分割</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">Ctrl+w,s：split, 水平分割，上下分屏<br>Ctrl+w,v：vertical, 垂直分割，左右分屏<br>ctrl+w,q：取消相邻窗口<br>ctrl+w,o：取消全部窗口<br>:wqall 退出<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-8-帮助"><a href="#1-3-8-帮助" class="headerlink" title="1.3.8. 帮助"></a>1.3.8. 帮助</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">:help<br>:help topic<br>Use :q to exit help<br>#vimtutor<br></code></pre></td></tr></table></figure>



<h2 id="1-4-文本处理工具"><a href="#1-4-文本处理工具" class="headerlink" title="1.4. 文本处理工具"></a>1.4. 文本处理工具</h2><h3 id="1-4-1-文件内容查看命令"><a href="#1-4-1-文件内容查看命令" class="headerlink" title="1.4.1. 文件内容查看命令"></a>1.4.1. 文件内容查看命令</h3><h4 id="1-4-1-1-cat-可以查看文本内容"><a href="#1-4-1-1-cat-可以查看文本内容" class="headerlink" title="1.4.1.1. cat:可以查看文本内容"></a>1.4.1.1. cat:可以查看文本内容</h4><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">cat [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>常见选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">-E：显示行结束符$<br>-A：显示所有控制符，等价于 -vET<br>-n：对显示出的每一行进行编号<br>-b：非空行编号<br>-s：压缩连续的空行成一行<br>-T 或 --show-tabs: 将 TAB 字符显示为 ^I。<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:16:35 root@localhost ~]<span class="hljs-comment">#cat -A cat.txt</span><br>dadsad $<br>adsddasd  ddd a $<br> 22323 $<br>[13:16:44 root@localhost ~]<span class="hljs-comment">#cat cat.txt</span><br>dadsad <br>adsddasd  ddd a <br> 22323 <br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-1-2-nl：显示行号，相当于cat-b"><a href="#1-4-1-2-nl：显示行号，相当于cat-b" class="headerlink" title="1.4.1.2. nl：显示行号，相当于cat -b"></a>1.4.1.2. nl：显示行号，相当于cat -b</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:16:44 root@localhost ~]<span class="hljs-comment">#cat cat.txt</span><br>dadsad <br>adsddasd  ddd a <br> 22323 <br>[13:16:49 root@localhost ~]<span class="hljs-comment">#nl cat.txt </span><br>     1	dadsad <br>     2	adsddasd  ddd a <br>     3	 22323 <br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-1-3-tac：逆向显示文本内容"><a href="#1-4-1-3-tac：逆向显示文本内容" class="headerlink" title="1.4.1.3. tac：逆向显示文本内容"></a>1.4.1.3. tac：逆向显示文本内容</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:19:55 root@localhost ~]<span class="hljs-comment">#cat cat.txt </span><br>dadsad <br>adsddasd  ddd a <br> 22323 <br>[13:20:48 root@localhost ~]<span class="hljs-comment">#tac cat.txt </span><br> 22323 <br>adsddasd  ddd a <br>dadsad <br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-1-4-rev：将同一行的内容逆向显示"><a href="#1-4-1-4-rev：将同一行的内容逆向显示" class="headerlink" title="1.4.1.4. rev：将同一行的内容逆向显示"></a>1.4.1.4. rev：将同一行的内容逆向显示</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:19:55 root@localhost ~]<span class="hljs-comment">#cat cat.txt </span><br>dadsad <br>adsddasd  ddd a <br> 22323<br>[13:21:59 root@localhost ~]<span class="hljs-comment">#rev cat.txt </span><br> dasdad<br> a ddd  dsaddsda<br> 32322 <br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-1-5-hexdump-查看非文本文件内容"><a href="#1-4-1-5-hexdump-查看非文本文件内容" class="headerlink" title="1.4.1.5. hexdump:查看非文本文件内容"></a>1.4.1.5. hexdump:查看非文本文件内容</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">hexdump -C -n 512 /dev/sda<br>00000000 eb 63 90 10 8e d0 bc 00 b0 b8 00 00 8e d8 8e c0 |.c..............|<br><span class="hljs-built_in">echo</span> &#123;a..z&#125; | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27; &#x27;</span>|hexdump -C<br>00000000 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 |abcdefghijklmnop|<br>00000010 71 72 73 74 75 76 77 78 79 7a 0a |qrstuvwxyz.|<br>0000001b<br></code></pre></td></tr></table></figure>

<h3 id="1-4-2-分页查看文件内容"><a href="#1-4-2-分页查看文件内容" class="headerlink" title="1.4.2. 分页查看文件内容"></a>1.4.2. 分页查看文件内容</h3><h4 id="1-4-2-1-more：可以实现分页查看文件，可以配合管道实现输出信息的分页"><a href="#1-4-2-1-more：可以实现分页查看文件，可以配合管道实现输出信息的分页" class="headerlink" title="1.4.2.1. more：可以实现分页查看文件，可以配合管道实现输出信息的分页"></a>1.4.2.1. more：可以实现分页查看文件，可以配合管道实现输出信息的分页</h4><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">more [OPTIONS...] FILE...<br></code></pre></td></tr></table></figure></li>
<li><p>选项：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-d: 显示翻页及退出提示</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-2-2-less：实现分页查看文件或STDIN输出，less-命令是man命令使用的分页器"><a href="#1-4-2-2-less：实现分页查看文件或STDIN输出，less-命令是man命令使用的分页器" class="headerlink" title="1.4.2.2. less：实现分页查看文件或STDIN输出，less 命令是man命令使用的分页器"></a>1.4.2.2. less：实现分页查看文件或STDIN输出，less 命令是man命令使用的分页器</h4><ul>
<li><p>查看时有用的命令包括</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">/文本 搜索 文本<br><span class="hljs-built_in">n</span>/<span class="hljs-built_in">N</span> 跳到下一个 或 上一个匹配<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:33:03 root@localhost ~]<span class="hljs-comment">#tree -d /etc |less</span><br>/etc<br>├── accountsservice<br>│   └── user-templates<br>├── alsa<br>│   └── conf.d<br>├── alternatives<br>│   ├── jre -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.312.b07-2.el8_5.x86_64/jre<br>│   ├── jre_1.8.0 -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.312.b07-2.el8_5.x86_64/jre<br>│   ├── jre_1.8.0_openjdk -&gt; /usr/lib/jvm/jre-1.8.0-openjdk-1.8.0.312.b07-2.el8_5.x86_64<br>│   └── jre_openjdk -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.312.b07-2.el8_5.x86_64/jre<br>├── anaconda<br>│   ├── conf.d<br>│   └── product.d<br>├── audit<br>│   ├── plugins.d<br>│   └── rules.d<br>├── authselect<br>│   └── custom<br>├── avahi<br>│   ├── etc<br>│   └── services<br>├── bash_completion.d<br>├── binfmt.d<br>├── bluetooth<br>├── brltty<br>│   ├── Attributes<br>│   ├── Contraction<br>│   ├── Input<br>│   │   ├── al<br>│   │   ├── at<br>│   │   ├── ba<br>│   │   ├── bd<br>│   │   ├── <span class="hljs-built_in">bg</span><br>│   │   ├── bl<br>│   │   ├── bm<br>:<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-4-3-显示文本前面或后面的行内容"><a href="#1-4-3-显示文本前面或后面的行内容" class="headerlink" title="1.4.3. 显示文本前面或后面的行内容"></a>1.4.3. 显示文本前面或后面的行内容</h3><h4 id="1-4-3-1-head：显示文件或标准输入的前面行"><a href="#1-4-3-1-head：显示文件或标准输入的前面行" class="headerlink" title="1.4.3.1. head：显示文件或标准输入的前面行"></a>1.4.3.1. head：显示文件或标准输入的前面行</h4><ul>
<li><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">head [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">-c # 指定获取前#字节<br>-n # 指定获取前#行,#如果为负数,表示从文件头取到倒数第#前，默认显示文件前10行<br>-v 显示文件名，默认不显示文件名<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:37:21 root@localhost ~]<span class="hljs-comment">#head -n 3  passwd </span><br>ROOT:x:0:0:ROOT:/ROOT:/bin/bash<br>bin:x:1:1:bin:/bin:/sbin/nologin<br>daemon:x:2:2:daemon:/sbin:/sbin/nologin<br><br><br>[13:38:48 root@localhost ~]<span class="hljs-comment">#head -n 3 -v  passwd </span><br>==&gt; passwd &lt;==<br>ROOT:x:0:0:ROOT:/ROOT:/bin/bash<br>bin:x:1:1:bin:/bin:/sbin/nologin<br>daemon:x:2:2:daemon:/sbin:/sbin/nologin<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-3-2-tail：tail-和head-相反，查看文件或标准输入的倒数行"><a href="#1-4-3-2-tail：tail-和head-相反，查看文件或标准输入的倒数行" class="headerlink" title="1.4.3.2. tail：tail 和head 相反，查看文件或标准输入的倒数行"></a>1.4.3.2. tail：tail 和head 相反，查看文件或标准输入的倒数行</h4><ul>
<li><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">tail [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">-c <span class="hljs-comment"># 指定获取后#字节</span><br>-n <span class="hljs-comment"># 指定获取后#行,如果#是负数,表示从第#行开始到文件结束</span><br>-<span class="hljs-comment"># 同上</span><br>-f 跟踪显示文件fd新追加的内容,常用日志监控，相当于 --follow=descriptor,当文件删除再新<br>建同名文件,将无法继续跟踪文件<br>-F 跟踪文件名，相当于--follow=name --retry，当文件删除再新建同名文件,将可以继续跟踪文<br>件<br>tailf 类似 <span class="hljs-built_in">tail</span> –f，当文件不增长时并不访问文件,节约资源,CentOS8已经无此工具<br>-v 显示详细的处理信息<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:42:15 root@localhost ~]<span class="hljs-comment">#tail -n 3  passwd </span><br>mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false<br>jira:x:1001:1001:Atlassian Jira:/home/jira:/bin/bash<br>apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin<br><br>[13:39:39 root@localhost ~]<span class="hljs-comment">#tail -n 3 -v  passwd </span><br>==&gt; passwd &lt;==<br>mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false<br>jira:x:1001:1001:Atlassian Jira:/home/jira:/bin/bash<br>apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-4-4-按列抽取文本-cut"><a href="#1-4-4-按列抽取文本-cut" class="headerlink" title="1.4.4. 按列抽取文本 cut"></a>1.4.4. 按列抽取文本 cut</h3><ul>
<li><p>说明：cut 命令可以提取文本文件或STDIN数据的指定列</p>
</li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">cut [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs clean">-d DELIMITER: 指明分隔符，默认tab<br>-f FILEDS:<br>        #: 第#个字段,例如:<span class="hljs-number">3</span><br>        #,#[,#]：离散的多个字段，例如:<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span><br>        #-#：连续的多个字段, 例如:<span class="hljs-number">1</span><span class="hljs-number">-6</span><br>        混合使用：<span class="hljs-number">1</span><span class="hljs-number">-3</span>,<span class="hljs-number">7</span><br>-c 按字符切割<br>--output-delimiter=STRING指定输出分隔符<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:47:56 root@localhost ~]<span class="hljs-comment">#head -n 3 passwd </span><br>ROOT:x:0:0:ROOT:/ROOT:/bin/bash<br>bin:x:1:1:bin:/bin:/sbin/nologin<br>daemon:x:2:2:daemon:/sbin:/sbin/nologin<br>[13:48:12 root@localhost ~]<span class="hljs-comment">#cut -d: -f1,3-4,7 passwd|head -n 3</span><br>ROOT:0:0:/bin/bash<br>bin:1:1:/sbin/nologin<br>daemon:2:2:/sbin/nologin<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：获取IP地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:50:52 root@localhost ~]<span class="hljs-comment">#ifconfig|sed -n &#x27;2p&#x27; |tr -s &quot; &quot;|cut -d&quot; &quot; -f3</span><br>192.168.100.30<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：获取内存信息大小</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#获取内存大小</span><br>[13:52:27 root@localhost ~]<span class="hljs-comment">#free -h|grep &#x27;^Mem&#x27;|tr -s &quot; &quot;|cut -d&quot; &quot; -f2</span><br>3.6Gi<br><span class="hljs-comment">#获取已使用内存</span><br>[13:58:36 root@localhost ~]<span class="hljs-comment">#free -h|grep &#x27;^Mem&#x27;|tr -s &quot; &quot;|cut -d&quot; &quot; -f3</span><br>2.9Gi<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例4：获取CPU核数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:55:02 root@localhost ~]<span class="hljs-comment">#lscpu|sed -n &#x27;4p&#x27;|tr -s &quot; &quot;|cut -d&quot; &quot; -f2</span><br>4<br></code></pre></td></tr></table></figure></li>
<li><p>案例5：获取硬盘大小</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:56:20 root@localhost ~]<span class="hljs-comment">#lsblk |grep &#x27;^sd&#x27;|tr -s &quot; &quot;|cut -d&quot; &quot; -f4</span><br>200G<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-4-5-paste：合并多个文件"><a href="#1-4-5-paste：合并多个文件" class="headerlink" title="1.4.5. paste：合并多个文件"></a>1.4.5. paste：合并多个文件</h3><ul>
<li><p>说明：paste 合并多个文件同行号的列到一行</p>
</li>
<li><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">paste [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">-d #分隔符：指定分隔符，默认用TAB<br>-s #所有行合成一行显示<br></code></pre></td></tr></table></figure></li>
<li><p>案例1：多文件输出合并显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#默认多文件内容合并为同一列</span><br>[14:19:03 root@localhost ~]<span class="hljs-comment">#cat f1</span><br>1<br>2<br>3<br>4<br>[14:19:19 root@localhost ~]<span class="hljs-comment">#cat f2</span><br>a<br>b<br>c<br>d<br>[14:19:20 root@localhost ~]<span class="hljs-comment">#paste f1 f2</span><br>1	a<br>2	b<br>3	c<br>4	d<br><br><span class="hljs-comment">#文件内容合并为同一行</span><br>[14:19:31 root@localhost ~]<span class="hljs-comment">#paste -s f1 f2</span><br>1	2	3	4<br>a	b	c	d<br><br><span class="hljs-comment">#指定分隔符</span><br>[14:26:36 root@localhost ~]<span class="hljs-comment">#paste -s -d&quot;+&quot; f1</span><br>1+2+3+4<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：批量修改密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[14:28:32 root@localhost ~]<span class="hljs-comment">#paste -d&quot;:&quot; user pass </span><br>wang1:123456<br>wang2:654321<br>wang3:123654<br>[14:28:39 root@localhost ~]<span class="hljs-comment">#useradd wang1</span><br>[14:29:07 root@localhost ~]<span class="hljs-comment">#useradd wang2</span><br>[14:29:09 root@localhost ~]<span class="hljs-comment">#useradd wang3</span><br>[14:29:13 root@localhost ~]<span class="hljs-comment">#paste -d&quot;:&quot; user pass |chpasswd </span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-4-6-分析文本的工具"><a href="#1-4-6-分析文本的工具" class="headerlink" title="1.4.6. 分析文本的工具"></a>1.4.6. 分析文本的工具</h3><ul>
<li>文本数据统计：wc</li>
<li>整理文本：sort</li>
<li>比较文件：diff和patch</li>
</ul>
<h4 id="1-4-6-1-wc：收集文本统计数据"><a href="#1-4-6-1-wc：收集文本统计数据" class="headerlink" title="1.4.6.1. wc：收集文本统计数据"></a>1.4.6.1. wc：收集文本统计数据</h4><ul>
<li><p>说明：wc 命令可用于统计文件的行总数、单词总数、字节总数和字符总数<br>可以对文件或STDIN中的数据统计</p>
</li>
<li><p>常用选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">-l 只计数行数<br>-w 只计数单词总数<br>-c 只计数字节总数<br>-m 只计数字符总数<br>-L 显示文件中最长行的长度<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[14:29:23 root@localhost ~]<span class="hljs-comment">#wc /etc/passwd</span><br>  52  113 2827 /etc/passwd<br>[14:32:10 root@localhost ~]<span class="hljs-comment">#wc -l /etc/passwd</span><br>52 /etc/passwd<br>[14:32:28 root@localhost ~]<span class="hljs-comment">#wc -w /etc/passwd</span><br>113 /etc/passwd<br>[14:32:37 root@localhost ~]<span class="hljs-comment">#wc -c /etc/passwd</span><br>2827 /etc/passwd<br>[14:32:48 root@localhost ~]<span class="hljs-comment">#wc -m /etc/passwd</span><br>2827 /etc/passwd<br><br><span class="hljs-comment">#通过管道符传递文件内容，可不显示文件名称</span><br>[14:32:58 root@localhost ~]<span class="hljs-comment">#cat /etc/passwd|wc -l</span><br>52<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-6-2-sort：文本排序"><a href="#1-4-6-2-sort：文本排序" class="headerlink" title="1.4.6.2. sort：文本排序"></a>1.4.6.2. sort：文本排序</h4><ul>
<li><p>说明：把整理过的文本显示在STDOUT，不改变原始文件</p>
</li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">sort [options] file(s)<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">-r 执行反方向（由上至下）整理<br>-R 随机排序<br>-n 执行按数字大小整理<br>-h 人类可读排序,如: 2K 1G<br>-f 选项忽略（fold）字符串中的字符大小写<br>-u 选项（独特，unique），合并重复项，即去重<br>-t c 选项使用c做为字段界定符<br>-k # 选项按照使用c字符分隔的 # 列来整理能够使用多次<br></code></pre></td></tr></table></figure></li>
<li><p>案例1:根据用户id进行大小排序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[14:34:29 root@localhost ~]<span class="hljs-comment">#cut -d: -f1,3 /etc/passwd|sort -t: -k2 -nr |head -n3</span><br>nobody:65534<br>wang3:1004<br>wang2:1003<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例2：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[14:37:06 root@localhost ~]<span class="hljs-comment">#df | tr -s &quot; &quot; %|cut -d% -f5|tr -d &#x27;[:alpha:]&#x27; | sort -nr|head -n1</span><br>100<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：统计日志访问量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 data]<span class="hljs-comment">#cut -d&quot; &quot; -f1 /var/log/nginx/access_log |sort -u|wc -l</span><br>201<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-6-3-去重-uniq"><a href="#1-4-6-3-去重-uniq" class="headerlink" title="1.4.6.3. 去重 uniq"></a>1.4.6.3. 去重 uniq</h4><ul>
<li><p>说明：uniq命令从输入中删除前后相接的重复的行</p>
</li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">uniq [OPTION]... [FILE]...<br></code></pre></td></tr></table></figure></li>
<li><p>常见选项</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-c: 显示每行重复出现的次数</span><br><span class="hljs-deletion">-d: 仅显示重复过的行</span><br><span class="hljs-deletion">-u: 仅显示不曾重复的行</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例1：uniq常和sort 命令一起配合使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">[14:55:09 root@localhost ~]<span class="hljs-comment">#cat f</span><br>192.168.100.1<br>192.168.100.2<br>192.168.100.10<br>10.55.66.20<br>10.66.77.50<br>192.168.100.1<br>192.168.100.2<br>192.168.100.2<br>[14:55:48 root@localhost ~]<span class="hljs-comment">#sort f|uniq  -c</span><br>      1 10.55.66.20<br>      1 10.66.77.50<br>      2 192.168.100.1<br>      1 192.168.100.10<br>      3 192.168.100.2<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例2：并发连接最多的远程主机IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[15:09:16 root@localhost ~]<span class="hljs-comment">#ss -nt|tail -n+2 |tr -s &#x27; &#x27; : |cut -d: -f6|sort|cut -d&quot;]&quot; -f1 |uniq -c|sort  -nr |head -n2</span><br>     74 127.0.0.1<br>     12 192.168.100.30<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：取两个文件的相同和不同的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 data]<span class="hljs-comment">#cat test1.txt</span><br>a<br>b<br>1<br>c<br>[root@centos8 data]<span class="hljs-comment">#cat test2.txt</span><br>b<br>e<br>f<br>c<br>1<br>2<br><span class="hljs-comment">#取文件的共同行</span><br>[root@centos8 data]<span class="hljs-comment">#cat test1.txt test2.txt | sort |uniq -d</span><br>1<br>b<br>c<br><span class="hljs-comment">#取文件的不同行</span><br>[root@centos8 data]<span class="hljs-comment">#cat test1.txt test2.txt | sort |uniq -u</span><br>2<br>a<br>e<br>f<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-4-7-比较文件"><a href="#1-4-7-比较文件" class="headerlink" title="1.4.7. 比较文件"></a>1.4.7. 比较文件</h3><h4 id="1-4-7-1-diff：比较两个文件之间的区别"><a href="#1-4-7-1-diff：比较两个文件之间的区别" class="headerlink" title="1.4.7.1. diff：比较两个文件之间的区别"></a>1.4.7.1. diff：比较两个文件之间的区别</h4><ul>
<li>```<br>-u 选项来输出“统一的（unified）”diff格式文件，最适用于补丁文件<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>  <br><br>- 案例<br><br>  ```sh<br>  <span class="hljs-selector-attr">[21:08:22 root@localhost ~]</span><span class="hljs-selector-id">#paste</span> a1 a2<br>  zhang	<span class="hljs-selector-tag">li</span><br>  wang	tian<br>  <span class="hljs-selector-tag">li</span>	    wang<br>  tian	wang<br>  <span class="hljs-selector-attr">[21:09:02 root@localhost ~]</span><span class="hljs-selector-id">#diff</span> a1 a2<br>  <span class="hljs-number">1</span>,<span class="hljs-number">2</span>d0<br>  &lt; zhang<br>  &lt; wang<br>  <span class="hljs-number">4</span>a3,<span class="hljs-number">4</span><br>  &gt; wang<br>  &gt; wang<br>  <br>  <span class="hljs-selector-attr">[21:09:10 root@localhost ~]</span><span class="hljs-selector-id">#diff</span> -u a1 a2<br>  --- a1	<span class="hljs-number">2022</span>-<span class="hljs-number">08</span>-<span class="hljs-number">07</span> <span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">15.551024796</span> +<span class="hljs-number">0800</span><br>  +++ a2	<span class="hljs-number">2022</span>-<span class="hljs-number">08</span>-<span class="hljs-number">07</span> <span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">30.452025537</span> +<span class="hljs-number">0800</span><br>  @@ -<span class="hljs-number">1</span>,<span class="hljs-number">4</span> +<span class="hljs-number">1</span>,<span class="hljs-number">4</span> @@<br>  -zhang<br>  -wang<br>   <span class="hljs-selector-tag">li</span><br>   tian<br>  +wang<br>  +wang<br>  <br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-7-2-patch：复制在其它文件中进行的改变（要谨慎使用）"><a href="#1-4-7-2-patch：复制在其它文件中进行的改变（要谨慎使用）" class="headerlink" title="1.4.7.2. patch：复制在其它文件中进行的改变（要谨慎使用）"></a>1.4.7.2. patch：复制在其它文件中进行的改变（要谨慎使用）</h4><ul>
<li><p>选项</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">-<span class="hljs-keyword">b</span> 选项来自动备份改变了的文件<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">[21:20:16 root@localhost ~]<span class="hljs-comment">#paste a1 a2 </span><br>zhang	li<br>wang	tian<br>li		wang<br>tian	wang<br>li	<br>[21:21:02 root@localhost ~]<span class="hljs-comment">#diff -u a1 a2 &gt; a3</span><br>[21:21:11 root@localhost ~]<span class="hljs-comment">#cat a3</span><br>--- a1	2022-08-07 21:20:16.801063657 +0800<br>+++ a2	2022-08-07 21:07:30.452025537 +0800<br>@@ -1,5 +1,4 @@<br>-zhang<br>-wang<br> li<br> tian<br>-li<br>+wang<br>+wang<br>[21:21:13 root@localhost ~]<span class="hljs-comment">#patch -b a1 a3</span><br>patching file a1<br>[21:21:35 root@localhost ~]<span class="hljs-comment">#paste a1 a2</span><br>li		li<br>tian	tian<br>wang	wang<br>wang	wang<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-7-3-vimdiff：相当于-vim-d"><a href="#1-4-7-3-vimdiff：相当于-vim-d" class="headerlink" title="1.4.7.3. vimdiff：相当于 vim -d"></a>1.4.7.3. vimdiff：相当于 vim -d</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">[21:24:02 root@localhost ~]<span class="hljs-comment">#paste f1 f2</span><br>1	a<br>2	b<br>3	c<br>4	d<br>[21:24:20 root@localhost ~]<span class="hljs-comment">#which vimdiff </span><br>/usr/bin/vimdiff<br>[21:25:26 root@localhost ~]<span class="hljs-comment">#ll /usr/bin/vimdiff</span><br>lrwxrwxrwx. 1 root root 3 9月  22 2021 /usr/bin/vimdiff -&gt; vim<br>[21:25:47 root@localhost ~]<span class="hljs-comment">#vimdiff f1 f2</span><br>还有 2 个文件等待编辑<br><br>  1                                            |  a                                           <br>  2                                            |  b                                           <br>  3                                            |  c                                           <br>  4                                            |  d  <br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-7-4-cmp：查看二进制文件的不同"><a href="#1-4-7-4-cmp：查看二进制文件的不同" class="headerlink" title="1.4.7.4. cmp：查看二进制文件的不同"></a>1.4.7.4. cmp：查看二进制文件的不同</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">[21:28:22 root@localhost ~]<span class="hljs-comment">#ll /usr/bin/dir /usr/bin/ls</span><br>-rwxr-xr-x. 1 root root 143224 7月  14 2021 /usr/bin/dir<br>-rwxr-xr-x. 1 root root 143224 7月  14 2021 /usr/bin/ls<br>[21:29:01 root@localhost ~]<span class="hljs-comment">#ll /usr/bin/dir /usr/bin/ls -i</span><br>625637 -rwxr-xr-x. 1 root root 143224 7月  14 2021 /usr/bin/dir<br>625658 -rwxr-xr-x. 1 root root 143224 7月  14 2021 /usr/bin/ls<br>[21:29:32 root@localhost ~]<span class="hljs-comment">#diff /usr/bin/dir /usr/bin/ls</span><br>二进制文件 /usr/bin/dir 和 /usr/bin/ls 不同<br>[21:30:20 root@localhost ~]<span class="hljs-comment">#cmp /usr/bin/dir /usr/bin/ls</span><br>/usr/bin/dir /usr/bin/ls 不同：第 793 字节，第 1 行<br>[21:30:33 root@localhost ~]<span class="hljs-comment">#hexdump -s 790 -Cn 30 //usr/bin/dir</span><br>00000316  55 00 4a af b0 1d 71 42  b6 e7 e0 fe 2e e5 7d fa  |U.J...qB......&#125;.|<br>00000326  e7 5a 3c f5 86 8e 00 00  00 00 03 00 00 00        |.Z&lt;...........|<br>00000334<br>[21:32:05 root@localhost ~]<span class="hljs-comment">#hexdump -s 790 -Cn 30 //usr/bin/ls</span><br>00000316  55 00 bc cb 4c 17 51 6c  6a 9a d5 9c 3e c1 9b 34  |U...L.Qlj...&gt;..4|<br>00000326  7c 83 23 6c 04 c2 00 00  00 00 03 00 00 00        ||.<span class="hljs-comment">#l..........|</span><br>00000334<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="2-正则表达式和相关工具及文件查找压缩"><a href="#2-正则表达式和相关工具及文件查找压缩" class="headerlink" title="2. 正则表达式和相关工具及文件查找压缩"></a>2. 正则表达式和相关工具及文件查找压缩</h1><h2 id="2-1-文本处理三剑客之grep"><a href="#2-1-文本处理三剑客之grep" class="headerlink" title="2.1. 文本处理三剑客之grep"></a>2.1. 文本处理三剑客之grep</h2><ul>
<li><p>说明：</p>
<ul>
<li><p>grep: Global search REgular expression and Print out the line</p>
</li>
<li><p>作用：文本搜索工具，根据用户指定的“模式”对目标文本逐行进行匹配检查；打印匹配到的行</p>
</li>
<li><p>模式：由正则表达式字符及文本字符所编写的过滤条件<br>帮助</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://man7.org/linux/man-pages/man1/grep.1.html<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>格式：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">grep</span> [<span class="hljs-keyword">OPTIONS</span>] PATTERN [<span class="hljs-keyword">FILE</span>...]<br></code></pre></td></tr></table></figure></li>
<li><p>常见选项：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs http">--color=auto 对匹配到的文本着色显示<br>-m # 匹配#次后停止<br>-v 显示不被pattern匹配到的行,即取反<br>-i 忽略字符大小写<br>-n 显示匹配的行号<br>-c 统计匹配的行数<br>-o 仅显示匹配到的字符串<br>-q 静默模式，不输出任何信息<br>-A # after, 后#行<br>-B # before, 前#行<br>-C # context, 前后各#行<br>-e 实现多个选项间的逻辑or关系,如：grep –e ‘cat &#x27; -e ‘dog&#x27; file<br>-w 匹配整个单词<br>-E 使用ERE，相当于egrep<br>-F 不支持正则表达式，相当于fgrep<br>-P 支持Perl格式的正则表达式<br>-f file 根据模式文件处理<br>-r 递归目录，但不处理软链接<br>-R 递归目录，但处理软链接<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[22:54:45 root@localhost data]<span class="hljs-comment">#cat /etc/passwd|grep root </span><br>root:x:0:0:root:/root:/bin/bash<br>operator:x:11:0:operator:/root:/sbin/nologin<br>[22:55:26 root@localhost data]<span class="hljs-comment">#cat /etc/passwd|grep zxl </span><br>zxl:x:1000:1000:zxl:/home/zxl:/bin/bash<br>[22:55:30 root@localhost data]<span class="hljs-comment">#cat /etc/passwd|grep &quot;root&quot; </span><br>root:x:0:0:root:/root:/bin/bash<br>operator:x:11:0:operator:/root:/sbin/nologin<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：统计CPU核数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh">[22:59:58 root@localhost data]<span class="hljs-comment">#cat /proc/cpuinfo</span><br>processor	: 0<br>vendor_id	: GenuineIntel<br>cpu family	: 6<br>model		: 140<br>model name	: 11th Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz<br>stepping	: 1<br>microcode	: 0xffffffff<br>cpu MHz		: 2419.201<br>cache size	: 8192 KB<br>physical <span class="hljs-built_in">id</span>	: 0<br>siblings	: 4<br>core <span class="hljs-built_in">id</span>		: 0<br>cpu cores	: 4<br>apicid		: 0<br>initial apicid	: 0<br>fpu		: <span class="hljs-built_in">yes</span><br>fpu_exception	: <span class="hljs-built_in">yes</span><br>cpuid level	: 27<br>wp		: <span class="hljs-built_in">yes</span><br>flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon nopl xtopology tsc_reliable nonstop_tsc cpuid pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2 invpcid avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xsaves arat flush_l1d arch_capabilities<br>bugs		: spectre_v1 spectre_v2 spec_store_bypass swapgs<br>bogomips	: 4838.40<br>clflush size	: 64<br>cache_alignment	: 64<br>address sizes	: 43 bits physical, 48 bits virtual<br>power management:<br><br>[23:01:41 root@localhost data]<span class="hljs-comment">#grep -c processor /proc/cpuinfo</span><br>4<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例3：取两个文件相同行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[23:04:03 root@localhost ~]<span class="hljs-comment">#paste f2 f4</span><br>a	d<br>b	f<br>c	a<br>d	c<br>[23:04:10 root@localhost ~]<span class="hljs-comment">#grep -f f2 f4</span><br>d<br>a<br>c<br><br>[23:06:45 root@localhost ~]<span class="hljs-comment">#cat f2 f4|sort |uniq -d</span><br>a<br>c<br>d<br></code></pre></td></tr></table></figure></li>
<li><p>案例4：取磁盘分区最大利用率</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[23:28:50 root@localhost ~]<span class="hljs-comment">#df |grep &#x27;^/dev/sd&#x27; |grep -Eow &quot;100|([0-9]&#123;1,2&#125;)%&quot;|cut -d&quot;%&quot; -f1|sort -nr|head -n 1</span><br>26<br></code></pre></td></tr></table></figure></li>
<li><p>案例5：连接状态的统计</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[23:37:22 root@localhost ~]<span class="hljs-comment">#ss -nta|grep -v &quot;^State&quot;|tr -s &quot; &quot;|cut -d&quot; &quot; -f1|sort|uniq -c|sort -t 1 -nr</span><br>     84 ESTAB<br>     11 LISTEN<br>      4 CLOSE-WAIT<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-2-基本正则表达式和扩展正则表达式"><a href="#2-2-基本正则表达式和扩展正则表达式" class="headerlink" title="2.2. 基本正则表达式和扩展正则表达式"></a>2.2. 基本正则表达式和扩展正则表达式</h2><ul>
<li><p>说明</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">REGEXP： Regular Expressions，由一类特殊字符及文本字符所编写的模式，其中有些字符（元字符）<br>不表示字符字面意义，而表示控制或通配的功能，类似于增强版的通配符功能，但与通配符不同，通配<br>符功能是用来处理文件名，而正则表达式是处理文本内容中字符<br>正则表达式被很多程序和开发语言所广泛支持：<span class="hljs-keyword">vim</span>, less,<span class="hljs-keyword">grep</span>,sed,awk, nginx,mysql 等<br></code></pre></td></tr></table></figure></li>
<li><p>正则表达式分两类：</p>
<ul>
<li>基本正则表达式：BRE Basic Regular Expressions</li>
<li>扩展正则表达式：ERE Extended Regular Expressions</li>
</ul>
</li>
<li><p>正则表达式引擎</p>
<ul>
<li>采用不同算法，检查处理正则表达式的软件模块，如：PCRE</li>
<li>正则表达式的元字符分类：字符匹配、匹配次数、位置锚定、分组</li>
</ul>
</li>
<li><p>帮助：man 7 regex</p>
</li>
</ul>
<h3 id="2-2-1-正则表达式"><a href="#2-2-1-正则表达式" class="headerlink" title="2.2.1. 正则表达式"></a>2.2.1. 正则表达式</h3><h4 id="2-2-1-1-基本正则表达式元字符"><a href="#2-2-1-1-基本正则表达式元字符" class="headerlink" title="2.2.1.1. 基本正则表达式元字符"></a>2.2.1.1. 基本正则表达式元字符</h4><h5 id="2-2-1-1-1-字符匹配"><a href="#2-2-1-1-1-字符匹配" class="headerlink" title="2.2.1.1.1. 字符匹配"></a>2.2.1.1.1. 字符匹配</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs http">. 匹配任意单个字符(除了\n)，可以是一个汉字或其它国家的文字<br>[] 匹配指定范围内的任意单个字符，示例：[wang] [0-9] [a-z] [a-zA-Z]<br>[^] 匹配指定范围外的任意单个字符,示例：[^wang]<br>[:alnum:] 字母和数字<br>[:alpha:] 代表任何英文大小写字符，亦即 A-Z, a-z<br>[:lower:] 小写字母,示例:[[:lower:]],相当于[a-z]<br>[:upper:] 大写字母<br>[:blank:] 空白字符（空格和制表符）<br>[:space:] 包括空格、制表符(水平和垂直)、换行符、回车符等各种类型的空白,比[:blank:]包含的范围<br>广<br>[:cntrl:] 不可打印的控制字符（退格、删除、警铃...）<br>[:digit:] 十进制数字<br>[:xdigit:]十六进制数字<br>[:graph:] 可打印的非空白字符<br>[:print:] 可打印字符<br>[:punct:] 标点符号<br>-----------------<br>\s #匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [\f\r\t\v]。注意 Unicode<br>正则表达式会匹配全角空格符<br>\S #匹配任何非空白字符。等价于 [^\f\r\t\v]<br>\w #匹配一个字母,数字,下划线,汉字,其它国家文字的字符，等价于[_[:alnum:]字]<br>\W #匹配一个非字母,数字,下划线,汉字,其它国家文字的字符，等价于[^_[:alnum:]字]<br></code></pre></td></tr></table></figure>

<ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">[21:42:33 root@localhost ~]<span class="hljs-comment">#ls /etc/ |grep rc[0-6.]</span><br>rc0.d<br>rc1.d<br>rc2.d<br>rc3.d<br>rc4.d<br>rc5.d<br>rc6.d<br>rc.d<br>rc.local<br>[21:51:39 root@localhost data]<span class="hljs-comment">#ls</span><br>1.txt  3.txt  5.txt  7.txt  a.txt  b.txt  c.txt  d.txt  e.txt  f.txt  g.txt<br>2.txt  4.txt  6.txt  8.txt  A.txt  B.txt  C.txt  D.txt  E.txt  F.txt  G.txt<br>[21:51:40 root@localhost data]<span class="hljs-comment">#ls | grep &quot;[1-10].txt&quot;</span><br>1.txt<br>[21:51:49 root@localhost data]<span class="hljs-comment">#ls | grep &quot;[0-9].txt&quot;</span><br>1.txt<br>2.txt<br>3.txt<br>4.txt<br>5.txt<br>6.txt<br>7.txt<br>8.txt<br>[21:52:18 root@localhost data]<span class="hljs-comment">#ls | grep &quot;[a-z].txt&quot;</span><br>a.txt<br>b.txt<br>c.txt<br>d.txt<br>e.txt<br>f.txt<br>g.txt<br>[21:52:40 root@localhost data]<span class="hljs-comment">#ls | grep &quot;[A-Z].txt&quot;</span><br>A.txt<br>B.txt<br>C.txt<br>D.txt<br>E.txt<br>F.txt<br>G.txt<br>[21:53:19 root@localhost data]<span class="hljs-comment">#ls | grep &quot;[[:alnum:]].txt&quot;</span><br>1.txt<br>2.txt<br>3.txt<br>4.txt<br>5.txt<br>6.txt<br>7.txt<br>8.txt<br>a.txt<br>A.txt<br>b.txt<br>B.txt<br>c.txt<br>C.txt<br>d.txt<br>D.txt<br>e.txt<br>E.txt<br>f.txt<br>F.txt<br>g.txt<br>G.txt<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-2-1-1-2-匹配次数"><a href="#2-2-1-1-2-匹配次数" class="headerlink" title="2.2.1.1.2. 匹配次数"></a>2.2.1.1.2. 匹配次数</h5><ul>
<li><p>说明：用在要指定次数的字符后面，用于指定前面的字符要出现的次数</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">* #匹配前面的字符任意次，包括0次，贪婪模式：尽可能长的匹配<br>.* #任意长度的任意字符<br>\? #匹配其前面的字符出现0次或1次,即:可有可无<br>\+ #匹配其前面的字符出现最少1次,即:肯定有且 &gt;=1 次<br>\&#123;n\&#125; #匹配前面的字符n次<br>\&#123;m,n\&#125; #匹配前面的字符至少m次，至多n次<br>\&#123;,n\&#125; #匹配前面的字符至多n次,&lt;=n<br>\&#123;n,\&#125; #匹配前面的字符至少n次<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh">[21:58:20 root@localhost data]<span class="hljs-comment">#cat test </span><br>google<br>gooogle<br>gooooogle<br>gogle<br>gggoogle<br>gogooogle<br>[21:59:20 root@localhost data]<span class="hljs-comment">#cat test |grep &quot;goo0*gle&quot;</span><br>google<br>gggoogle<br>[22:00:28 root@localhost data]<span class="hljs-comment">#cat test |grep &quot;go\&#123;1,2\&#125;gle&quot;</span><br>google<br>gogle<br>gggoogle<br>[22:00:48 root@localhost data]<span class="hljs-comment">#cat test |grep &quot;go\&#123;3,\&#125;gle&quot;</span><br>gooogle<br>gooooogle<br>gogooogle<br>[22:02:58 root@localhost data]<span class="hljs-comment">#cat test |grep &quot;gooo\+gle&quot;</span><br>gooogle<br>gooooogle<br>gogooogle<br>[22:03:17 root@localhost data]<span class="hljs-comment">#cat test |grep &quot;gooo\?gle&quot;</span><br>google<br>gooogle<br>gggoogle<br>gogooogle<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：匹配正负数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">[22:12:41 root@localhost data]<span class="hljs-comment">#cat t1.txt</span><br>abc<br>123<br>-1<br>-22<br>23<br>a12<br>-1a4<br>-f123<br>35<br><span class="hljs-comment">#方法1</span><br>[22:12:52 root@localhost data]<span class="hljs-comment">#cat t1.txt | grep &#x27;^\-\?[0-9]\+$&#x27;</span><br>123<br>-1<br>-22<br>23<br>35<br><span class="hljs-comment">#方法2</span><br>[22:12:58 root@localhost data]<span class="hljs-comment">#cat t1.txt | grep -E &#x27;^-?[0-9]+$&#x27;</span><br>123<br>-1<br>-22<br>23<br>35<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-2-1-1-3-位置锚定"><a href="#2-2-1-1-3-位置锚定" class="headerlink" title="2.2.1.1.3. 位置锚定"></a>2.2.1.1.3. 位置锚定</h5><ul>
<li><p>s说明：位置锚定可以用于定位出现的位置</p>
</li>
<li><p>选项</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir">^ <span class="hljs-comment">#行首锚定, 用于模式的最左侧</span><br><span class="hljs-variable">$ </span><span class="hljs-comment">#行尾锚定，用于模式的最右侧</span><br>^<span class="hljs-title class_">PATTERN</span><span class="hljs-variable">$ </span><span class="hljs-comment">#用于模式匹配整行</span><br>^<span class="hljs-variable">$ </span><span class="hljs-comment">#空行</span><br>^[[<span class="hljs-symbol">:space</span><span class="hljs-symbol">:</span>]]*<span class="hljs-variable">$ </span><span class="hljs-comment">#空白行</span><br>\&lt; 或 \b <span class="hljs-comment">#词首锚定，用于单词模式的左侧</span><br>\&gt; 或 \b <span class="hljs-comment">#词尾锚定，用于单词模式的右侧</span><br>\&lt;<span class="hljs-title class_">PATTERN</span>\&gt; <span class="hljs-comment">#匹配整个单词</span><br><span class="hljs-comment">#注意: 单词是由字母,数字,下划线组成</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例1：匹配设备挂载，排除注释和空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[22:13:55 root@localhost data]<span class="hljs-comment">#grep &#x27;^[^#]&#x27; /etc/fstab</span><br>UUID=23a498b0-3783-46e4-b55f-fdb1e1c699bb /                       xfs     defaults        0 0<br>UUID=39c438a4-ad8d-4c9c-a001-7794dc13131a /boot                   xfs     defaults        0 0<br>UUID=6c74e5a8-ebc9-4329-8454-b838f5833073 /data                   xfs     defaults        0 0<br>UUID=b65aa78c-be4d-4c68-a276-c31aee04579a none                    swap    defaults        0 0<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-2-1-1-4-分组其它"><a href="#2-2-1-1-4-分组其它" class="headerlink" title="2.2.1.1.4. 分组其它"></a>2.2.1.1.4. 分组其它</h5><h6 id="2-2-1-1-4-1-分组"><a href="#2-2-1-1-4-1-分组" class="headerlink" title="2.2.1.1.4.1. 分组"></a>2.2.1.1.4.1. 分组</h6><ul>
<li><p>说明</p>
<ul>
<li>分组：() 将多个字符捆绑在一起，当作一个整体处理，如：(root)+</li>
<li>后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变量中，这些变量的命名</li>
<li>方式为: \1, \2, \3, …</li>
<li>\1 表示从左侧起第一个左括号以及与之匹配右括号之间的模式所匹配到的字符</li>
<li>注意: \0 表示正则表达式匹配的所有字符</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">\(string1\(string2\)\)<br>\1 ：string1\(string2\)<br>\2 ：string2<br></code></pre></td></tr></table></figure></li>
<li><p>注意： 后向引用引用前面的分组括号中的模式所匹配字符，而非模式本身</p>
</li>
</ul>
<h6 id="2-2-1-1-4-2-或者"><a href="#2-2-1-1-4-2-或者" class="headerlink" title="2.2.1.1.4.2. 或者"></a>2.2.1.1.4.2. 或者</h6><ul>
<li><p>或者：|</p>
</li>
<li><p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">a\|b <span class="hljs-comment">#a或b</span><br>C\|<span class="hljs-built_in">cat</span> <span class="hljs-comment">#C或cat</span><br>\(C\|c\)at <span class="hljs-comment">#Cat或cat</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-2-扩展正则表达式元字符"><a href="#2-2-2-扩展正则表达式元字符" class="headerlink" title="2.2.2. 扩展正则表达式元字符"></a>2.2.2. 扩展正则表达式元字符</h3><h4 id="2-2-2-1-字符匹配"><a href="#2-2-2-1-字符匹配" class="headerlink" title="2.2.2.1. 字符匹配"></a>2.2.2.1. 字符匹配</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http">. 任意单个字符<br>[wang] 指定范围的字符<br>[^wang] 不在指定范围的字符<br>[:alnum:] 字母和数字<br>[:alpha:] 代表任何英文大小写字符，亦即 A-Z, a-z<br>[:lower:] 小写字母,示例:[[:lower:]],相当于[a-z]<br>[:upper:] 大写字母<br>[:blank:] 空白字符（空格和制表符）<br>[:space:] 水平和垂直的空白字符（比[:blank:]包含的范围广）<br>[:cntrl:] 不可打印的控制字符（退格、删除、警铃...）<br>[:digit:] 十进制数字<br>[:xdigit:]十六进制数字<br>[:graph:] 可打印的非空白字符<br>[:print:] 可打印字符<br>[:punct:] 标点符号<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-2-2-次数匹配"><a href="#2-2-2-2-次数匹配" class="headerlink" title="2.2.2.2. 次数匹配"></a>2.2.2.2. 次数匹配</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">* 匹配前面字符任意次<br>? 0或1次<br>+ 1次或多次<br>&#123;n&#125; 匹配n次<br>&#123;m,n&#125; 至少m，至多n次<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-2-3-位置锚定"><a href="#2-2-2-3-位置锚定" class="headerlink" title="2.2.2.3. 位置锚定"></a>2.2.2.3. 位置锚定</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">^ 行首<br>$ 行尾<br>\&lt;, \b 语首<br>\&gt;, \b 语尾<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-2-4-分组其它"><a href="#2-2-2-4-分组其它" class="headerlink" title="2.2.2.4. 分组其它"></a>2.2.2.4. 分组其它</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">() 分组<br>后向引用：\1, \2, ... 注意: \0 表示正则表达式匹配的所有字符<br>| 或者<br>a|b #a或b<br>C|cat #C或cat<br>(C|c)at #Cat或cat<br></code></pre></td></tr></table></figure></li>
<li><p>案例1：ifconfig查找IP地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">[22:36:34 root@localhost data]<span class="hljs-comment">#ifconfig | grep -Ewo &quot;(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])&quot;|head -n1</span><br>192.168.100.30<br><br><br>[23:55:42 root@localhost ~]<span class="hljs-comment">#ifconfig |grep -Eow &quot;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span><br>192.168.100.30<br>255.255.255.0<br>192.168.100.255<br>127.0.0.1<br>255.0.0.0<br>192.168.122.1<br>255.255.255.0<br>192.168.122.255<br><br><br>[23:55:49 root@localhost ~]<span class="hljs-comment">#echo &quot;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;  &gt; regex.txt</span><br>[23:57:27 root@localhost ~]<span class="hljs-comment">#ifconfig |grep -Eowf regex.txt </span><br>192.168.100.30<br>255.255.255.0<br>192.168.100.255<br>127.0.0.1<br>255.0.0.0<br>192.168.122.1<br>255.255.255.0<br>192.168.122.255<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例2：查找多个匹配行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">[23:57:44 root@localhost ~]<span class="hljs-comment">#cat /etc/passwd|grep -E &quot;root|zxl|mysql|jira&quot;</span><br>root:x:0:0:root:/root:/bin/bash<br>operator:x:11:0:operator:/root:/sbin/nologin<br>zxl:x:1000:1000:zxl:/home/zxl:/bin/bash<br>mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false<br>jira:x:1001:1001:Atlassian Jira:/home/jira:/bin/bash<br><br>[00:33:17 root@localhost ~]<span class="hljs-comment">#cat /etc/passwd|grep -e &quot;root&quot; -e &quot;mysql&quot;</span><br>root:x:0:0:root:/root:/bin/bash<br>operator:x:11:0:operator:/root:/sbin/nologin<br>mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false<br><br><span class="hljs-comment">#匹配单词的开始和结束为统一匹配单词</span><br>[00:39:01 root@localhost ~]<span class="hljs-comment">#grep -E &quot;^(.*)\&gt;.*\&lt;\1$&quot; /etc/passwd</span><br><span class="hljs-built_in">sync</span>:x:5:0:<span class="hljs-built_in">sync</span>:/sbin:/bin/sync<br>shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown<br>halt:x:7:0:halt:/sbin:/sbin/halt<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例3：过滤掉文件的注释(包括#号的行)和空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[00:50:40 root@localhost ~]<span class="hljs-comment">#grep -Ev &#x27;^$|#&#x27; /etc/fstab </span><br>UUID=23a498b0-3783-46e4-b55f-fdb1e1c699bb /                       xfs     defaults        0 0<br>UUID=39c438a4-ad8d-4c9c-a001-7794dc13131a /boot                   xfs     defaults        0 0<br>UUID=6c74e5a8-ebc9-4329-8454-b838f5833073 /data                   xfs     defaults        0 0<br>UUID=b65aa78c-be4d-4c68-a276-c31aee04579a none                    swap    defaults        0 0<br></code></pre></td></tr></table></figure></li>
<li><p>案例4：算出所有人的年龄总和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[00:51:46 root@localhost ~]<span class="hljs-comment">#cat p</span><br>xiaoming=20<br>xiaohong=18<br>xiaoqiang=22<br>[00:57:34 root@localhost ~]<span class="hljs-comment">#cat p|grep -Eo &quot;[0-9]+&quot;|paste -s -d&quot;+&quot;|bc</span><br>60<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-3-文件查找工具"><a href="#2-3-文件查找工具" class="headerlink" title="2.3. 文件查找工具"></a>2.3. 文件查找工具</h2><ul>
<li>说明：在文件系统上查找符合条件的文件</li>
<li>文件查找<ul>
<li>非实时查找(数据库查找)：locate</li>
<li>实时查找：find</li>
</ul>
</li>
</ul>
<h3 id="2-3-1-locate"><a href="#2-3-1-locate" class="headerlink" title="2.3.1. locate"></a>2.3.1. locate</h3><ul>
<li><p>说明：</p>
<ul>
<li>locate 查询系统上预建的文件索引数据库 /var/lib/mlocate/mlocate.db</li>
<li>索引的构建是在系统较为空闲时自动进行(周期性任务)，执行updatedb可以更新数据库</li>
<li>索引构建过程需要遍历整个根文件系统，很消耗资源</li>
<li>locate和updatedb命令来自于mlocate包</li>
</ul>
</li>
<li><p>工作特点</p>
<ul>
<li>查找速度快</li>
<li>模糊查找</li>
<li>非实时查找</li>
<li>搜索的是文件的全路径，不仅仅是文件名</li>
<li>可能只搜索用户具备读取和执行权限的目录</li>
</ul>
</li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">locate [OPTION]... [PATTERN]...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-i 不区分大小写的搜索</span><br><span class="hljs-deletion">-n N 只列举前N个匹配项目</span><br><span class="hljs-deletion">-r 使用基本正则表达式</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:09:23 root@localhost ~]<span class="hljs-comment">#locate -r &quot;passwd$&quot;</span><br>/etc/passwd<br>/etc/pam.d/passwd<br>/etc/security/opasswd<br>/root/passwd<br>/usr/bin/gpasswd<br>/usr/bin/htpasswd<br>/usr/bin/passwd<br>/usr/bin/vncpasswd<br>/usr/sbin/chgpasswd<br>/usr/sbin/chpasswd<br>/usr/sbin/lpasswd<br>/usr/share/bash-completion/completions/chpasswd<br>/usr/share/bash-completion/completions/gpasswd<br>/usr/share/bash-completion/completions/htpasswd<br>/usr/share/bash-completion/completions/ldappasswd<br>/usr/share/bash-completion/completions/passwd<br>/usr/share/bash-completion/completions/smbpasswd<br>/usr/share/doc/passwd<br>/usr/share/licenses/passwd<br>/var/lib/sss/mc/passwd<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例2：文件新创建和删除,无法马上更新locate数据库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:11:03 root@localhost ~]<span class="hljs-comment">#touch abc.log</span><br>[01:11:10 root@localhost ~]<span class="hljs-comment">#locate &quot;abc.log&quot;</span><br>[01:11:21 root@localhost ~]<span class="hljs-comment">#updatedb </span><br>[01:11:32 root@localhost ~]<span class="hljs-comment">#locate &quot;abc.log&quot;</span><br>/root/abc.log<br>[01:11:35 root@localhost ~]<span class="hljs-comment">#rm abc.log </span><br><span class="hljs-built_in">rm</span>：是否删除普通空文件 <span class="hljs-string">&#x27;abc.log&#x27;</span>？y<br>[01:12:00 root@localhost ~]<span class="hljs-comment">#locate &quot;abc.log&quot;</span><br>/root/abc.log<br>[01:12:22 root@localhost ~]<span class="hljs-comment">#updatedb </span><br>[01:12:27 root@localhost ~]<span class="hljs-comment">#locate &quot;abc.log&quot;</span><br>[01:12:29 root@localhost ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-3-2-find"><a href="#2-3-2-find" class="headerlink" title="2.3.2. find"></a>2.3.2. find</h3><ul>
<li><p>说明：find 是实时查找工具，通过遍历指定路径完成文件查找</p>
</li>
<li><p>工作特点：</p>
<ul>
<li>查找速度略慢</li>
<li>精确查找</li>
<li>实时查找</li>
<li>查找条件丰富</li>
<li>可能只搜索用户具备读取和执行权限的目录</li>
</ul>
</li>
<li><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">find [OPTION]... [查找路径] [查找条件] [处理动作]<br></code></pre></td></tr></table></figure></li>
<li><p>查找路径：指定具体目标路径；默认为当前目录</p>
</li>
<li><p>查找条件：指定的查找标准，可以文件名、大小、类型、权限等标准进行；默认为找出指定路径下的所有文件</p>
</li>
<li><p>处理动作：对符合条件的文件做操作，默认输出至屏幕</p>
</li>
</ul>
<h4 id="2-3-2-1-指定搜索目录层级"><a href="#2-3-2-1-指定搜索目录层级" class="headerlink" title="2.3.2.1. 指定搜索目录层级"></a>2.3.2.1. 指定搜索目录层级</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">-maxdepth level 最大搜索目录深度,指定目录下的文件为第1级<br>-mindepth level 最小搜索目录深度<br></code></pre></td></tr></table></figure></li>
<li><p>案例1：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:16:37 root@localhost ~]<span class="hljs-comment">#find /etc -maxdepth 2 -mindepth 2 |head -n 5</span><br>/etc/dnf/modules.d<br>/etc/dnf/aliases.d<br>/etc/dnf/dnf.conf<br>/etc/dnf/modules.defaults.d<br>/etc/dnf/plugins<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-2-对每个目录先处理目录内的文件，再处理目录本身"><a href="#2-3-2-2-对每个目录先处理目录内的文件，再处理目录本身" class="headerlink" title="2.3.2.2. 对每个目录先处理目录内的文件，再处理目录本身"></a>2.3.2.2. 对每个目录先处理目录内的文件，再处理目录本身</h4><ul>
<li><p>选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">-depth<br>-d <span class="hljs-comment">#warning: the -d option is deprecated; please use -depth instead, because the</span><br>latter is a POSIX-compliant feature<br></code></pre></td></tr></table></figure></li>
<li><p>案例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:20:18 root@localhost ~]<span class="hljs-comment">#tree /data/</span><br>/data/<br>├── 1.txt<br>├── 2.txt<br>├── 3.txt<br>├── 4.txt<br>├── 5.txt<br>├── 6.txt<br>├── 7.txt<br>├── 8.txt<br>├── a.txt<br>├── dir1<br>│   └── <span class="hljs-built_in">dir</span><br>├── dir2<br>│   └── <span class="hljs-built_in">dir</span><br>├── dir3<br>│   └── <span class="hljs-built_in">dir</span><br>├── t1.txt<br>└── <span class="hljs-built_in">test</span><br><br>6 directories, 11 files<br>[01:20:22 root@localhost ~]<span class="hljs-comment">#find /data/</span><br>/data/<br>/data/a.txt<br>/data/1.txt<br>/data/2.txt<br>/data/3.txt<br>/data/4.txt<br>/data/5.txt<br>/data/6.txt<br>/data/7.txt<br>/data/8.txt<br>/data/test<br>/data/t1.txt<br>/data/dir1<br>/data/dir1/dir<br>/data/dir2<br>/data/dir2/dir<br>/data/dir3<br>/data/dir3/dir<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-3-根据文件名和inode查找"><a href="#2-3-2-3-根据文件名和inode查找" class="headerlink" title="2.3.2.3. 根据文件名和inode查找"></a>2.3.2.3. 根据文件名和inode查找</h4><ul>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">-name &quot;文件名称&quot; #支持使用glob，如：*, ?, [], [^],通配符要加双引号引起来<br>-iname &quot;文件名称&quot; #不区分字母大小写<br>-inum n #按inode号查找<br>-samefile name #相同inode号的文件<br>-links n #链接数为n的文件<br>-regex “PATTERN&quot; #以PATTERN匹配整个文件路径，而非文件名称<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:24:43 root@localhost ~]<span class="hljs-comment">#find  /data/  -name &quot;*.txt&quot;</span><br>/data/a.txt<br>/data/1.txt<br>/data/2.txt<br>/data/3.txt<br>/data/4.txt<br>/data/5.txt<br>/data/6.txt<br>/data/7.txt<br>/data/8.txt<br>/data/t1.txt<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-4-根据属主、属组查找"><a href="#2-3-2-4-根据属主、属组查找" class="headerlink" title="2.3.2.4. 根据属主、属组查找"></a>2.3.2.4. 根据属主、属组查找</h4><ul>
<li><p>选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">-user USERNAME <span class="hljs-comment">#查找属主为指定用户(UID)的文件</span><br>-group GRPNAME <span class="hljs-comment">#查找属组为指定组(GID)的文件</span><br>-uid UserID <span class="hljs-comment">#查找属主为指定的UID号的文件</span><br>-gid GroupID <span class="hljs-comment">#查找属组为指定的GID号的文件</span><br>-nouser <span class="hljs-comment">#查找没有属主的文件</span><br>-nogroup <span class="hljs-comment">#查找没有属组的文件</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:27:08 root@localhost ~]<span class="hljs-comment">#find  / -user &quot;zxl&quot; |head -n 3</span><br>find: ‘/proc/20986/task/20986/fd/6’: 没有那个文件或目录<br>find: ‘/proc/20986/task/20986/fdinfo/6’: 没有那个文件或目录<br>find: ‘/proc/20986/fd/7’: 没有那个文件或目录<br>find: ‘/proc/20986/fdinfo/7’: 没有那个文件或目录<br>/var/spool/mail/zxl<br>/home/zxl<br>/home/zxl/.mozilla<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-5-根据文件类型查找"><a href="#2-3-2-5-根据文件类型查找" class="headerlink" title="2.3.2.5. 根据文件类型查找"></a>2.3.2.5. 根据文件类型查找</h4><ul>
<li><p>选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">-<span class="hljs-built_in">type</span> TYPE<br>TYPE可以是以下形式：<br>f: 普通文件<br>d: 目录文件<br>l: 符号链接文件<br>s：套接字文件<br>b: 块设备文件<br>c: 字符设备文件<br>p: 管道文件<br></code></pre></td></tr></table></figure></li>
<li><p>案例：查找磁盘文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:29:44 root@localhost ~]<span class="hljs-comment">#find /dev/ -type &quot;b&quot;</span><br>/dev/sr0<br>/dev/sda5<br>/dev/sda4<br>/dev/sda3<br>/dev/sda2<br>/dev/sda1<br>/dev/sda<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-6-空文件或目录"><a href="#2-3-2-6-空文件或目录" class="headerlink" title="2.3.2.6. 空文件或目录"></a>2.3.2.6. 空文件或目录</h4><ul>
<li><p>选项</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-empty</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例：查找空目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:30:00 root@localhost ~]<span class="hljs-comment">#find /data/ -type &quot;d&quot; -empty </span><br>/data/dir1/dir<br>/data/dir2/dir<br>/data/dir3/dir<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-7-组合条件"><a href="#2-3-2-7-组合条件" class="headerlink" title="2.3.2.7. 组合条件"></a>2.3.2.7. 组合条件</h4><ul>
<li><p>选项</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">与：-<span class="hljs-selector-tag">a</span> ，默认多个条件是与关系，所以可以省略-<span class="hljs-selector-tag">a</span><br>或：-o<br>非：-not !<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:31:33 root@localhost ~]<span class="hljs-comment">#find /etc/ -type d -o -type l |wc -l</span><br>705<br>[01:33:20 root@localhost ~]<span class="hljs-comment">#find /etc/ -type d -o -type l -ls |wc -l</span><br>286<br>[01:33:49 root@localhost ~]<span class="hljs-comment">#find /etc/ \( -type d -o -type l \) -ls |wc -l</span><br>705<br></code></pre></td></tr></table></figure></li>
<li><p>德·摩根定律</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">!A -a !B = !(A -o B)<br>!A -o !B = !(A -a B)<br></code></pre></td></tr></table></figure></li>
<li><p>案例2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">find -user joe -group joe<br>find -user joe -not -group joe<br>find -user joe -o -user jane<br>find -not \( -user joe -o -user jane \)<br>find / -user joe -o -uid 500<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh">  [01:34:12 root@localhost ~]<span class="hljs-comment">#find ! \( -type d -a -empty \)| wc -l</span><br>  1027<br>  [01:36:13 root@localhost ~]<span class="hljs-comment">#find ! -type d -o ! -empty |wc -l</span><br>  1027<br>  <br>  [01:39:35 root@localhost ~]<span class="hljs-comment">#find /home/ ! -user root ! -user zxl ! -user wang1 ! -user wang2 ! -user wang3</span><br>  /home/jira<br>  /home/jira/.mozilla<br>  /home/jira/.mozilla/extensions<br>  /home/jira/.mozilla/plugins<br>  /home/jira/.bash_logout<br>  /home/jira/.bash_profile<br>  /home/jira/.bashrc<br>  /home/jira/.java<br>  /home/jira/.java/fonts<br>  /home/jira/.java/fonts/11.0.13<br>  /home/jira/.java/fonts/11.0.13/fcinfo-1-localhost.localdomain-RedHat-8.5.2111-zh.properties<br>  <br>  <br>  [10:48:35 root@localhost ~]<span class="hljs-comment">#find /home/  ! \( -user root   -o -user zxl -o -user wang1 -o -user wang1 -o -user wang2 -o -user wang3 \)</span><br>/home/jira<br>  /home/jira/.mozilla<br>  /home/jira/.mozilla/extensions<br>  /home/jira/.mozilla/plugins<br>  /home/jira/.bash_logout<br>  /home/jira/.bash_profile<br>  /home/jira/.bashrc<br>  /home/jira/.java<br>  /home/jira/.java/fonts<br>  /home/jira/.java/fonts/11.0.13<br>  /home/jira/.java/fonts/11.0.13/fcinfo-1-localhost.localdomain-RedHat-8.5.2111-zh.properties<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-8-排除目录"><a href="#2-3-2-8-排除目录" class="headerlink" title="2.3.2.8. 排除目录"></a>2.3.2.8. 排除目录</h4><ul>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#查找/data/下，除data/dir1目录的其它所有.txt后缀的文件</span><br>[11:43:21 root@localhost ~]<span class="hljs-comment">#find /data/</span><br>/data/<br>/data/a.txt<br>/data/1.txt<br>/data/2.txt<br>/data/3.txt<br>/data/4.txt<br>/data/5.txt<br>/data/6.txt<br>/data/7.txt<br>/data/8.txt<br>/data/test<br>/data/t1.txt<br>/data/dir1<br>/data/dir1/dir<br>/data/dir1/a.txt<br>/data/dir1/b.txt<br>/data/dir1/c.txt<br>/data/dir1/d.txt<br>/data/dir1/e.txt<br>/data/dir1/f.txt<br>/data/dir1/g.txt<br>/data/dir2<br>/data/dir2/dir<br>/data/dir3<br>/data/dir3/dir<br>[11:43:15 root@localhost ~]<span class="hljs-comment">#find /data -path &quot;/data/dir1&quot; -prune  -o -name &quot;*.txt&quot;</span><br>/data/a.txt<br>/data/1.txt<br>/data/2.txt<br>/data/3.txt<br>/data/4.txt<br>/data/5.txt<br>/data/6.txt<br>/data/7.txt<br>/data/8.txt<br>/data/t1.txt<br>/data/dir1<br><br><span class="hljs-comment">#统计查找/etc/下，除/etc/security和/etc/systemd,/etc/dbus-1三个目录的所有.conf后缀的文件</span><br>[11:50:23 root@localhost ~]<span class="hljs-comment">#find /etc  -name &quot;*.conf&quot;|wc -l</span><br>433<br>[11:49:32 root@localhost ~]<span class="hljs-comment">#find /etc \( -path &quot;/etc/security&quot; -o -path &quot;/etc/systemd&quot; -o -path &quot;/etc/dbus-1&quot; \)  -prune -o -name &quot;*.conf&quot;|wc -l</span><br>386<br>[11:49:41 root@localhost ~]<span class="hljs-comment">#find /etc \( -path &quot;/etc/security&quot; -o -path &quot;/etc/systemd&quot; -o -path &quot;/etc/dbus-1&quot; \) -a  -prune -o -name &quot;*.conf&quot;|wc -l</span><br>386<br><br><br><span class="hljs-comment">#排除/proc和/sys目录</span><br>[11:51:01 root@localhost ~]<span class="hljs-comment">#find / \( -path &quot;/sys&quot; -o -path &quot;/proc&quot; \) -a -prune -o -type f -a -mmin -1</span><br>/proc<br>/sys<br>/var/lib/mysql/ibdata1<br>/var/lib/mysql/mysql/innodb_table_stats.ibd<br>/var/lib/mysql/mysql/innodb_index_stats.ibd<br>/var/lib/mysql/jira/clusteredjob.ibd<br>/var/lib/mysql/jira/rundetails.ibd<br>/var/lib/mysql/jira/SEQUENCE_VALUE_ITEM.ibd<br>/var/lib/mysql/ib_logfile0<br>/var/lib/mysql/ibtmp1<br>/var/atlassian/application-data/jira/log/atlassian-jira-perf.log<br>/var/atlassian/application-data/jira/log/atlassian-jira-outgoing-mail.log<br>/var/atlassian/application-data/jira/log/atlassian-jira.log<br>/var/atlassian/application-data/jira/analytics-logs/68491876c23d7650370b5d3c4b6d778c.atlassian-analytics.log<br>/var/atlassian/application-data/jira/monitor/ConnectionPoolGraph.rrd4j<br>/var/atlassian/application-data/jira/monitor/DatabaseReadWritesGraph.rrd4j<br>/opt/atlassian/jira/temp/2022_08_05_15_38_24_1215/2022_08_08_11_50_00.part<br>/tmp/hsperfdata_jira/1215<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-2-9-根据文件大小来查找"><a href="#2-3-2-9-根据文件大小来查找" class="headerlink" title="2.3.2.9. 根据文件大小来查找"></a>2.3.2.9. 根据文件大小来查找</h4><h2 id="2-4-xargs动态生成命令参数"><a href="#2-4-xargs动态生成命令参数" class="headerlink" title="2.4. xargs动态生成命令参数"></a>2.4. xargs动态生成命令参数</h2><ul>
<li><p>说明</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs julia">由于很多命令不支持管道|来传递参数，xargs用于产生某个命令的参数，xargs 可以读入 <span class="hljs-literal">stdin</span> 的数<br>据，并且以空格符或回车符将 <span class="hljs-literal">stdin</span> 的数据分隔成为参数另外，许多命令不能接受过多参数，命令执行可能会失败，xargs 可以解决<br></code></pre></td></tr></table></figure></li>
<li><p>注意：文件名或者是其他意义的名词内含有空格符的情况</p>
</li>
<li><p>find 经常和 xargs 命令进行组合,形式如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">find | xargs COMMAND<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#显示10个数字</span><br>[root@centos8 ~]<span class="hljs-comment">#seq 10 | xargs</span><br>1 2 3 4 5 6 7 8 9 10<br><span class="hljs-comment">#删除当前目录下的大量文件</span><br><span class="hljs-built_in">ls</span> | xargs <span class="hljs-built_in">rm</span><br><span class="hljs-comment">#</span><br>find -name <span class="hljs-string">&quot;*.sh&quot;</span> | xargs <span class="hljs-built_in">ls</span> -Sl<br>[root@centos8 data]<span class="hljs-comment">#echo &#123;1..10&#125; |xargs</span><br>1 2 3 4 5 6 7 8 9 10<br>[root@centos8 data]<span class="hljs-comment">#echo &#123;1..10&#125; |xargs -n1</span><br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>[root@centos8 data]<span class="hljs-comment">#echo &#123;1..10&#125; |xargs -n2</span><br>1 2<br>3 4<br>5 6<br>7 8<br>9 10<br><span class="hljs-comment">#批量创建和删除用户</span><br><span class="hljs-built_in">echo</span> user&#123;1..10&#125; |xargs -n1 useradd<br><span class="hljs-built_in">echo</span> user&#123;1..100&#125; | xargs -n1 userdel -r<br><span class="hljs-comment">#这个命令是错误的</span><br>find /sbin/ -perm /700 | <span class="hljs-built_in">ls</span> -l<br><span class="hljs-comment">#查找有特殊权限的文件，并排序</span><br>find /bin/ -perm /7000 | xargs <span class="hljs-built_in">ls</span> -Sl<br><span class="hljs-comment">#此命令和上面有何区别？</span><br>find /bin/ -perm -7000 | xargs <span class="hljs-built_in">ls</span> -Sl<br><span class="hljs-comment">#以字符nul分隔</span><br>find -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.txt&quot;</span> -print0 | xargs -0 <span class="hljs-built_in">rm</span><br><span class="hljs-comment">#并发执行多个进程</span><br><span class="hljs-built_in">seq</span> 100 |xargs -i -P10 wget -P /data http://10.0.0.8/&#123;&#125;.html<br><span class="hljs-comment">#并行下载bilibili视频</span><br>yum install python3-pip -y<br>pip3 install you-get<br><span class="hljs-built_in">seq</span> 60 | xargs -i -P3 you-get https://www.bilibili.com/video/BV14K411W7UF?p=&#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-5-文件压缩和打包"><a href="#2-5-文件压缩和打包" class="headerlink" title="2.5. 文件压缩和打包"></a>2.5. 文件压缩和打包</h2><p>主要针对单个文件压缩,而非目录</p>
<h3 id="2-5-1-compress-和-uncompress"><a href="#2-5-1-compress-和-uncompress" class="headerlink" title="2.5.1. compress 和 uncompress"></a>2.5.1. compress 和 uncompress</h3><ul>
<li><p>说明：此工具来自于ncompress包,此工具目前已经很少使用，对应的文件是 .Z 后缀</p>
</li>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">-d 解压缩，相当于uncompress<br>-c 结果输出至标准输出,不删除原文件<br>-v 显示详情<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-2-zip和gunzip"><a href="#2-5-2-zip和gunzip" class="headerlink" title="2.5.2. zip和gunzip"></a>2.5.2. zip和gunzip</h3><ul>
<li><p>说明：来自于 gzip 包，对应的文件是 .gz 后缀</p>
</li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">gzip [OPTION]... FILE ...<br></code></pre></td></tr></table></figure></li>
<li><p>选项</p>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-literal">-</span>k keep, 保留原文件,CentOS 8 新特性<br><span class="hljs-literal">-</span>d 解压缩，相当于gunzip<br><span class="hljs-literal">-</span>c 结果输出至标准输出，保留原文件不改变<br><span class="hljs-literal">-</span><span class="hljs-comment"># 指定压缩比，#取值为1-9，值越大压缩比越大</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#文件压缩</span><br>[12:22:42 root@localhost data]<span class="hljs-comment">#gzip -c 1.txt &gt; /data/dir1/1.txt.gz</span><br>[12:23:37 root@localhost data]<span class="hljs-comment">#ls /data/dir1/1.txt.gz</span><br>/data/dir1/1.txt.gz<br><span class="hljs-comment">#文件解压</span><br>[12:26:28 root@localhost data]<span class="hljs-comment">#gzip -c -d /data/dir1/1.txt.gz &gt; /data/dir1/1.txt</span><br>[12:26:37 root@localhost data]<span class="hljs-comment">#ls /data/dir1/1.txt</span><br>/data/dir1/1.txt<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-3-bzip2和bunzip2"><a href="#2-5-3-bzip2和bunzip2" class="headerlink" title="2.5.3. bzip2和bunzip2"></a>2.5.3. bzip2和bunzip2</h3><ul>
<li><p>说明：来自于 bzip2 包，对应的文件是 .bz2 后缀</p>
</li>
<li><p>格式</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bzip2 [<span class="hljs-keyword">OPTION</span>]... <span class="hljs-keyword">FILE</span> ...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">-k keep, 保留原文件<br>-d 解压缩<br>-c 结果输出至标准输出，保留原文件不改变<br>-# 1-9，压缩比，默认为9<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#文件压缩</span><br>[12:33:19 root@localhost data]<span class="hljs-comment">#bzip2 -c  3.txt &gt; /data/dir2/2.txt.bz2</span><br>[12:33:36 root@localhost data]<span class="hljs-comment">#ls /data/dir2/2.txt.bz2</span><br>/data/dir2/2.txt.bz2<br><span class="hljs-comment">#文件解压</span><br>[12:33:42 root@localhost data]<span class="hljs-comment">#bzip2 -c -d   /data/dir2/2.txt.bz2 &gt; /data/dir1/2.txt</span><br>[12:35:17 root@localhost data]<span class="hljs-comment">#ls /data/dir1/2.txt</span><br>/data/dir1/2.txt<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-4-xz-和-unxz"><a href="#2-5-4-xz-和-unxz" class="headerlink" title="2.5.4. xz 和 unxz"></a>2.5.4. xz 和 unxz</h3><ul>
<li><p>说明：来自于 xz 包,对应的文件是 .xz 后缀</p>
</li>
<li><p>格式</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">xz [<span class="hljs-keyword">OPTION</span>]... <span class="hljs-keyword">FILE</span> ...<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">-k keep, 保留原文件<br>-d 解压缩<br>-c 结果输出至标准输出，保留原文件不改变<br>-# 压缩比，取值1-9，默认为6<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#文件压缩</span><br>[12:41:32 root@localhost data]<span class="hljs-comment">#xz -c 4.txt &gt; /data/dir1/4.txt.xz</span><br>[12:42:17 root@localhost data]<span class="hljs-comment">#ls /data/dir1/4.txt.xz</span><br>/data/dir1/4.txt.xz<br><span class="hljs-comment">#文件解压</span><br>[12:42:24 root@localhost data]<span class="hljs-comment">#xz -c -d /data/dir1/4.txt.xz &gt; /data/dir1/4.txt</span><br>[12:44:28 root@localhost data]<span class="hljs-comment">#ls /data/dir1/4.txt</span><br>/data/dir1/4.txt<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-5-zip-和-unzip"><a href="#2-5-5-zip-和-unzip" class="headerlink" title="2.5.5. zip 和 unzip"></a>2.5.5. zip 和 unzip</h3><ul>
<li><p>说明：zip 可以实现打包目录和多个文件成一个文件并压缩，但可能会丢失文件属性信息，如：所有者和组信<br>息，一般建议使用 tar 代替，分别来自于 zip 和 unzip 包对应的文件是 .zip 后缀</p>
</li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs http">-A 调整可执行的自动解压缩文件。<br>-b&lt;工作目录&gt; 指定暂时存放文件的目录。<br>-c 替每个被压缩的文件加上注释。<br>-d 从压缩文件内删除指定的文件。<br>-D 压缩文件内不建立目录名称。<br>-f 更新现有的文件。<br>-F 尝试修复已损坏的压缩文件。<br>-g 将文件压缩后附加在既有的压缩文件之后，而非另行建立新的压缩文件。<br>-h 在线帮助。<br>-i&lt;范本样式&gt; 只压缩符合条件的文件。<br>-j 只保存文件名称及其内容，而不存放任何目录名称。<br>-J 删除压缩文件前面不必要的数据。<br>-k 使用MS-DOS兼容格式的文件名称。<br>-l 压缩文件时，把LF字符置换成LF+CR字符。<br>-ll 压缩文件时，把LF+CR字符置换成LF字符。<br>-L 显示版权信息。<br>-m 将文件压缩并加入压缩文件后，删除原始文件，即把文件移到压缩文件中。<br>-n&lt;字尾字符串&gt; 不压缩具有特定字尾字符串的文件。<br>-o 以压缩文件内拥有最新更改时间的文件为准，将压缩文件的更改时间设成和该文件相同。<br>-q 不显示指令执行过程。<br>-r 递归处理，将指定目录下的所有文件和子目录一并处理。<br>-S 包含系统和隐藏文件。<br>-t&lt;日期时间&gt; 把压缩文件的日期设成指定的日期。<br>-T 检查备份文件内的每个文件是否正确无误。<br>-u 与 -f 参数类似，但是除了更新现有的文件外，也会将压缩文件中的其他文件解压缩到目录中。<br>-v 显示指令执行过程或显示版本信息。<br>-V 保存VMS操作系统的文件属性。<br>-w 在文件名称里假如版本编号，本参数仅在VMS操作系统下有效。<br>-x&lt;范本样式&gt; 压缩时排除符合条件的文件。<br>-X 不保存额外的文件属性。<br>-y 直接保存符号连接，而非该连接所指向的文件，本参数仅在UNIX之类的系统下有效。<br>-z 替压缩文件加上注释。<br>-$ 保存第一个被压缩文件所在磁盘的卷册名称。<br>-&lt;压缩效率&gt; 压缩效率是一个介于1-9的数值。<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#打包文件并压缩</span><br>[12:51:26 root@localhost data]<span class="hljs-comment">#zip -r /data/etc.zip /etc/</span><br>[12:52:14 root@localhost data]<span class="hljs-comment">#ll /data/etc.zip </span><br>-rw-r--r--. 1 root root 219634037 8月   8 12:50 /data/etc.zip<br><span class="hljs-comment">#文件解压</span><br>[12:56:29 root@localhost data]<span class="hljs-comment">#unzip /data/etc.zip </span><br>[12:57:09 root@localhost data]<span class="hljs-comment">#ll /data/</span><br>总用量 214500<br>drwxr-xr-x. 156 root root      8192 8月   8 10:40 etc<br>-rw-r--r--.   1 root root 219634037 8月   8 12:50 etc.zip<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-6-打包和解包"><a href="#2-5-6-打包和解包" class="headerlink" title="2.5.6. 打包和解包"></a>2.5.6. 打包和解包</h3><h4 id="2-5-6-1-tar"><a href="#2-5-6-1-tar" class="headerlink" title="2.5.6.1. tar"></a>2.5.6.1. tar</h4><ul>
<li><p>说明：tar 即 Tape ARchive 磁带归档，可以对目录和多个文件打包一个文件，并且可以压缩，保留文件属性不丢失，常用于备份功能，推荐使用对应的文件是 .tar 后缀</p>
</li>
<li><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar [-ABcdgGhiklmMoOpPrRsStuUvwWxzZ][-b &lt;区块数目&gt;][-C &lt;目的目录&gt;][-f &lt;备份文件&gt;][-F &lt;Script文件&gt;][-K &lt;文件&gt;][-L &lt;媒体容量&gt;][-N &lt;日期时间&gt;][-T &lt;范本文件&gt;][-V &lt;卷册名称&gt;][-X &lt;范本文件&gt;][-&lt;设备编号&gt;&lt;存储密度&gt;][--after-date=&lt;日期时间&gt;][--atime-preserve][--backuup=&lt;备份方式&gt;][--checkpoint][--concatenate][--confirmation][--delete][--exclude=&lt;范本样式&gt;][--force-local][--group=&lt;群组名称&gt;][--<span class="hljs-built_in">help</span>][--ignore-failed-read][--new-volume-script=&lt;Script文件&gt;][--newer-mtime][--no-recursion][--null][--numeric-owner][--owner=&lt;用户名称&gt;][--posix][--erve][--preserve-order][--preserve-permissions][--record-size=&lt;区块数目&gt;][--recursive-unlink][--remove-files][--rsh-command=&lt;执行指令&gt;][--same-owner][--suffix=&lt;备份字尾字符串&gt;][--totals][--use-compress-program=&lt;执行指令&gt;][--version][--volno-file=&lt;编号文件&gt;][文件或目录...]<br><br></code></pre></td></tr></table></figure></li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs http">-A或--catenate 新增文件到已存在的备份文件。<br>-b&lt;区块数目&gt;或--blocking-factor=&lt;区块数目&gt; 设置每笔记录的区块数目，每个区块大小为12Bytes。<br>-B或--read-full-records 读取数据时重设区块大小。<br>-c或--create 建立新的备份文件。<br>-C&lt;目的目录&gt;或--directory=&lt;目的目录&gt; 切换到指定的目录。<br>-d或--diff或--compare 对比备份文件内和文件系统上的文件的差异。<br>-f&lt;备份文件&gt;或--file=&lt;备份文件&gt; 指定备份文件。<br>-F&lt;Script文件&gt;或--info-script=&lt;Script文件&gt; 每次更换磁带时，就执行指定的Script文件。<br>-g或--listed-incremental 处理GNU格式的大量备份。<br>-G或--incremental 处理旧的GNU格式的大量备份。<br>-h或--dereference 不建立符号连接，直接复制该连接所指向的原始文件。<br>-i或--ignore-zeros 忽略备份文件中的0 Byte区块，也就是EOF。<br>-k或--keep-old-files 解开备份文件时，不覆盖已有的文件。<br>-K&lt;文件&gt;或--starting-file=&lt;文件&gt; 从指定的文件开始还原。<br>-l或--one-file-system 复制的文件或目录存放的文件系统，必须与tar指令执行时所处的文件系统相同，否则不予复制。<br>-L&lt;媒体容量&gt;或-tape-length=&lt;媒体容量&gt; 设置存放每体的容量，单位以1024 Bytes计算。<br>-m或--modification-time 还原文件时，不变更文件的更改时间。<br>-M或--multi-volume 在建立，还原备份文件或列出其中的内容时，采用多卷册模式。<br>-N&lt;日期格式&gt;或--newer=&lt;日期时间&gt; 只将较指定日期更新的文件保存到备份文件里。<br>-o或--old-archive或--portability 将资料写入备份文件时使用V7格式。<br>-O或--stdout 把从备份文件里还原的文件输出到标准输出设备。<br>-p或--same-permissions 用原来的文件权限还原文件。<br>-P或--absolute-names 文件名使用绝对名称，不移除文件名称前的&quot;/&quot;号。<br>-r或--append 新增文件到已存在的备份文件的结尾部分。<br>-R或--block-number 列出每个信息在备份文件中的区块编号。<br>-s或--same-order 还原文件的顺序和备份文件内的存放顺序相同。<br>-S或--sparse 倘若一个文件内含大量的连续0字节，则将此文件存成稀疏文件。<br>-t或--list 列出备份文件的内容。<br>-T&lt;范本文件&gt;或--files-from=&lt;范本文件&gt; 指定范本文件，其内含有一个或多个范本样式，让tar解开或建立符合设置条件的文件。<br>-u或--update 仅置换较备份文件内的文件更新的文件。<br>-U或--unlink-first 解开压缩文件还原文件之前，先解除文件的连接。<br>-v或--verbose 显示指令执行过程。<br>-V&lt;卷册名称&gt;或--label=&lt;卷册名称&gt; 建立使用指定的卷册名称的备份文件。<br>-w或--interactive 遭遇问题时先询问用户。<br>-W或--verify 写入备份文件后，确认文件正确无误。<br>-x或--extract或--get 从备份文件中还原文件。<br>-X&lt;范本文件&gt;或--exclude-from=&lt;范本文件&gt; 指定范本文件，其内含有一个或多个范本样式，让ar排除符合设置条件的文件。<br>-z或--gzip或--ungzip 通过gzip指令处理备份文件。<br>-Z或--compress或--uncompress 通过compress指令处理备份文件。<br>-&lt;设备编号&gt;&lt;存储密度&gt; 设置备份用的外围设备编号及存放数据的密度。<br>--after-date=&lt;日期时间&gt; 此参数的效果和指定&quot;-N&quot;参数相同。<br>--atime-preserve 不变更文件的存取时间。<br>--backup=&lt;备份方式&gt;或--backup 移除文件前先进行备份。<br>--checkpoint 读取备份文件时列出目录名称。<br>--concatenate 此参数的效果和指定&quot;-A&quot;参数相同。<br>--confirmation 此参数的效果和指定&quot;-w&quot;参数相同。<br>--delete 从备份文件中删除指定的文件。<br>--exclude=&lt;范本样式&gt; 排除符合范本样式的文件。<br>--group=&lt;群组名称&gt; 把加入设备文件中的文件的所属群组设成指定的群组。<br>--help 在线帮助。<br>--ignore-failed-read 忽略数据读取错误，不中断程序的执行。<br>--new-volume-script=&lt;Script文件&gt; 此参数的效果和指定&quot;-F&quot;参数相同。<br>--newer-mtime 只保存更改过的文件。<br>--no-recursion 不做递归处理，也就是指定目录下的所有文件及子目录不予处理。<br>--null 从null设备读取文件名称。<br>--numeric-owner 以用户识别码及群组识别码取代用户名称和群组名称。<br>--owner=&lt;用户名称&gt; 把加入备份文件中的文件的拥有者设成指定的用户。<br>--posix 将数据写入备份文件时使用POSIX格式。<br>--preserve 此参数的效果和指定&quot;-ps&quot;参数相同。<br>--preserve-order 此参数的效果和指定&quot;-A&quot;参数相同。<br>--preserve-permissions 此参数的效果和指定&quot;-p&quot;参数相同。<br>--record-size=&lt;区块数目&gt; 此参数的效果和指定&quot;-b&quot;参数相同。<br>--recursive-unlink 解开压缩文件还原目录之前，先解除整个目录下所有文件的连接。<br>--remove-files 文件加入备份文件后，就将其删除。<br>--rsh-command=&lt;执行指令&gt; 设置要在远端主机上执行的指令，以取代rsh指令。<br>--same-owner 尝试以相同的文件拥有者还原文件。<br>--suffix=&lt;备份字尾字符串&gt; 移除文件前先行备份。<br>--totals 备份文件建立后，列出文件大小。<br>--use-compress-program=&lt;执行指令&gt; 通过指定的指令处理备份文件。<br>--version 显示版本信息。<br>--volno-file=&lt;编号文件&gt; 使用指定文件内的编号取代预设的卷册编号。<br></code></pre></td></tr></table></figure></li>
<li><p>创建归档，保留权限</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">tar -cpvf <span class="hljs-regexp">/PATH/</span><span class="hljs-keyword">FILE</span>.tar <span class="hljs-keyword">FILE</span>...<br></code></pre></td></tr></table></figure></li>
<li><p> 追加文件至归档： 注：不支持对压缩文件追加</p>
</li>
</ul>
  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">tar -rf <span class="hljs-regexp">/PATH/</span><span class="hljs-keyword">FILE</span>.tar <span class="hljs-keyword">FILE</span>...<br></code></pre></td></tr></table></figure>

<ul>
<li> 查看归档文件中的文件列表</li>
</ul>
  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">tar -t -f <span class="hljs-regexp">/PATH/</span><span class="hljs-keyword">FILE</span>.tar<br></code></pre></td></tr></table></figure>

<ul>
<li><p>(4) 展开归档</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">tar xf <span class="hljs-regexp">/PATH/</span><span class="hljs-keyword">FILE</span>.tar<br>tar xf <span class="hljs-regexp">/PATH/</span><span class="hljs-keyword">FILE</span>.tar -C <span class="hljs-regexp">/PATH/</span><br></code></pre></td></tr></table></figure></li>
<li><p>(5) 结合压缩工具实现：归档并压缩</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-z 相当于gzip压缩工具</span><br><span class="hljs-deletion">-j 相当于bzip2压缩工具</span><br><span class="hljs-deletion">-J 相当于xz压缩工具</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例1: 文件打包并压缩</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:05:01 root@localhost data]<span class="hljs-comment">#tar zcvf etc.tar.gz /etc/</span><br>[13:05:28 root@localhost data]<span class="hljs-comment">#ll /data/etc.tar.gz </span><br>-rw-r--r--. 1 root root 6568976 8月   8 13:04 /data/etc.tar.gz<br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:07:35 root@localhost data]<span class="hljs-comment">#tar jcvf etc.tar.bz2 /etc/</span><br>[13:08:01 root@localhost data]<span class="hljs-comment">#ll etc.tar.bz2 </span><br>-rw-r--r--. 1 root root 4821812 8月   8 13:08 etc.tar.bz2<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:08:20 root@localhost data]<span class="hljs-comment">#tar Jcvf etc.tar.xz /etc/</span><br>[13:13:52 root@localhost data]<span class="hljs-comment">#ll /data/etc.tar.bz2 </span><br>-rw-r--r--. 1 root root 4821812 8月   8 13:08 /data/etc.tar.bz2<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：解压</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[13:23:53 root@localhost data]<span class="hljs-comment">#tar xf etc.tar.gz -C ./</span><br>[13:24:24 root@localhost data]<span class="hljs-comment">#ls</span><br>etc  etc.tar.bz2  etc.tar.gz  etc.tar.xz  etc.zip<br>[13:24:28 root@localhost data]<span class="hljs-comment">#ll</span><br>总用量 229620<br>drwxr-xr-x. 148 root root      8192 8月   8 10:40 etc<br>-rw-r--r--.   1 root root   4821812 8月   8 13:08 etc.tar.bz2<br>-rw-r--r--.   1 root root   6568976 8月   8 13:04 etc.tar.gz<br>-rw-r--r--.   1 root root   4086148 8月   8 13:09 etc.tar.xz<br>-rw-r--r--.   1 root root 219634037 8月   8 12:50 etc.zip<br><br></code></pre></td></tr></table></figure></li>
<li><p>案例3：只打包目录内的文件，不所括目录本身</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#方法1</span><br>[root@centos8 ~]<span class="hljs-comment">#cd /etc</span><br>[root@centos8 etc]<span class="hljs-comment">#tar zcvf /root/etc.tar.gz ./</span><br><span class="hljs-comment">#方法2</span><br>[root@centos8 ~]<span class="hljs-comment">#tar -C /etc -zcf etc.tar.gz ./</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例4：排除打包目录的文件并压缩</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar zcvf /root/a.tgz --exclude=/app/host1 --exclude=/app/host2 /app<br></code></pre></td></tr></table></figure></li>
<li><p>案例5：</p>
<ul>
<li>-T 选项指定输入文件</li>
<li>-X 选项指定包含要排除的文件列表</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar zcvf mybackup.tgz -T /root/includefilelist -X /root/excludefilelist<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-5-6-2-split"><a href="#2-5-6-2-split" class="headerlink" title="2.5.6.2. split"></a>2.5.6.2. split</h4><ul>
<li><p>说明：split 命令可以分割一个文件为多个文件</p>
</li>
<li><p>案例</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">#分割大的 tar 文件为多份小文件<br>split -b Size –d tar-file-name prefix-name<br>示例:<br>split -b 1M mybackup.tgz mybackup-parts<br>#切换成的多个小分文件使用数字后缀<br>split -b 1M –d mybackup.tgz mybackup-parts<br></code></pre></td></tr></table></figure></li>
<li><p>将多个切割的小文件合并成一个大文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> my<span class="hljs-built_in">backup-parts</span>* &gt; mybackup.tar.gz<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-6-文本处理三剑客之sed"><a href="#2-6-文本处理三剑客之sed" class="headerlink" title="2.6. 文本处理三剑客之sed"></a>2.6. 文本处理三剑客之sed</h2><p><img src="image-20220808133324301.png" srcset="/img/loading.gif" lazyload alt="image-20220808133324301"></p>
<ul>
<li><p>说明：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Sed</span>是从文件或管道中读取一行，处理一行，输出一行；再读取一行，再处理一行，再输出一行，直到<br>最后一行。每当处理一行时，把当前处理的行存储在临时缓冲区中，称为模式空间（<span class="hljs-built_in">Pattern</span><br><span class="hljs-built_in">Space</span>），接着用<span class="hljs-variable">sed</span>命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下<br>一行，这样不断重复，直到文件末尾。一次处理一行的设计模式使得<span class="hljs-variable">sed</span>性能很高，<span class="hljs-variable">sed</span>在读取大文件时<br>不会出现卡顿的现象。如果使用<span class="hljs-variable">vi</span>命令打开几十<span class="hljs-variable">M</span>上百<span class="hljs-variable">M</span>的文件，明显会出现有卡顿的现象，这是因为<br><span class="hljs-variable">vi</span>命令打开文件是一次性将文件加载到内存，然后再打开。<span class="hljs-variable">Sed</span>就避免了这种情况，一行一行的处理，<br>打开速度非常快，执行速度也很快<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-6-1-sed-基本用法"><a href="#2-6-1-sed-基本用法" class="headerlink" title="2.6.1. sed 基本用法"></a>2.6.1. sed 基本用法</h3><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">sed [option]... &#x27;script;script;...&#x27; [inputfile...]<br></code></pre></td></tr></table></figure></li>
<li><p>常用选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">-n 不输出模式空间内容到屏幕，即不自动打印<br>-e 多点编辑<br>-f FILE 从指定文件中读取编辑脚本<br>-r, -E 使用扩展正则表达式<br>-i.bak 备份文件并原处编辑<br>-s 将多个文件视为独立文件，而不是单个连续的长文件流<br><span class="hljs-comment">#说明:</span><br>-ir 不支持<br>-i -r 支持<br>-ri 支持<br>-ni 危险选项,会清空文件<br></code></pre></td></tr></table></figure></li>
<li><p>script 格式：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;地址命令</span>&#x27;<br></code></pre></td></tr></table></figure></li>
<li><p>地址格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">1. 不给地址：对全文进行处理<br>2. 单地址：<br><span class="hljs-comment">#：指定的行，$：最后一行</span><br>/pattern/：被此处模式所能够匹配到的每一行<br>3. 地址范围：<br><span class="hljs-comment">#,# #从#行到第#行，3，6 从第3行到第6行</span><br><span class="hljs-comment">#,+# #从#行到+#行，3,+4 表示从3行到第7行</span><br>/pat1/,/pat2/<br><span class="hljs-comment">#,/pat/</span><br>/pat/,<span class="hljs-comment">#</span><br>4. 步进：~<br>1~2 奇数行<br>2~2 偶数行<br></code></pre></td></tr></table></figure></li>
<li><p>命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">p 打印当前模式空间内容，追加到默认输出之后<br>Ip 忽略大小写输出<br>d 删除模式空间匹配的行，并立即启用下一轮循环<br>a [\]text 在指定行后面追加文本，支持使用\n实现多行追加<br>i [\]text 在行前面插入文本<br>c [\]text 替换行为单行或多行文本<br>w file 保存模式匹配的行至指定文件<br>r file 读取指定文件的文本至模式空间中匹配到的行后<br>= 为模式空间中的行打印行号<br>! 模式空间中匹配行取反处理<br>q 结束或退出sed<br></code></pre></td></tr></table></figure></li>
<li><p>查找替代</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">s<span class="hljs-regexp">/pattern/</span>string/修饰符 查找替换,支持使用其它分隔符，可以是其它形式：s@@@，s<span class="hljs-comment">###</span><br>替换修饰符：<br>g 行内全局替换<br>p 显示替换成功的行<br>w <span class="hljs-regexp">/PATH/</span>FILE 将替换成功的行保存至文件中<br>I,i 忽略大小写<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-7-文本处理三剑客之sed高有用法"><a href="#2-7-文本处理三剑客之sed高有用法" class="headerlink" title="2.7. 文本处理三剑客之sed高有用法"></a>2.7. 文本处理三剑客之sed高有用法</h2><h1 id="3-shell编程基础"><a href="#3-shell编程基础" class="headerlink" title="3. shell编程基础"></a>3. shell编程基础</h1><h2 id="3-1-shell编程基础"><a href="#3-1-shell编程基础" class="headerlink" title="3.1. shell编程基础"></a>3.1. shell编程基础</h2><h3 id="3-1-1-shell脚本编程"><a href="#3-1-1-shell脚本编程" class="headerlink" title="3.1.1. shell脚本编程"></a>3.1.1. shell脚本编程</h3><p>​    是基于过程式、解释执行的语言</p>
<h3 id="3-1-2-编程语言的基本结构"><a href="#3-1-2-编程语言的基本结构" class="headerlink" title="3.1.2. 编程语言的基本结构"></a>3.1.2. 编程语言的基本结构</h3><ul>
<li><p>各种系统命令的组合</p>
</li>
<li><p>数据存储：变量、数组</p>
</li>
<li><p>表达式：a + b</p>
</li>
<li><p>控制语句：if</p>
</li>
<li><p>shell脚本：包含一些命令或声明，并符合一定格式的文本文件</p>
</li>
<li><p>格式要求：首行shebang机制</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">#!/bin/bash<br>#!/usr/bin/python<br>#!/usr/bin/perl<br>#!/usr/bin/ruby<br>#!/usr/bin/lua<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-1-3-shell脚本的创建"><a href="#3-1-3-shell脚本的创建" class="headerlink" title="3.1.3. shell脚本的创建"></a>3.1.3. shell脚本的创建</h3><ul>
<li><p>第一步：使用文本编辑器来创建文本文件，第一行必须包括shell声明序列：注释开头#!</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">#!/bin/bash<br></code></pre></td></tr></table></figure></li>
<li><p>第二步：加执行权限，给予执行权限，在命令行上指定脚本的绝对或相对路径</p>
</li>
<li><p>第三步：运行脚本，直接运行解释器，将脚本作为解释器程序的参数运行</p>
</li>
</ul>
<h3 id="3-1-4-shell脚本注释规范"><a href="#3-1-4-shell脚本注释规范" class="headerlink" title="3.1.4. shell脚本注释规范"></a>3.1.4. shell脚本注释规范</h3><ol>
<li>第一行一般为调用使用的语言</li>
<li>程序名称，避免更改文件名为无法找到正确的文件</li>
<li>版本号</li>
<li>更改后的时间</li>
<li>作者相关信息</li>
<li>该程序的作用，及注意事项</li>
<li>最后是各版本的更新简要说明</li>
</ol>
<h3 id="3-1-5-第一个shell脚本"><a href="#3-1-5-第一个shell脚本" class="headerlink" title="3.1.5. 第一个shell脚本"></a>3.1.5. 第一个shell脚本</h3><ul>
<li><p>第一步：使用文本编辑器来创建文本文件，第一行必须包括shell声明序列：注释开头#!</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">#!/bin/bash<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-1-6-shell脚本注释规范"><a href="#3-1-6-shell脚本注释规范" class="headerlink" title="3.1.6. shell脚本注释规范"></a>3.1.6. shell脚本注释规范</h3><ol>
<li>第一行一般为调用使用的语言</li>
<li>程序名称，避免更改文件名为无法找到正确的文件</li>
<li>版本号</li>
<li>更改后的时间</li>
<li>作者相关信息</li>
<li>该程序的作用，及注意事项</li>
<li>最后是各版本的更新简要说明</li>
</ol>
<h3 id="3-1-7-第一个shell脚本"><a href="#3-1-7-第一个shell脚本" class="headerlink" title="3.1.7. 第一个shell脚本"></a>3.1.7. 第一个shell脚本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:34:44 root@localhost ~]<span class="hljs-comment">#vim  hello.sh</span><br><br>  1 <span class="hljs-comment">#!/bin/bash</span><br>  2 <span class="hljs-comment">#Author:张雪龙</span><br>  3 <span class="hljs-comment">#2022-08-06 01:37:12</span><br>  4 <span class="hljs-comment"># mail: 1024320609@qq.com</span><br>  5 <span class="hljs-comment">#############################</span><br>  6 <br>  7 <span class="hljs-comment">#经典写法</span><br>  8 <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello, world&quot;</span><br>  9 <span class="hljs-comment">#流行写法</span><br> 10 <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Hello, world!&#x27;</span><br><br></code></pre></td></tr></table></figure>

<h3 id="3-1-8-shell执行方法种类"><a href="#3-1-8-shell执行方法种类" class="headerlink" title="3.1.8. shell执行方法种类"></a>3.1.8. shell执行方法种类</h3><ol>
<li><p>bash + 脚本文件名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:43:24 root@localhost ~]<span class="hljs-comment">#bash hello.sh </span><br>hello, world<br>Hello, world!<br></code></pre></td></tr></table></figure></li>
<li><p>cat + 脚本文件名 |bash</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:47:26 root@localhost ~]<span class="hljs-comment">#cat hello.sh |bash</span><br>hello, world<br>Hello, world!<br></code></pre></td></tr></table></figure></li>
<li><p>bash &lt;  脚本文件名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:47:51 root@localhost ~]<span class="hljs-comment">#bash &lt; hello.sh </span><br>hello, world<br>Hello, world!<br></code></pre></td></tr></table></figure></li>
<li><p>chmod +x 脚本文件 ——》./脚本文件名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:48:20 root@localhost ~]<span class="hljs-comment">#ll hello.sh </span><br>-rw-r--r--. 1 root root 177 8月   6 01:39 hello.sh<br>[01:48:53 root@localhost ~]<span class="hljs-comment">#chmod +x hello.sh </span><br>[01:49:19 root@localhost ~]<span class="hljs-comment">#./hello.sh </span><br>hello, world<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="3-2-shell编程使用变量"><a href="#3-2-shell编程使用变量" class="headerlink" title="3.2. shell编程使用变量"></a>3.2. shell编程使用变量</h2><h3 id="3-2-1-变量"><a href="#3-2-1-变量" class="headerlink" title="3.2.1. 变量"></a>3.2.1. 变量</h3><p>表示命名的内存空间，将数据放在内存空间中，通过变量名引用，获取数据。</p>
<h3 id="3-2-2-变量类型："><a href="#3-2-2-变量类型：" class="headerlink" title="3.2.2. 变量类型："></a>3.2.2. 变量类型：</h3><ul>
<li><p>内置变量，如：PS1，PATH，UID，HOSTNAME，$$，BASHPID，PPID，$?，HISTSIZE</p>
</li>
<li><p>用户自定义变量</p>
</li>
<li><p>不同的变量存放的数据不同，决定了以下</p>
<ul>
<li>数据存储方式</li>
<li>参与的运算</li>
<li>表示的数据范围</li>
</ul>
</li>
<li><p>变量数据类型：</p>
<ul>
<li>字符</li>
<li>数值：整型、浮点型, bash 不支持浮点数</li>
</ul>
</li>
</ul>
<h3 id="3-2-3-Shell中变量命名法则"><a href="#3-2-3-Shell中变量命名法则" class="headerlink" title="3.2.3. Shell中变量命名法则"></a>3.2.3. Shell中变量命名法则</h3><ul>
<li>命名要求<ul>
<li>区分大小写</li>
<li>不能使程序中的保留字和内置变量：如：if, for</li>
<li>只能使用数字、字母及下划线，且不能以数字开头，注意：不支持短横线 “ - ”，和主机名相反</li>
</ul>
</li>
</ul>
<h3 id="3-2-4-命名习惯"><a href="#3-2-4-命名习惯" class="headerlink" title="3.2.4. 命名习惯"></a>3.2.4. 命名习惯</h3><ul>
<li>见名知义，用英文单词命名，并体现出实际作用，不要用简写，如：ATM</li>
<li>变量名大写</li>
<li>局部变量小写</li>
<li>函数名小写</li>
<li>大驼峰StudentFirstName,由多个单词组成，且每个单词的首字母是大写，其它小写</li>
<li>小驼峰studentFirstName ,由多个单词组成，第一个单词的首字母小写，后续每个单词的首字母是大写，其它小写</li>
<li>下划线: student_name</li>
</ul>
<h3 id="3-2-5-变量定义和引用"><a href="#3-2-5-变量定义和引用" class="headerlink" title="3.2.5. 变量定义和引用"></a>3.2.5. 变量定义和引用</h3><h3 id="变量的生效范围等标准划分变量类型"><a href="#变量的生效范围等标准划分变量类型" class="headerlink" title="变量的生效范围等标准划分变量类型"></a>变量的生效范围等标准划分变量类型</h3><ul>
<li>普通变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效</li>
<li>环境变量：生效范围为当前shell进程及其子进程</li>
<li>本地变量：生效范围为当前shell进程中某代码片断，通常指函数</li>
</ul>
<h3 id="3-2-6-变量赋值"><a href="#3-2-6-变量赋值" class="headerlink" title="3.2.6. 变量赋值"></a>3.2.6. 变量赋值</h3><ul>
<li><p>```HTTP<br>name=’value’</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>- value 可以是以下多种形式<br><br>  ```HTTP<br>  直接字串：<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;root&#x27;</span><br>  变量引用：<span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$USER</span>&quot;</span><br>  命令引用：<span class="hljs-attribute">name</span>=`COMMAND` 或者 <span class="hljs-attribute">name</span>=$(COMMAND)<br></code></pre></td></tr></table></figure></li>
<li><p>注意:变量赋值是临时生效，当退出终端后，变量会自动删除，无法持久保存，脚本中的变量会随着脚本结束，也会自动删除</p>
</li>
<li><p>变量引用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs HTTP">$name<br>$&#123;name&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>弱引用和强引用</p>
<ul>
<li>“$name” 弱引用，其中的变量引用会被替换为变量值</li>
<li>‘$name’ 强引用，其中的变量引用不会被替换为变量值，而保持原字符串</li>
</ul>
</li>
<li><p>范例：变量的各种赋值方式和引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">[02:54:02 root@localhost data]<span class="hljs-comment">#name=&#x27;zhang&#x27;</span><br>[03:22:57 root@localhost data]<span class="hljs-comment">#echo $name</span><br>zhang<br><br>[03:23:03 root@localhost data]<span class="hljs-comment">#echo I am $name</span><br>I am zhang<br><br>[03:23:25 root@localhost data]<span class="hljs-comment">#echo &quot;I am $name&quot;</span><br>I am zhang<br><br>[03:23:42 root@localhost data]<span class="hljs-comment">#echo &#x27;I am $name&#x27;</span><br>I am <span class="hljs-variable">$name</span><br><br>[03:23:50 root@localhost data]<span class="hljs-comment">#echo $USER</span><br>root<br>[03:25:40 root@localhost data]<span class="hljs-comment">#name=$USER</span><br>[03:26:08 root@localhost data]<span class="hljs-comment">#echo $name</span><br>root<br><br>[03:27:11 root@localhost data]<span class="hljs-comment">#USER=`whoami`</span><br>[03:27:37 root@localhost data]<span class="hljs-comment">#echo $USER</span><br>root<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="3-3-shell各种位置变量和状态变量"><a href="#3-3-shell各种位置变量和状态变量" class="headerlink" title="3.3. shell各种位置变量和状态变量"></a>3.3. shell各种位置变量和状态变量</h2><h3 id="3-3-1-位置变量"><a href="#3-3-1-位置变量" class="headerlink" title="3.3.1. 位置变量"></a>3.3.1. 位置变量</h3><ul>
<li><p>位置变量：在bash shell中内置的变量, 在脚本代码中调用通过命令行传递给脚本的参数</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$1</span>, $2, ... 对应第1个、第2个等参数，shift [n]换位置</span><br><span class="hljs-meta"><span class="hljs-keyword">$0</span> 命令本身,包括路径</span><br><span class="hljs-symbol">$</span>* 传递给脚本的所有参数，全部参数合为一个字符串<br><span class="hljs-symbol">$</span>@ 传递给脚本的所有参数，每个参数为独立字符串<br><span class="hljs-symbol">$</span># 传递给脚本的参数的个数<br>注意：<span class="hljs-symbol">$</span>@ <span class="hljs-symbol">$</span>* 只在被双引号包起来的时候才会有差异<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh">[01:48:53 root@localhost ~]<span class="hljs-comment">#bash /root/postion.sh 1 2 3 4 5 6 7 8 9 10 11 12</span><br>0st arg is /root/postion.sh<br>1st arg is 1<br>2st arg is 2<br>3st arg is 3<br>10st arg is 10<br>11st arg is 11<br>The number of arg is 12<br>All args are 1 2 3 4 5 6 7 8 9 10 11 12<br>All args are 1 2 3 4 5 6 7 8 9 10 11 12<br>The scriptname is postion.sh<br>[01:49:07 root@localhost ~]<span class="hljs-comment">#cat postion.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># **********************************************************</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># * Author        : 张雪龙</span><br><span class="hljs-comment"># * Email         : 1024320609@qq.com</span><br><span class="hljs-comment"># * Create time   : 2022-08-07 01:43</span><br><span class="hljs-comment"># * Filename      : postion.sh</span><br><span class="hljs-comment"># * Description   : </span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># **********************************************************</span><br><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;0st arg is <span class="hljs-variable">$0</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1st arg is <span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2st arg is <span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;3st arg is <span class="hljs-variable">$3</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10st arg is <span class="hljs-variable">$&#123;10&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;11st arg is <span class="hljs-variable">$&#123;11&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The number of arg is <span class="hljs-variable">$#</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All args are $*&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All args are <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The scriptname is `basename <span class="hljs-variable">$0</span>`&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>$*和$@的区别</p>
<ul>
<li><p>当$*和$@没有被引用的时候，它们确实没有什么区别，都会把位置参数当成一个个体。(我们最好不要使用，因为如果位置参数中带有空格或者通配符的情况下，可能结果会和我们想要的不一样)</p>
</li>
<li><p>“$<em>“   会把所有位置参数当成一个整体（或者说当成一个单词），如果没有位置参数，则”$</em>“为空，如果有两个位置参数并且IFS为空格时，”$*”相当于”$1 $2”</p>
</li>
<li><p>“$@” 会把所有位置参数当成一个单独的字段，如果没有位置参数（$#为0），则”$@”展开为空（不是空字符串，而是空列表），如果存在一个位置参数，则”$@”相当于”$1”，如果有两个参数，则”$@”相当于”$1” “$2”等等</p>
</li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 scripts]<span class="hljs-comment">#cat f1.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;f1.sh:all args are <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;f1.sh:all args are $*&quot;</span><br>./file.sh <span class="hljs-string">&quot;$*&quot;</span><br>[root@centos8 scripts]<span class="hljs-comment">#cat f2.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;f2.sh:all args are <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;f2.sh:all args are $*&quot;</span><br>./file.sh <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>[root@centos8 scripts]<span class="hljs-comment">#cat file.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;file.sh:1st arg is <span class="hljs-variable">$1</span>&quot;</span><br>[root@centos8 scripts]<span class="hljs-comment">#./f1.sh a b c</span><br>f1.sh:all args are a b c<br>f1.sh:all args are a b c<br>file.sh:1st arg is a b c<br>[root@centos8 scripts]<span class="hljs-comment">#./f2.sh a b c</span><br>f2.sh:all args are a b c<br>f2.sh:all args are a b c<br>file.sh:1st arg is a<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="3-3-2-退出状态码变量"><a href="#3-3-2-退出状态码变量" class="headerlink" title="3.3.2. 退出状态码变量"></a>3.3.2. 退出状态码变量</h3><ul>
<li><p><strong>$?</strong>  变量  保存状态码的相关数字，不同的值反应成功或失败，$?取值范例 0-255</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">$?的值为0 #代表成功<br>$?的值是1到255 #代表失败<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[02:04:25 root@localhost ~]<span class="hljs-comment">#ping 114.114.114.114 -c1 &gt;/dev/null </span><br>[02:05:16 root@localhost ~]<span class="hljs-comment">#echo $?</span><br>0<br></code></pre></td></tr></table></figure></li>
<li><p>用户可以在脚本中使用以下命令自定义退出状态码</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">exit [n]<br></code></pre></td></tr></table></figure>

<ul>
<li>注意：<ul>
<li>脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后面的数字</li>
<li>如果exit后面无数字,终止退出状态取决于exit命令前面命令执行结果</li>
<li>如果没有exit命令, 即未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后<br>一条命令的状态码</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3-4-shell编程算术和逻辑运算"><a href="#3-4-shell编程算术和逻辑运算" class="headerlink" title="3.4. shell编程算术和逻辑运算"></a>3.4. shell编程算术和逻辑运算</h2><h3 id="3-4-1-算数运算"><a href="#3-4-1-算数运算" class="headerlink" title="3.4.1. 算数运算"></a>3.4.1. 算数运算</h3><ul>
<li><p>说明</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">Shell</span><span class="language-bash">允许在某些情况下对算术表达式进行求值，比如：<span class="hljs-built_in">let</span>和<span class="hljs-built_in">declare</span> 内置命令，(( ))复合命令和算术扩展。求值以固定宽度的整数进行，不检查溢出，尽管除以0 被困并标记为错误。运算符及其优先级，关联性和值与C语言相同。以下运算符列表分组为等优先级运算符级别。级别按降序排列优先</span><br></code></pre></td></tr></table></figure>

<ul>
<li>注意：bash 只支持整数，不支持小数</li>
</ul>
</li>
<li><p>选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">+ - addition, subtraction<br>* / % multiplication, division, remainder, %表示取模，即取余数，示例：9%4=1，5%3=2<br>i++ i-- variable post-increment and post-decrement<br>++i --i variable pre-increment and pre-decrement<br>= *= /= %= += -= &lt;&lt;= &gt;&gt;= &amp;= ^= |= assignment<br>- + unary minus and plus<br>! ~ logical and bitwise negation<br>** exponentiation 乘方,即指数运算<br>&lt;&lt; &gt;&gt; left and right bitwise shifts<br>&lt;= &gt;= &lt; &gt; comparison<br>== != equality and inequality<br>&amp; bitwise AND<br>| bitwise OR<br>^ bitwise exclusive OR<br>&amp;&amp; logical AND<br>|| logical OR<br><span class="hljs-built_in">expr</span>?<span class="hljs-built_in">expr</span>:<span class="hljs-built_in">expr</span> conditional operator<br>expr1 , expr2 comma<br></code></pre></td></tr></table></figure>

<p>乘法符号有些场景中需要转</p>
</li>
<li><p>算术运算：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">(1) let var=算术表达式<br>(2) ((var=算术表达式)) 和上面等价<br>(3) var=$[算术表达式]<br>(4) var=$((算术表达式))<br>(5) var=$(expr arg1 arg2 arg3 ...)<br>(6) declare -i var = 数值<br>(7) echo &#x27;算术表达式&#x27; | bc<br></code></pre></td></tr></table></figure></li>
<li><p>内建的随机数生成器变量</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">$RANDOM 取值范围：0-32767<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#生成 0 - 49 之间随机数</span><br><span class="hljs-built_in">echo</span> $[<span class="hljs-variable">$RANDOM</span>%50]<br><span class="hljs-comment">#随机字体颜色</span><br>[root@centos8 ~]<span class="hljs-comment">#echo -e &quot;\033[1;$[RANDOM%7+31]mhello\033[0m&quot;</span><br>magedu<br></code></pre></td></tr></table></figure></li>
<li><p>增强型赋值</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">+= i+=10 相当于 i=i+10<br>-= i-=j 相当于 i=i-j<br>*=<br>/=<br>%=<br>++ i++,++i 相当于 i=i+1<br>-- i--,--i 相当于 i=i-1<br></code></pre></td></tr></table></figure></li>
<li><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#let i=10*2</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $i</span><br>20<br>[root@centos8 ~]<span class="hljs-comment">#((j=i+10))</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $j</span><br>30<br></code></pre></td></tr></table></figure></li>
<li><p>案例2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#自加3后自赋值</span><br><span class="hljs-built_in">let</span> count+=3<br>[root@centos8 ~]<span class="hljs-comment">#i=10</span><br>[root@centos8 ~]<span class="hljs-comment">#let i+=20 #相当于let i=i+20</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $i</span><br>30<br>[root@centos8 ~]<span class="hljs-comment">#j=20</span><br>[root@centos8 ~]<span class="hljs-comment">#let i*=j</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $i</span><br>600<br></code></pre></td></tr></table></figure></li>
<li><p>案例3</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#自增，自减</span><br><span class="hljs-built_in">let</span> var+=1<br><span class="hljs-built_in">let</span> var++<br><span class="hljs-built_in">let</span> var-=1<br><span class="hljs-built_in">let</span> var--<br>[root@centos8 ~]<span class="hljs-comment">#unset i j ; i=1; let j=i++; echo &quot;i=$i,j=$j&quot;</span><br>i=2,j=1<br>[root@centos8 ~]<span class="hljs-comment">#unset i j ; i=1; let j=++i; echo &quot;i=$i,j=$j&quot;</span><br>i=2,j=2<br></code></pre></td></tr></table></figure></li>
<li><p>案例4</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#expr 2 * 3</span><br><span class="hljs-built_in">expr</span>: syntax error: unexpected argument ‘anaconda-ks.cfg’<br>[root@centos8 ~]<span class="hljs-comment">#ls</span><br>anaconda-ks.cfg<br>[root@centos8 ~]<span class="hljs-comment">#expr 2 \* 3</span><br>6<br></code></pre></td></tr></table></figure></li>
<li><p>案例5</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#i=10</span><br>[root@centos8 ~]<span class="hljs-comment">#j=20</span><br>[root@centos8 ~]<span class="hljs-comment">#declare -i result=i*j</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $result</span><br>200<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-4-2-逻辑运行"><a href="#3-4-2-逻辑运行" class="headerlink" title="3.4.2. 逻辑运行"></a>3.4.2. 逻辑运行</h3><h4 id="3-4-2-1-与或非"><a href="#3-4-2-1-与或非" class="headerlink" title="3.4.2.1. 与或非"></a>3.4.2.1. 与或非</h4><p><img src="image-20220808211858098.png" srcset="/img/loading.gif" lazyload alt="image-20220808211858098"></p>
<ul>
<li><p>true, false</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">1,真<br>0,假<br>#注意,以上为二进制<br></code></pre></td></tr></table></figure></li>
<li><p>与：&amp; 和0相与结果为0，和1相与结果保留原值, 一假则假,全真才真为0</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">0 与 0 = 0<br>0 与 1 = 0<br>1 与 0 = 0<br>1 与 1 = 1<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@ubuntu1804 ~]<span class="hljs-comment">#x=$[2&amp;6]</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo $x</span><br>2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#x=$[7&amp;3]</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo $x</span><br>3<br></code></pre></td></tr></table></figure></li>
<li><p>或：| 和1相或结果为1，和0相或结果保留原值,一真则真,全假才假</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">0 或 0 = 0<br>0 或 1 = 1<br>1 或 0 = 1<br>1 或 1 = 1<br></code></pre></td></tr></table></figure></li>
<li><p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@ubuntu1804 ~]<span class="hljs-comment">#x=$[7|3]</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo $x</span><br>7<br>[root@ubuntu1804 ~]<span class="hljs-comment">#x=$[2|5]</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo $x</span><br>7<br></code></pre></td></tr></table></figure></li>
<li><p>非：！</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">! 1 = 0 ! true<br>! 0 = 1 ! false<br></code></pre></td></tr></table></figure></li>
<li><p>异或：^</p>
<ul>
<li>​    异或的两个值，相同为假，不同为真。两个数字X,Y异或得到结果Z，Z再和任意两者之一X异或，将得出另一个值Y</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">0 ^ 0 = 0<br>0 ^ 1 = 1<br>1 ^ 0 = 1<br>1 ^ 1 = 0<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#true</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#false</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#! true</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#! false</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-5-shell编程的条件组合"><a href="#3-5-shell编程的条件组合" class="headerlink" title="3.5. shell编程的条件组合"></a>3.5. shell编程的条件组合</h2><h3 id="3-5-1-第一种方式"><a href="#3-5-1-第一种方式" class="headerlink" title="3.5.1. 第一种方式"></a>3.5.1. 第一种方式</h3><ul>
<li><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[ EXPRESSION1 -a EXPRESSION2 ] <span class="hljs-comment">#并且，EXPRESSION1和EXPRESSION2都是真，结果才为真</span><br>[ EXPRESSION1 -o EXPRESSION2 ] <span class="hljs-comment">#或者，EXPRESSION1和EXPRESSION2只要有一个真，结果就为真</span><br>[ ! EXPRESSION ] <span class="hljs-comment">#取反</span><br></code></pre></td></tr></table></figure></li>
<li><p>说明： -a 和 -o 需要使用测试命令进行，[[ ]] 不支持</p>
</li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;/data/scrips/test.sh&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#ll /data/scrips/test.sh</span><br>-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh<br>[root@centos8 ~]<span class="hljs-comment">#[ -f $FILE -a -x $FILE ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#chmod +x /data/scripts/test.sh</span><br>[root@centos8 ~]<span class="hljs-comment">#ll /data/scripts/test.sh</span><br>-rwxr-xr-x 1 root root 382 Dec 23 09:32 /data/script40/test.sh<br><span class="hljs-comment">#并且</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -f $FILE -a -x $FILE ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#chmod -x /data/scripts/test.sh</span><br>[root@centos8 ~]<span class="hljs-comment">#ll /data/scripts/test.sh</span><br>-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh<br><span class="hljs-comment">#或者</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -f $FILE -o -x $FILE ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ -x $FILE ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br><span class="hljs-comment">#取反</span><br>[root@centos8 ~]<span class="hljs-comment">#[ ! -x $FILE ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#! [ -x $FILE ]</span><br>0<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-5-2-第二种方式"><a href="#3-5-2-第二种方式" class="headerlink" title="3.5.2. 第二种方式"></a>3.5.2. 第二种方式</h3><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">COMMAND1 &amp;&amp; COMMAND2 #并且，短路与，代表条件性的AND THEN<br>如果COMMAND1 成功,将执行COMMAND2,否则,将不执行COMMAND2<br>COMMAND1 || COMMAND2 #或者，短路或，代表条件性的OR ELSE<br>如果COMMAND1 成功,将不执行COMMAND2,否则,将执行COMMAND2<br>! COMMAND #非,取反<br>[root@centos7 ~]#[ $[RANDOM%6] -eq 0 ] &amp;&amp; rm -rf /* || echo &quot;click&quot;<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#test &quot;A&quot; = &quot;B&quot; &amp;&amp; echo &quot;Strings are equal&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#test &quot;A&quot;-eq &quot;B&quot; &amp;&amp; echo &quot;Integers are equal&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;A&quot; = &quot;B&quot; ] &amp;&amp; echo &quot;Strings are equal&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;$A&quot; -eq &quot;$B&quot; ] &amp;&amp; echo &quot;Integers are equal&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -f /bin/cat -a -x /bin/cat ] &amp;&amp; cat /etc/fstab</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -z &quot;$HOSTNAME&quot; -o &quot;$HOSTNAME&quot; = &quot;localhost.localdomain&quot; ]&amp;&amp;</span><br>hostname www.magedu.com<br>[root@centos8 ~]<span class="hljs-comment">#id wang &amp;&gt; /dev/null || useradd wang</span><br>[root@centos8 ~]<span class="hljs-comment">#id zhang &amp;&gt; /dev/null || useradd zhang</span><br>[root@centos8 ~]<span class="hljs-comment">#getent passwd zhang</span><br>zhang:x:1002:1002::/home/zhang:/bin/bash<br>[root@centos8 ~]<span class="hljs-comment">#grep -q no_such_user /etc/passwd || echo &#x27;No such user&#x27;</span><br>No such user<br></code></pre></td></tr></table></figure></li>
<li><p>案例2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#[ -f “$FILE” ] &amp;&amp; [[ “$FILE”=~ .*\.sh$ ]] &amp;&amp; chmod +x $FILE</span><br>[root@centos8 ~]<span class="hljs-comment">#ping -c1 -W1 172.16.0.1 &amp;&gt; /dev/null &amp;&amp; echo &#x27;172.16.0.1 is</span><br>up<span class="hljs-string">&#x27; || (echo &#x27;</span>172.16.0.1 is unreachable<span class="hljs-string">&#x27;; exit 1)</span><br><span class="hljs-string">172.16.0.1 is up</span><br><span class="hljs-string">[root@centos8 ~]#IP=10.0.0.111;ping -c1 -W1 $IP &amp;&gt; /dev/null &amp;&amp; echo $IP is up</span><br><span class="hljs-string">|| echo $IP is down</span><br><span class="hljs-string">10.0.0.111 is down</span><br><span class="hljs-string">[root@centos8 ~]#IP=10.0.0.1;ping -c1 -W1 $IP &amp;&gt; /dev/null &amp;&amp; echo $IP is up ||</span><br><span class="hljs-string">echo $IP is down</span><br><span class="hljs-string">10.0.0.1 is up</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例3：：&amp;&amp; 和 || 组合使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#NAME=wang; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot;</span><br>wang is exist<br>[root@centos8 ~]<span class="hljs-comment">#NAME=wange; id $NAME &amp;&gt; /dev/null || echo &quot;$NAME is not</span><br>exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wange is not exist</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wange; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot; ||</span><br><span class="hljs-string">echo &quot;</span><span class="hljs-variable">$NAME</span> is not exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wange is not exist</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wang; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot; ||</span><br><span class="hljs-string">echo &quot;</span><span class="hljs-variable">$NAME</span> is not exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wang is exist</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wang; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot; ||</span><br><span class="hljs-string">echo &quot;</span><span class="hljs-variable">$NAME</span> is not exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wang is exist</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wang; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null || echo &quot;</span><span class="hljs-variable">$NAME</span> is not exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">&amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wang is exist</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wange; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null || echo &quot;</span><span class="hljs-variable">$NAME</span> is not<br>exist<span class="hljs-string">&quot; &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">wange is not exist</span><br><span class="hljs-string">wange is exist</span><br><span class="hljs-string">#结论：如果&amp;&amp; 和 || 混合使用，&amp;&amp; 要在前，|| 放在后</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wange; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot; ||</span><br><span class="hljs-string">useradd <span class="hljs-variable">$NAME</span></span><br><span class="hljs-string">[root@centos8 ~]#id wange</span><br><span class="hljs-string">uid=1002(wange) gid=1002(wange) groups=1002(wange)</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wangge; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot; ||</span><br><span class="hljs-string">( useradd <span class="hljs-variable">$NAME</span>; echo <span class="hljs-variable">$NAME</span> is created )</span><br><span class="hljs-string">wangge is created</span><br><span class="hljs-string">[root@centos8 ~]#id wangge</span><br><span class="hljs-string">uid=1003(wangge) gid=1003(wangge) groups=1003(wangge)</span><br><span class="hljs-string">[root@centos8 ~]#NAME=wanggege; id <span class="hljs-variable">$NAME</span> &amp;&gt; /dev/null &amp;&amp; echo &quot;</span><span class="hljs-variable">$NAME</span> is exist<span class="hljs-string">&quot;</span><br><span class="hljs-string">|| &#123; useradd <span class="hljs-variable">$NAME</span>; echo <span class="hljs-variable">$NAME</span> is created; &#125;</span><br><span class="hljs-string">wanggege is created</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例4：网络状态判断</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /data/scripts/ping.sh</span><br>IP=172.16.0.1<br>ping -c1 -W1 <span class="hljs-variable">$IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$IP</span> is up&quot;</span> || &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$IP</span> is</span><br><span class="hljs-string">unreachable&quot;</span>; <span class="hljs-built_in">exit</span>; &#125;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Script is finished&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#bash /data/scripts/ping.sh</span><br>172.16.0.1 is up<br>Script is finished<br></code></pre></td></tr></table></figure></li>
<li><p>案例5</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#. /etc/os-release; [[ $ID == &quot;rocky&quot; ]] &amp;&amp; [[ $VERSION_ID ==</span><br>8* ]] &amp;&amp; <span class="hljs-built_in">echo</span> Rocky8 || <span class="hljs-built_in">echo</span> CentOS8<br>[root@rocky8 ~]<span class="hljs-comment">#. /etc/os-release; [[ $ID == &quot;rocky&quot; ]] &amp;&amp; [[ $VERSION_ID == 8*</span><br>]] &amp;&amp; <span class="hljs-built_in">echo</span> Rocky8 || <span class="hljs-built_in">echo</span> CentOS8<br>Rocky8<br></code></pre></td></tr></table></figure></li>
<li><p>案例6：磁盘空间的判断</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /data/script/disk_check.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br>WARNING=80<br>SPACE_USED=`<span class="hljs-built_in">df</span>|grep <span class="hljs-string">&#x27;^/dev/sd&#x27;</span>|<span class="hljs-built_in">tr</span> -s <span class="hljs-string">&#x27; &#x27;</span> %|<span class="hljs-built_in">cut</span> -d% -f5|<span class="hljs-built_in">sort</span> -nr|<span class="hljs-built_in">head</span> -1`<br>[ <span class="hljs-string">&quot;<span class="hljs-variable">$SPACE_USED</span>&quot;</span> -ge <span class="hljs-variable">$WARNING</span> ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;disk used is <span class="hljs-variable">$SPACE_USED</span>,will be full&quot;</span><br>| mail -s diskwaring root<br></code></pre></td></tr></table></figure></li>
<li><p>案例7：磁盘空间和Inode号的检查脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 scripts]<span class="hljs-comment">#cat disk_check.sh</span><br><br>WARNING=80<br>SPACE_USED=`<span class="hljs-built_in">df</span> | grep <span class="hljs-string">&#x27;^/dev/sd&#x27;</span>|grep -oE <span class="hljs-string">&#x27;[0-9]+%&#x27;</span>|<span class="hljs-built_in">tr</span> -d %| <span class="hljs-built_in">sort</span> -nr|<span class="hljs-built_in">head</span> -1`<br>INODE_USED=`<span class="hljs-built_in">df</span> -i | grep <span class="hljs-string">&#x27;^/dev/sd&#x27;</span>|grep -oE <span class="hljs-string">&#x27;[0-9]+%&#x27;</span>|<span class="hljs-built_in">tr</span> -d %| <span class="hljs-built_in">sort</span> -nr|<span class="hljs-built_in">head</span><br>-1`<br>[ <span class="hljs-string">&quot;<span class="hljs-variable">$SPACE_USED</span>&quot;</span> -gt <span class="hljs-variable">$WARNING</span> -o <span class="hljs-string">&quot;<span class="hljs-variable">$INODE_USED</span>&quot;</span> -gt <span class="hljs-variable">$WARNING</span> ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;DISK</span><br><span class="hljs-string">USED:<span class="hljs-variable">$SPACE_USED</span>%, INODE_USED:<span class="hljs-variable">$INODE_USED</span>,will be full&quot;</span> | mail -s <span class="hljs-string">&quot;DISK Warning&quot;</span><br>root@wangxiaochun.com<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-6-shell编程条件测试"><a href="#3-6-shell编程条件测试" class="headerlink" title="3.6. shell编程条件测试"></a>3.6. shell编程条件测试</h2><ul>
<li><p>测试：判断某需求是否满足，需要由测试机制来实现，专用的测试表达式需要由测试命令辅助完成测试过程，实现评估布尔声明，以便用在条件性环境下进行执行</p>
<ul>
<li>若真，则状态码变量 $? 返回0</li>
<li>若假，则状态码变量 $? 返回1</li>
</ul>
</li>
<li><p>条件测试命令</p>
<ul>
<li>test EXPRESSION</li>
<li>[ EXPRESSION ] #和test 等价，建议使用 [ ]</li>
<li>[[ EXPRESSION ]] 相关于增强版的 [ ], 支持[]的用法,且支持扩展正则表达式和通配符</li>
</ul>
</li>
<li><p>注意：EXPRESSION前后必须有空白字符</p>
</li>
<li><p>帮助</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#type [</span><br>[ is a shell <span class="hljs-built_in">builtin</span><br>[root@centos8 ~]<span class="hljs-comment">#help [</span><br>[: [ arg... ]<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-6-1-变量测试"><a href="#3-6-1-变量测试" class="headerlink" title="3.6.1. 变量测试"></a>3.6.1. 变量测试</h3><ul>
<li><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#判断 NAME 变量是否定义</span><br>[ -v NAME ]<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#unset x</span><br>[root@centos8 ~]<span class="hljs-comment">#test -v x</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#x=10</span><br>[root@centos8 ~]<span class="hljs-comment">#test -v x</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#y=</span><br>[root@centos8 ~]<span class="hljs-comment">#test -v y</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#注意 [ ] 中需要空格，否则会报下面错误</span><br>[root@centos8 ~]<span class="hljs-comment">#[-v name]</span><br>-bash: [-v: <span class="hljs-built_in">command</span> not found<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-6-2-数值测试"><a href="#3-6-2-数值测试" class="headerlink" title="3.6.2. 数值测试"></a>3.6.2. 数值测试</h3><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">-eq 是否等于<br>-ne 是否不等于<br>-gt 是否大于<br>-ge 是否大于等于<br>-lt 是否小于<br>-le 是否小于等于<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#i=10</span><br>[root@centos8 ~]<span class="hljs-comment">#j=8</span><br>[root@centos8 ~]<span class="hljs-comment">#[ $i -lt $j ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ $i -gt $j ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ i -gt j ]</span><br>-bash: [: i: <span class="hljs-built_in">integer</span> expression expected<br></code></pre></td></tr></table></figure></li>
<li><p>算术表达式比较</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">== 相等<br>!= 不相等<br>&lt;=<br>&gt;=<br>&lt;<br>&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#x=10;y=10;(( x == y ));echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#x=10;y=20;(( x == y ));echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#x=10;y=20;(( x != y ));echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#x=10;y=10;(( x != y ));echo $?</span><br>1<br></code></pre></td></tr></table></figure></li>
<li><p>案例2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#x=10;y=20;(( x &gt; y ));echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#x=10;y=20;(( x &lt; y ));echo $?</span><br>0<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-6-3-字符串测试"><a href="#3-6-3-字符串测试" class="headerlink" title="3.6.3. 字符串测试"></a>3.6.3. 字符串测试</h3><ul>
<li><p>test和 [ ] 字符串测试用法</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">-z STRING 字符串是否为空，没定义或空为真，不空为假，<br>-n STRING 字符串是否不空，不空为真，空为假<br>STRING 同上<br>STRING1 = STRING2 是否等于，注意 = 前后有空格<br>STRING1 != STRING2 是否不等于<br>&gt; ascii码是否大于ascii码<br>&lt; 是否小于<br></code></pre></td></tr></table></figure></li>
<li><p>[[]] 字符串测试用法</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">[[ expression ]] 用法<br>== 左侧字符串是否和右侧的PATTERN相同<br>注意:此表达式用于[[ ]]中，PATTERN为通配符<br>=~ 左侧字符串是否能够被右侧的正则表达式的PATTERN所匹配<br>注意: 此表达式用于[[ ]]中为扩展的正则表达式<br></code></pre></td></tr></table></figure></li>
<li><p>建议：当使用正则表达式或通配符使用[[ ]]，其它情况一般使用 [ ]</p>
</li>
<li><p>案例:使用 [ ]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#unset str</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -z &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#str=&quot;&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -z &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#str=&quot; &quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -z &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ -n &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#unset str</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -n &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#str=magedu</span><br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#str=magedu</span><br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;$str&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#str1=magedu</span><br>[root@centos8 ~]<span class="hljs-comment">#str2=mage</span><br>[root@centos8 ~]<span class="hljs-comment">#[ $str1 = $str2 ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#str2=magedu</span><br>[root@centos8 ~]<span class="hljs-comment">#[ $str1 = $str2 ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：在比较字符串时，建议变量放在“ ”中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#[ &quot;$NAME&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#NAME=&quot;I love linux&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[ $NAME ]</span><br>-bash: [: love: binary operator expected<br>[root@centos8 ~]<span class="hljs-comment">#[ &quot;$NAME&quot; ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ I love linux ]</span><br>-bash: [: love: binary operator expected<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：[[ ]] 和通配符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;a*&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $FILE</span><br>a*<br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;ab&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;a*&quot;</span><br><span class="hljs-comment">#[[]]中如果不想使用通配符*,只想表达*本身,可以用&quot; &quot;引起来</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a&quot;*&quot; ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;ab&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a&quot;*&quot; ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br><span class="hljs-comment">#[[]]中如果不想使用通配符*,只想表达*本身,也可以使用转义符</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a\* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;a\b&quot;</span><br>[root@centos8 ~t]<span class="hljs-comment">#[[ $FILE == a\* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#FILE=&quot;a*&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ $FILE == a\* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#通配符?</span><br>[root@centos8 script]<span class="hljs-comment">#FILE=abc</span><br>[root@centos8 script]<span class="hljs-comment">#[[ $FILE == ??? ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 script]<span class="hljs-comment">#FILE=abcd</span><br>[root@centos8 script]<span class="hljs-comment">#[[ $FILE == ??? ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>1<br><span class="hljs-comment">#通配符</span><br>[root@centos8 ~]<span class="hljs-comment">#NAME=&quot;linux1&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$NAME&quot; == linux* ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$NAME&quot; == &quot;linux*&quot; ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#NAME=&quot;linux*&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$NAME&quot; == &quot;linux*&quot; ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#结论：[[ == ]] == 右侧的 * 做为通配符，不要加“”，只想做为*符号使用时, 需要加 “” 或转义</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例4：判断合理的考试成绩</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 script]<span class="hljs-comment">#SCORE=101</span><br>[root@centos8 script]<span class="hljs-comment">#[[ $SCORE =~ 100|[0-9]&#123;1,2&#125; ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 script]<span class="hljs-comment">#[[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 script]<span class="hljs-comment">#SCORE=10</span><br>[root@centos8 script]<span class="hljs-comment">#[[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 script]<span class="hljs-comment">#SCORE=abc</span><br>[root@centos8 script]<span class="hljs-comment">#[[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span><br>[root@centos8 script]<span class="hljs-comment">#echo $?</span><br>1<br></code></pre></td></tr></table></figure></li>
<li><p>案例5：使用 [[ ]] 判断文件后缀</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#通配符</span><br>[root@centos8 ~]<span class="hljs-comment">#FILE=test.log</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$FILE&quot; == *.log ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#FILE=test.txt</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$FILE&quot; == *.log ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$FILE&quot; != *.log ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#正则表达式</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$FILE&quot; =~ \.log$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#FILE=test.log</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$FILE&quot; =~ \.log$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br></code></pre></td></tr></table></figure></li>
<li><p>案例6：判断合法的非负整数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#N=100</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$N&quot; =~ ^[0-9]+$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#N=Magedu10</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$N&quot; =~ ^[0-9]+$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br></code></pre></td></tr></table></figure></li>
<li><p>案例7：判断合法IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#IP=1.2.3.4</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$IP&quot; =~ ^([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#IP=1.2.3.4567</span><br>[root@centos8 ~]<span class="hljs-comment">#[[ &quot;$IP&quot; =~ ^([0-9]&#123;1,3&#125;.)&#123;3&#125;[0-9]&#123;1,3&#125;$ ]]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[[ $IP =~ ^(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;</span><br>([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])$ ]]<br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br></code></pre></td></tr></table></figure></li>
<li><p>案例8</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 ~]<span class="hljs-comment">#cat check_ip.sh</span><br>IP=<span class="hljs-variable">$1</span><br>[[ <span class="hljs-variable">$IP</span> =~ ^(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]<br>&#123;2&#125;|2[0-4][0-9]|25[0-5])$ ]] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IP</span> is valid || <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IP</span> is invalid<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-6-4-文件测试"><a href="#3-6-4-文件测试" class="headerlink" title="3.6.4. 文件测试"></a>3.6.4. 文件测试</h3><ul>
<li><p>存在性测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http">-a FILE：同 -e<br>-e FILE: 文件存在性测试，存在为真，否则为假<br>-b FILE：是否存在且为块设备文件<br>-c FILE：是否存在且为字符设备文件<br>-d FILE：是否存在且为目录文件<br>-f FILE：是否存在且为普通文件<br>-h FILE 或 -L FILE：存在且为符号链接文件<br>-p FILE：是否存在且为命名管道文件<br>-S FILE：是否存在且为套接字文件<br></code></pre></td></tr></table></figure></li>
<li><p>案例：-e和-a 表示判断文件的存在性，建议使用-e</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#文件是否不存在</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -a /etc/nologin ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#! [ -a /etc/nologin ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#文件是否存在</span><br>[root@centos8 ~]<span class="hljs-comment"># [ -a /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br><span class="hljs-comment">#取反后结果却没有变化</span><br>[root@centos8 ~]<span class="hljs-comment"># [ ! -a /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#! [ -a /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br><span class="hljs-comment">#文件是否存在</span><br>[root@centos8 ~]<span class="hljs-comment">#! [ -e /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br><span class="hljs-comment">#此为推荐写法</span><br>[root@centos8 ~]<span class="hljs-comment">#[ ! -e /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ -d /etc ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ -d /etc/issue ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ -L /bin ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ -L /bin/ ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br></code></pre></td></tr></table></figure></li>
<li><p>文件权限测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">-r FILE：是否存在且可读<br>-w FILE: 是否存在且可写<br>-x FILE: 是否存在且可执行<br>-u FILE：是否存在且拥有suid权限<br>-g FILE：是否存在且拥有sgid权限<br>-k FILE：是否存在且拥有sticky权限<br></code></pre></td></tr></table></figure></li>
<li><p>注意：最终结果由用户对文件的实际权限决定，而非文件属性决定</p>
</li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#[ -w /etc/shadow ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#[ -x /etc/shadow ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#[ -w test.txt ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br>[root@centos8 ~]<span class="hljs-comment">#chattr +i test.txt</span><br>[root@centos8 ~]<span class="hljs-comment">#lsattr test.txt</span><br>----i-------------- nianling.txt<br>[root@centos8 ~]<span class="hljs-comment">#[ -w test.txt ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>1<br>[root@centos8 ~]<span class="hljs-comment">#chattr -i test.txt</span><br>[root@centos8 ~]<span class="hljs-comment">#[ -w test.txt ]</span><br>[root@centos8 ~]<span class="hljs-comment">#echo $?</span><br>0<br></code></pre></td></tr></table></figure></li>
<li><p>文件属性测试</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">-s FILE #是否存在且非空<br>-t fd #fd 文件描述符是否在某终端已经打开<br>-N FILE #文件自从上一次被读取之后是否被修改过<br>-O FILE #当前有效用户是否为文件属主<br>-G FILE #当前有效用户是否为文件属组<br>FILE1 -ef FILE2 #FILE1是否是FILE2的硬链接<br>FILE1 -nt FILE2 #FILE1是否新于FILE2（mtime）<br>FILE1 -ot FILE2 #FILE1是否旧于FILE2<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-7-shell编程for循环"><a href="#3-7-shell编程for循环" class="headerlink" title="3.7. shell编程for循环"></a>3.7. shell编程for循环</h2><ul>
<li>说明：将某代码段重复运行多次，通常有进入循环的条件和退出循环的条件<br>重复运行次数<ul>
<li>次数事先已知</li>
<li>循环次数事先未知</li>
</ul>
</li>
<li>常见的循环的命令：for, while, until</li>
</ul>
<p><img src="image-20220808214705263.png" srcset="/img/loading.gif" lazyload alt="image-20220808214705263"></p>
<h3 id="3-7-1-循环-for"><a href="#3-7-1-循环-for" class="headerlink" title="3.7.1. 循环 for"></a>3.7.1. 循环 for</h3><ul>
<li><p>帮助</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#CentOS7的for帮助比CentOS8全面</span><br>[root@centos7 ~]<span class="hljs-comment">#help for</span><br><span class="hljs-keyword">for</span>: <span class="hljs-keyword">for</span> NAME [<span class="hljs-keyword">in</span> WORDS ... ] ; <span class="hljs-keyword">do</span> COMMANDS; <span class="hljs-keyword">done</span><br>Execute commands <span class="hljs-keyword">for</span> each member <span class="hljs-keyword">in</span> a list.<br>The `<span class="hljs-keyword">for</span><span class="hljs-string">&#x27; loop executes a sequence of commands for each member in a</span><br><span class="hljs-string">list of items. If `in WORDS ...;&#x27;</span> is not present, <span class="hljs-keyword">then</span> `<span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><span class="hljs-string">&#x27; is</span><br><span class="hljs-string">assumed. For each element in WORDS, NAME is set to that element, and</span><br><span class="hljs-string">the COMMANDS are executed.</span><br><span class="hljs-string">Exit Status:</span><br><span class="hljs-string">Returns the status of the last command executed.</span><br><span class="hljs-string">for ((: for (( exp1; exp2; exp3 )); do COMMANDS; done</span><br><span class="hljs-string">Arithmetic for loop.</span><br><span class="hljs-string">Equivalent to</span><br><span class="hljs-string">(( EXP1 ))</span><br><span class="hljs-string">while (( EXP2 )); do</span><br><span class="hljs-string">COMMANDS</span><br><span class="hljs-string">(( EXP3 ))</span><br><span class="hljs-string">done</span><br><span class="hljs-string">EXP1, EXP2, and EXP3 are arithmetic expressions. If any expression is</span><br><span class="hljs-string">omitted, it behaves as if it evaluates to 1.</span><br><span class="hljs-string">Exit Status:</span><br><span class="hljs-string">Returns the status of the last command executed.</span><br><span class="hljs-string">[root@centos7 ~]#</span><br></code></pre></td></tr></table></figure></li>
<li><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> NAME [<span class="hljs-keyword">in</span> WORDS ... ] ; <span class="hljs-keyword">do</span> COMMANDS; <span class="hljs-keyword">done</span><br><span class="hljs-comment">#方式1</span><br><span class="hljs-keyword">for</span> 变量名 <span class="hljs-keyword">in</span> 列表;<span class="hljs-keyword">do</span><br>循环体<br><span class="hljs-keyword">done</span><br><span class="hljs-comment">#方式2</span><br><span class="hljs-keyword">for</span> 变量名 <span class="hljs-keyword">in</span> 列表<br><span class="hljs-keyword">do</span><br>循环体<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>执行机制：</p>
<ul>
<li>依次将列表中的元素赋值给“变量名”; 每次赋值后即执行一次循环体; 直到列表中的元素耗尽，循环结束</li>
<li>如果省略 [in WORDS … ] ，此时使用位置参数变量 in “$@”</li>
</ul>
</li>
<li><p>for 循环列表生成方式：</p>
<ul>
<li>直接给出列表</li>
<li>整数列表</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">&#123;start..end&#125;<br>$(seq [start [step]] end)<br></code></pre></td></tr></table></figure></li>
<li><p>返回列表的命令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">$(COMMAND)<br></code></pre></td></tr></table></figure></li>
<li><p>使用glob，如：*.sh*</p>
</li>
<li><p>变量引用，如：$@，$*，$#</p>
</li>
<li><p>案例1：计算1+2+3+…+100 的结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#sum=0;for i in &#123;1..100&#125;;do let sum+=i;done ;echo sum=$sum</span><br><span class="hljs-built_in">sum</span>=5050<br>[root@centos8 ~]<span class="hljs-comment">#seq -s+ 100|bc5050</span><br>5050<br>[root@centos8 ~]<span class="hljs-comment">#echo &#123;1..100&#125;|tr &#x27; &#x27; +|bc</span><br>5050<br>[root@centos8 ~]<span class="hljs-comment">#seq 100|paste -sd +|bc</span><br>5050<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：100以内的奇数之和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#sum=0;for i in &#123;1..100..2&#125;;do let sum+=i;done;echo sum=$sum</span><br><span class="hljs-built_in">sum</span>=2500<br>[root@centos8 ~]<span class="hljs-comment">#seq -s+ 1 2 100| bc</span><br>2500<br>[root@centos8 ~]<span class="hljs-comment">#echo &#123;1..100..2&#125;|tr &#x27; &#x27; + | bc</span><br>2500<br></code></pre></td></tr></table></figure></li>
<li><p>案例3</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /data/scripts/for_sum.sh</span><br><br><span class="hljs-built_in">sum</span>=0<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $* ; <span class="hljs-keyword">do</span><br><span class="hljs-built_in">let</span> <span class="hljs-built_in">sum</span>+=i<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">sum</span>=<span class="hljs-variable">$sum</span><br>[root@centos8 ~]<span class="hljs-comment">#bash /data/scripts/for_sum.sh 1 2 3 4 5 6</span><br><span class="hljs-built_in">sum</span>=21<br></code></pre></td></tr></table></figure></li>
<li><p>案例4：批量创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat createuser.sh</span><br><br>[ <span class="hljs-variable">$#</span> -eq 0 ] &amp;&amp; &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Usage: createuser.sh USERNAME ...&quot;</span> ;<span class="hljs-built_in">exit</span> 1 ; &#125;<br><span class="hljs-keyword">for</span> user ;<span class="hljs-keyword">do</span><br><span class="hljs-built_in">id</span> <span class="hljs-variable">$user</span> &amp;&gt; /dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$user</span> is exist || &#123; useradd <span class="hljs-variable">$user</span> ; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$user</span><br>is created; &#125;<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例5：批量创建用户和并设置随机密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 script]<span class="hljs-comment">#cat user_for.sh</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..10&#125;;<span class="hljs-keyword">do</span><br>useradd user<span class="hljs-variable">$i</span><br>PASS=`<span class="hljs-built_in">cat</span> /dev/urandom | <span class="hljs-built_in">tr</span> -dc <span class="hljs-string">&#x27;[:alnum:]&#x27;</span> |<span class="hljs-built_in">head</span> -c12`<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PASS</span> | passwd --stdin user<span class="hljs-variable">$i</span> &amp;&gt; /dev/null<br><span class="hljs-built_in">echo</span> user<span class="hljs-variable">$i</span>:<span class="hljs-variable">$PASS</span> &gt;&gt; /data/user.log<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;user<span class="hljs-variable">$i</span> is created&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例6：九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 script]<span class="hljs-comment">#cat 9x9_for.sh</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..9&#125;;<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> <span class="hljs-variable">$i</span>`;<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;j&#125;</span>x<span class="hljs-variable">$&#123;i&#125;</span>=$[j*i]\t\c&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例7：实现九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#vim 9x9.sh</span><br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> &#123;1..9&#125;;<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> <span class="hljs-variable">$j</span>`;<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\E[1;$[RANDOM%7+31]m<span class="hljs-variable">$&#123;i&#125;</span>x<span class="hljs-variable">$&#123;j&#125;</span>=$[i*j]\E[0m\t\c&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">for</span>((i=1;i&lt;=9;i++));<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span>((j=1;j&lt;=i;j++));<span class="hljs-keyword">do</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;\E[1;$[RANDOM%7+31]m<span class="hljs-variable">$&#123;i&#125;</span>x<span class="hljs-variable">$&#123;j&#125;</span>=$[i*j]\E[0m\t&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;\n&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例8：倒状的九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@ubuntu1804 ~]<span class="hljs-comment">#cat 9x9_v2.sh</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..9&#125;;<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> `<span class="hljs-built_in">echo</span> $[10-<span class="hljs-variable">$i</span>]`);<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -ne <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;j&#125;</span>x`echo $[10-i]`=<span class="hljs-subst">$(((10-i)</span>*j))\t&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#bash 9x9_v2.sh</span><br>1x9=9 2x9=18 3x9=27 4x9=36 5x9=45 6x9=54 7x9=63 8x9=72 9x9=81<br>1x8=8 2x8=16 3x8=24 4x8=32 5x8=40 6x8=48 7x8=56 8x8=64<br>1x7=7 2x7=14 3x7=21 4x7=28 5x7=35 6x7=42 7x7=49<br>1x6=6 2x6=12 3x6=18 4x6=24 5x6=30 6x6=36<br>1x5=5 2x5=10 3x5=15 4x5=20 5x5=25<br>1x4=4 2x4=8 3x4=12 4x4=16<br>1x3=3 2x3=6 3x3=9<br>1x2=2 2x2=4<br>1x1=1<br></code></pre></td></tr></table></figure></li>
<li><p>案例9：：将指定目录下的文件所有文件的后缀改名为 bak 后缀</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /data/scripts/for_rename.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><br>DIR=/data/test<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$DIR</span> || &#123; <span class="hljs-built_in">echo</span> 无法进入 <span class="hljs-variable">$DIR</span>;<span class="hljs-built_in">exit</span> 1; &#125;<br><span class="hljs-keyword">for</span> FILE <span class="hljs-keyword">in</span> * ;<span class="hljs-keyword">do</span><br>PRE=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$FILE</span>|grep -Eo <span class="hljs-string">&quot;.*\.&quot;</span>`<br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$FILE</span> <span class="hljs-variable">$&#123;PRE&#125;</span>bak<br><span class="hljs-comment"># PRE=`echo $FILE|rev|cut -d. -f 2-|rev`</span><br><span class="hljs-comment"># PRE=`echo $FILE | sed -nr &#x27;s/(.*)\.([^.]+)$/\1/p&#x27;</span><br><span class="hljs-comment"># SUFFIX=`echo $FILE | sed -nr &#x27;s/(.*)\.([^.]+)$/\2/p&#x27;`</span><br><span class="hljs-comment"># mv $FILE $PRE.bak</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例9：要求将目录YYYY-MM-DD/中所有文件，移动到YYYY-MM/DD/下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat for_dir.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br>PDIR=/data/test<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..365&#125;;<span class="hljs-keyword">do</span><br>DIR=`<span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;-<span class="hljs-variable">$i</span> day&quot;</span> +%F`<br><span class="hljs-built_in">mkdir</span> -pv <span class="hljs-variable">$PDIR</span>/<span class="hljs-variable">$DIR</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$PDIR</span>/<span class="hljs-variable">$DIR</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> &#123;1..10&#125;;<span class="hljs-keyword">do</span><br><span class="hljs-built_in">touch</span> <span class="hljs-variable">$RANDOM</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment">#2.将上面的目录移动到YYYY-MM/DD/下</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br>DIR=/data/test<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$DIR</span> || &#123; <span class="hljs-built_in">echo</span> 无法进入 <span class="hljs-variable">$DIR</span>;<span class="hljs-built_in">exit</span> 1; &#125;<br><span class="hljs-keyword">for</span> subdir <span class="hljs-keyword">in</span> * ;<span class="hljs-keyword">do</span><br>YYYY_MM=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$subdir</span> |<span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot;-&quot;</span> -f1,2`<br>DD=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$subdir</span> |<span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot;-&quot;</span> -f3`<br>[ -d <span class="hljs-variable">$YYYY_MM</span>/<span class="hljs-variable">$DD</span> ] || <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$YYYY_MM</span>/<span class="hljs-variable">$DD</span> &amp;&gt; /dev/null<br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$subdir</span>/* <span class="hljs-variable">$YYYY_MM</span>/<span class="hljs-variable">$DD</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$DIR</span>/*-*-*<br></code></pre></td></tr></table></figure></li>
<li><p>案例10：扫描一个网段：10.0.0.0/24，判断此网段中主机在线状态，将在线的主机的IP打印出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment">#cat /data/scripts/for_scan_host.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br>NET=10.0.0<br><span class="hljs-keyword">for</span> ID <span class="hljs-keyword">in</span> &#123;1..254&#125;;<span class="hljs-keyword">do</span><br>&#123;<br>ping -c1 -W1 <span class="hljs-variable">$NET</span>.<span class="hljs-variable">$ID</span> &amp;&gt; /dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$NET</span>.<span class="hljs-variable">$ID</span> is up| <span class="hljs-built_in">tee</span> -a<br>host_list.log || <span class="hljs-built_in">echo</span> <span class="hljs-variable">$NET</span>.<span class="hljs-variable">$ID</span> is down<br>&#125;&amp;<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">wait</span><br></code></pre></td></tr></table></figure></li>
<li><p>格式2</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">双小括号方法，即((…))格式，也可以用于算术运算，双小括号方法也可以使bash Shell实现C语言风格<br>的变量操作<br>I=10;((I++))<br></code></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">for ((: for (( exp1; exp2; exp3 )); do COMMANDS; done<br>for ((控制变量初始化;条件判断表达式;控制变量的修正表达式))<br>do<br>循环体<br>done<br></code></pre></td></tr></table></figure>

<p><img src="image-20220808220000419.png" srcset="/img/loading.gif" lazyload alt="image-20220808220000419"></p>
</li>
<li><p>控制变量初始化：仅在运行到循环代码段时执行一次</p>
</li>
<li><p>控制变量的修正表达式：每轮循环结束会先进行控制变量修正运算，而后再做条件判断</p>
</li>
<li><p>案例1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@ubuntu1804 ~]<span class="hljs-comment">#cat sum.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-keyword">for</span>((<span class="hljs-built_in">sum</span>=0,i=1;i&lt;=100;i++));<span class="hljs-keyword">do</span><br><span class="hljs-built_in">let</span> <span class="hljs-built_in">sum</span>+=i<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">sum</span>=<span class="hljs-variable">$sum</span><br><span class="hljs-keyword">for</span>((<span class="hljs-built_in">sum</span>=0,i=1;i&lt;=100;<span class="hljs-built_in">sum</span>+=i,i++));<span class="hljs-keyword">do</span><br><span class="hljs-literal">true</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">sum</span>=<span class="hljs-variable">$sum</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#bash sum.sh</span><br><span class="hljs-built_in">sum</span>=5050<br><span class="hljs-built_in">sum</span>=5050<br></code></pre></td></tr></table></figure></li>
<li><p>案例2九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#语法1实现</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..9&#125;;<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> `<span class="hljs-built_in">seq</span> <span class="hljs-variable">$i</span>`;<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;j&#125;</span>x<span class="hljs-variable">$i</span>=<span class="hljs-subst">$((j*i)</span>)\t\c&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment">#语法2实现</span><br><span class="hljs-keyword">for</span>((i=1;i&lt;10;i++));<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span>((j=1;j&lt;=i;j++));<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;j&#125;</span>x<span class="hljs-variable">$i</span>=<span class="hljs-subst">$((j*i)</span>)\t\c&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例3：等腰三角形</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 scripts]<span class="hljs-comment">#cat for_triangle.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入三角形的行数: &quot;</span> line<br><span class="hljs-keyword">for</span>((i=1;i&lt;=line;i++));<span class="hljs-keyword">do</span><br><span class="hljs-keyword">for</span>((k=0;k&lt;=line-i;k++));<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27; \c&#x27;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span>((j=1;j&lt;=2*i-1;j++));<span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27;*\c&#x27;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span><br><span class="hljs-keyword">done</span><br>[root@centos8 scripts]<span class="hljs-comment">#bash for_triangle.sh</span><br>请输入三角形的行数: 10<br>*<br>***<br>*****<br>*******<br>*********<br>***********<br>*************<br>***************<br>*****************<br>*******************<br>[root@centos8 scripts]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例4：生成进度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#for ((i = 0; i &lt;= 100; ++i)); do printf &quot;\e[4D%3d%%&quot; $i;sleep</span><br>0.1s; <span class="hljs-keyword">done</span><br>100%[root@centos8 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例5：</p>
<figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs leaf">[root@centos8 ~]<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">for</span><span class="hljs-params">((;;)</span></span>);do echo for;sleep 1;done<br>for<br>for<br>for<br>for<br>for<br>for<br>for<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="4-磁盘和存储管理"><a href="#4-磁盘和存储管理" class="headerlink" title="4. 磁盘和存储管理"></a>4. 磁盘和存储管理</h1><h2 id="4-1-磁盘类型和结构"><a href="#4-1-磁盘类型和结构" class="headerlink" title="4.1. 磁盘类型和结构"></a>4.1. 磁盘类型和结构</h2><h3 id="4-1-1-硬盘类型"><a href="#4-1-1-硬盘类型" class="headerlink" title="4.1.1. 硬盘类型"></a>4.1.1. 硬盘类型</h3><ul>
<li><p>硬盘接口类型</p>
<ul>
<li><p>IDE：133MB/s，并行接口，早期家用电脑</p>
</li>
<li><p>SCSI：640MB/s，并行接口，早期服务器</p>
</li>
<li><p>SATA：6Gbps，SATA数据端口与电源端口是分开的，即需要两条线，一条数</p>
<p>据线，一条电源线</p>
</li>
<li><p>SAS：6Gbps，SAS是一整条线，数据端口与电源端口是一体化的，SAS中是包含供电线的，而SATA中不包含供电线。SATA标准其实是SAS标准的一个子集，二者可兼容，SATA硬盘可以插入SAS主板上，反之不行</p>
</li>
<li><p>USB：480MB/s</p>
</li>
<li><p>M.2：</p>
</li>
</ul>
</li>
<li><p>注意：速度不是由单纯的接口类型决定，支持Nvme协议硬盘速度是最快的</p>
</li>
<li><p>服务器硬盘大小</p>
<ul>
<li>LFF：3.5寸，一般见到的那种台式机硬盘的大小</li>
<li>SFF：Small Form Factor 小形状因数，2.5寸，注意不同于2.5寸的笔记本硬盘</li>
</ul>
</li>
<li><p>L、S分别是大、小的意思，目前服务器或者盘柜采用sff规格的硬盘主要是考内虑增大单位密度内的磁盘容量、增强散热、减小功耗</p>
</li>
</ul>
<h3 id="4-1-2-磁盘结构"><a href="#4-1-2-磁盘结构" class="headerlink" title="4.1.2. 磁盘结构"></a>4.1.2. 磁盘结构</h3><ul>
<li><p>盘片</p>
<p><img src="image-20220808194202831.png" srcset="/img/loading.gif" lazyload alt="image-20220808194202831"></p>
</li>
<li><p>磁道、扇区：每个盘片被划分为一个个磁道，每个磁道又划分为一个个扇区</p>
<p><img src="image-20220808194327241.png" srcset="/img/loading.gif" lazyload alt="image-20220808194327241"></p>
</li>
<li><p>柱面</p>
<p><img src="image-20220808194419858.png" srcset="/img/loading.gif" lazyload alt="image-20220808194419858"></p>
</li>
</ul>
<h4 id="4-1-2-1-机械硬盘（HDD）"><a href="#4-1-2-1-机械硬盘（HDD）" class="headerlink" title="4.1.2.1. 机械硬盘（HDD）"></a>4.1.2.1. 机械硬盘（HDD）</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">即是传统普通硬盘，主要由：盘片，磁头，盘片转轴及控制电机，磁头控制器，数据转换器，接口，缓存等几个部分组成。机械硬盘中所有的盘片都装在一个旋转轴上，每张盘片之间是平行的，在每个盘片的存储面上有一个磁头，磁头与盘片之间的距离比头发丝的直径还小，所有的磁头联在一个磁头控制器上，由磁头控制器负责各个磁头的运动。磁头可沿盘片的半径<br>方向运动，加上盘片每分钟几千转的高速旋转，磁头就可以定位在盘片的指定位置上进行数据的读写操作。数据通过磁头由电磁流来改变极性方式被电磁流写到磁盘上，也可以通过相反方式读取。硬盘为精密设备，进入硬盘的空气必须过滤<br></code></pre></td></tr></table></figure>

<h4 id="4-1-2-2-固态硬盘（SSD）"><a href="#4-1-2-2-固态硬盘（SSD）" class="headerlink" title="4.1.2.2. 固态硬盘（SSD）"></a>4.1.2.2. 固态硬盘（SSD）</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">用固态电子存储芯片阵列而制成的硬盘，由控制单元和存储单<br>元（FLASH芯片、DRAM芯片）组成。固态硬盘在接口的规范和定义、功能及使用方法上与普通硬盘的完全相同，在产品外形和尺寸上也与普通硬盘一致<br>相较于HDD，SSD在防震抗摔、传输速率、功耗、重量、噪音上有明显优势，SSD传输速率性能是HDD的2倍,相较于SSD，HDD在价格、容量占有绝对优势<br>硬盘有价，数据无价，目前SSD不能完全取代HHD<br></code></pre></td></tr></table></figure>

<h4 id="4-1-2-3-硬盘存储术语-CHS"><a href="#4-1-2-3-硬盘存储术语-CHS" class="headerlink" title="4.1.2.3. 硬盘存储术语 CHS"></a>4.1.2.3. 硬盘存储术语 CHS</h4><ul>
<li>head：磁头 磁头数=盘面数</li>
<li>track：磁道 磁道=柱面数</li>
<li>sector：扇区，512bytes</li>
<li>cylinder：柱面 1柱面=512 * sector数/track<em>head数=512</em>63*255=7.84M<br>CentOS 5 之前版本 Linux 以柱面的整数倍划分分区，CentOS 6之后可以支持以扇区划分分区</li>
</ul>
<h2 id="4-2-分区类型MBR和GPT"><a href="#4-2-分区类型MBR和GPT" class="headerlink" title="4.2. 分区类型MBR和GPT"></a>4.2. 分区类型MBR和GPT</h2><h3 id="4-2-1-MBR分区"><a href="#4-2-1-MBR分区" class="headerlink" title="4.2.1. MBR分区"></a>4.2.1. MBR分区</h3><ul>
<li><p>说明MBR：Master Boot Record，1982年，使用32位表示扇区数，分区不超过2</p>
</li>
<li><p>T划分分区的单位：</p>
<ul>
<li><p>CentOS 5 之前按整柱面划分</p>
</li>
<li><p>CentOS 6 版本后可以按Sector划分</p>
</li>
</ul>
</li>
<li><p>0磁道0扇区：512bytes</p>
<ul>
<li>446bytes: boot loader 启动相关</li>
<li>64bytes：分区表，其中每16bytes标识一个分区</li>
<li>2bytes: 55AA，标识位</li>
</ul>
</li>
<li><p>MBR分区中一块硬盘最多有4个主分区，也可以3主分区+1扩展(N个逻辑分区)</p>
</li>
<li><p>MBR分区：主和扩展分区对应的1–4，/dev/sda3，逻辑分区从5开始，/dev/sda5</p>
</li>
<li><p>MBR分区结构</p>
<p><img src="image-20220808194838522.png" srcset="/img/loading.gif" lazyload alt="image-20220808194838522"></p>
</li>
</ul>
<h3 id="4-2-2-GPT分区"><a href="#4-2-2-GPT分区" class="headerlink" title="4.2.2. GPT分区"></a>4.2.2. GPT分区</h3><ul>
<li><p>说明</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">GPT：GUID（Globals <span class="hljs-keyword">Unique</span> Identifiers） <span class="hljs-keyword">partition</span> <span class="hljs-keyword">table</span> 支持<span class="hljs-number">128</span>个分区，使用<span class="hljs-number">64</span>位，支持<span class="hljs-number">8</span>Z（<span class="hljs-number">512</span>Byte/block ）<span class="hljs-number">64</span>Z （ <span class="hljs-number">4096</span>Byte/block）<br>使用<span class="hljs-number">128</span>位<span class="hljs-type">UUID</span>(Universally <span class="hljs-keyword">Unique</span> Identifier) 表示磁盘和分区 GPT分区表自动备份在头和尾两份，并有CRC校验位<br>UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以<br>启动<br></code></pre></td></tr></table></figure></li>
<li><p>GPT分区结构</p>
<p><img src="image-20220808195159631.png" srcset="/img/loading.gif" lazyload alt="image-20220808195159631"></p>
</li>
<li><p>GPT分区结构分为4个区域：</p>
<ul>
<li>GPT头</li>
<li>分区表</li>
<li>GPT分区</li>
<li>备份区域</li>
</ul>
</li>
</ul>
<h2 id="4-3-分区管理和文件系统类型"><a href="#4-3-分区管理和文件系统类型" class="headerlink" title="4.3. 分区管理和文件系统类型"></a>4.3. 分区管理和文件系统类型</h2><h3 id="4-3-1-分区管理"><a href="#4-3-1-分区管理" class="headerlink" title="4.3.1. 分区管理"></a>4.3.1. 分区管理</h3><ul>
<li><p>列出块设备</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">lsblk<br></code></pre></td></tr></table></figure></li>
<li><p>创建分区命令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">fdisk 管理MBR分区<br>gdisk 管理GPT分区<br>parted 高级分区操作，可以是交互或非交互方式<br></code></pre></td></tr></table></figure></li>
<li><p>注意：重新设置内存中的内核分区表版本，适合于除了CentOS 6 以外的其它版本 5，7，8</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">partprobe<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-3-1-1-parted-命令"><a href="#4-3-1-1-parted-命令" class="headerlink" title="4.3.1.1. parted 命令"></a>4.3.1.1. parted 命令</h4><ul>
<li><p>说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">parted的操作都是实时生效的，小心使用<br></code></pre></td></tr></table></figure></li>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">parted [选项]... [设备 [命令 [参数]...]...]<br></code></pre></td></tr></table></figure></li>
<li><p>案例1：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">parted /dev/sdb mklabel gpt|msdos<br>parted /dev/sdb print<br>parted /dev/sdb mkpart primary 1 200 （默认M）<br>parted /dev/sdb rm 1<br>parted -l 列出所有硬盘分区信息<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Error: /dev/sdb: unrecognised disk label<br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: unknown<br>Disk Flags:<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb mklabel gpt</span><br>Information: You may need to update /etc/fstab.<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags:<br>Number Start End Size File system Name Flags<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb mkpart primary 1 1001</span><br>Information: You may need to update /etc/fstab.<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags:<br>Number Start End Size File system Name Flags<br>1 1049kB 1001MB 1000MB primary<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb mkpart primary 1002 1102</span><br>Information: You may need to update /etc/fstab.<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags:<br>Number Start End Size File system Name Flags<br>1 1049kB 1001MB 1000MB primary<br>2 1002MB 1102MB 99.6MB primary<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb rm 2</span><br>Information: You may need to update /etc/fstab.<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags:<br>Number Start End Size File system Name Flags<br>1 1049kB 1001MB 1000MB primary<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb mklabel msdos</span><br>Warning: The existing disk label on /dev/sdb will be destroyed and all data on<br>this disk will be lost. Do you want to <span class="hljs-built_in">continue</span>?<br>Yes/No? Y<br>Information: You may need to update /etc/fstab.<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb print</span><br>Model: VMware, VMware Virtual S (scsi)<br>Disk /dev/sdb: 21.5GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: msdos<br>Disk Flags:<br>Number Start End Size Type File system Flags<br>[root@centos8 ~]<span class="hljs-comment">#parted /dev/sdb</span><br>GNU Parted 3.2<br>Using /dev/sdb<br>Welcome to GNU Parted! Type <span class="hljs-string">&#x27;help&#x27;</span> to view a list of commands.<br>(parted) <span class="hljs-built_in">help</span><br>align-check TYPE N check partition N <span class="hljs-keyword">for</span> TYPE(min|opt)<br>alignment<br><span class="hljs-built_in">help</span> [COMMAND] <span class="hljs-built_in">print</span> general <span class="hljs-built_in">help</span>, or <span class="hljs-built_in">help</span> on<br>COMMAND<br>mklabel,mktable LABEL-TYPE create a new disklabel (partition<br>table)<br>mkpart PART-TYPE [FS-TYPE] START END make a partition<br>name NUMBER NAME name partition NUMBER as NAME<br><span class="hljs-built_in">print</span> [devices|free|list,all|NUMBER] display the partition table,<br>available devices, free space, all found partitions, or a particular partition<br>quit <span class="hljs-built_in">exit</span> program<br>rescue START END rescue a lost partition near START<br>and END<br>resizepart NUMBER END resize partition NUMBER<br><span class="hljs-built_in">rm</span> NUMBER delete partition NUMBER<br>select DEVICE choose the device to edit<br>disk_set FLAG STATE change the FLAG on selected device<br>disk_toggle [FLAG] toggle the state of FLAG on selected<br>device<br><span class="hljs-built_in">set</span> NUMBER FLAG STATE change the FLAG on partition NUMBER<br>toggle [NUMBER [FLAG]] toggle the state of FLAG on partition<br>NUMBER<br>unit UNIT <span class="hljs-built_in">set</span> the default unit to UNIT<br>version display the version number and<br>copyright information of GNU Parted<br>(parted)<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-3-1-2-分区工具fdisk和gdisk"><a href="#4-3-1-2-分区工具fdisk和gdisk" class="headerlink" title="4.3.1.2. 分区工具fdisk和gdisk"></a>4.3.1.2. 分区工具fdisk和gdisk</h4><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">fdisk -l [-u] [device...] 查看分区<br>fdisk [device...] 管理MBR分区<br>gdisk [device...] 类fdisk 的GPT分区工具<br></code></pre></td></tr></table></figure></li>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">p 分区列表<br>t 更改分区类型<br>n 创建新分区<br>d 删除分区<br>v 校验分区<br>u 转换单位<br>w 保存并退出<br>q 不保存并退出<br></code></pre></td></tr></table></figure></li>
<li><p>查看内核是否已经识别新的分区</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">cat /proc/partitions<br></code></pre></td></tr></table></figure></li>
<li><p>CentOS 7,8 同步分区表:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">partprobe<br></code></pre></td></tr></table></figure></li>
<li><p>CentOS6 通知内核重新读取硬盘分区表</p>
<p>新增分区用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">partx -a /dev/DEVICE<br>kpartx -a /dev/DEVICE -f: force<br><br><span class="hljs-comment">#示例[root@centos6 ~]#partx -a /dev/sda</span><br></code></pre></td></tr></table></figure></li>
<li><p>删除分区用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">partx -d --nr M-N /dev/DEVICE<br>#示例：<br>[root@centos6 ~]#partx -d --nr 6-8 /dev/sda<br></code></pre></td></tr></table></figure></li>
<li><p>案例:非交互式创建分区</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">echo -e &#x27;n\np\n\n\n+2G\nw\n&#x27; | fdisk /dev/sdc<br></code></pre></td></tr></table></figure></li>
<li><p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#增加了6,7分区</span><br>[root@centos6 ~]<span class="hljs-comment">#fdisk /dev/sda</span><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br>The partition table has been altered!<br>Calling ioctl() to re-read partition table.<br>WARNING: Re-reading the partition table failed with error 16: Device or resource<br>busy.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.<br><span class="hljs-comment">#分区表不同步</span><br>[root@centos6 ~]<span class="hljs-comment">#lsblk</span><br>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sr0 11:0 1 3.7G 0 rom<br>sda 8:0 0 200G 0 disk<br>├─sda1 8:1 0 1G 0 part /boot<br>├─sda2 8:2 0 97.7G 0 part /<br>├─sda3 8:3 0 48.8G 0 part /data<br>├─sda4 8:4 0 1K 0 part<br>└─sda5 8:5 0 2G 0 part [SWAP]<br><span class="hljs-comment">#同步分区表</span><br>[root@centos6 ~]<span class="hljs-comment">#partx -a /dev/sda</span><br>BLKPG: Device or resource busy<br>error adding partition 1<br>BLKPG: Device or resource busy<br>error adding partition 2<br>BLKPG: Device or resource busy<br>error adding partition 3<br>BLKPG: Device or resource busy<br>error adding partition 4<br>BLKPG: Device or resource busy<br>error adding partition 5<br>[root@centos6 ~]<span class="hljs-comment">#lsblk</span><br>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sr0 11:0 1 3.7G 0 rom<br>sda 8:0 0 200G 0 disk<br>├─sda1 8:1 0 1G 0 part /boot<br>├─sda2 8:2 0 97.7G 0 part /<br>├─sda3 8:3 0 48.8G 0 part /data<br>├─sda4 8:4 0 1K 0 part<br>├─sda5 8:5 0 2G 0 part [SWAP]<br>├─sda6 8:6 0 2G 0 part<br>└─sda7 8:7 0 3G 0 part<br><span class="hljs-comment">#删除了6,7分区</span><br>[root@centos6 ~]<span class="hljs-comment">#fdisk /dev/sda</span><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br>The partition table has been altered!<br>Calling ioctl() to re-read partition table.<br>WARNING: Re-reading the partition table failed with error 16: Device or resource<br>busy.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.<br>[root@centos6 ~]<span class="hljs-comment">#</span><br>[root@centos6 ~]<span class="hljs-comment">#lsblk</span><br>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sr0 11:0 1 3.7G 0 rom<br>sda 8:0 0 200G 0 disk<br>├─sda1 8:1 0 1G 0 part /boot<br>├─sda2 8:2 0 97.7G 0 part /<br>├─sda3 8:3 0 48.8G 0 part /data<br>├─sda4 8:4 0 1K 0 part<br>├─sda5 8:5 0 2G 0 part [SWAP]<br>├─sda6 8:6 0 2G 0 part<br>└─sda7 8:7 0 3G 0 part<br><span class="hljs-comment">#同步分区表</span><br>[root@centos6 ~]<span class="hljs-comment">#partx -d --nr 6-7 /dev/sda</span><br>[root@centos6 ~]<span class="hljs-comment">#lsblk</span><br>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sr0 11:0 1 3.7G 0 rom<br>sda 8:0 0 200G 0 disk<br>├─sda1 8:1 0 1G 0 part /boot<br>├─sda2 8:2 0 97.7G 0 part /<br>├─sda3 8:3 0 48.8G 0 part /data<br>├─sda4 8:4 0 1K 0 part<br>└─sda5 8:5 0 2G 0 part [SWAP]<br></code></pre></td></tr></table></figure></li>
<li><p>范例: 批量创建分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#echo -e &#x27;n\np\n\n\n+1G\nw&#x27; | fdisk /dev/sdb</span><br>[root@centos8 ~]<span class="hljs-comment">#fdisk /dev/sdb &lt;&lt;EOF</span><br>n<br>p<br>+1G<br>w<br>EOF<br>[root@centos8 ~]<span class="hljs-comment">#lsblk /dev/sdb</span><br>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sdb 8:16 0 20G 0 disk<br>├─sdb1 8:17 0 1G 0 part<br>└─sdb2 8:18 0 1G 0 part<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-3-2-文件系统类型"><a href="#4-3-2-文件系统类型" class="headerlink" title="4.3.2. 文件系统类型"></a>4.3.2. 文件系统类型</h3><ul>
<li><p>说明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统。<br>从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取，安全控制，日志，压缩，加密等<br></code></pre></td></tr></table></figure></li>
<li><p>支持的文件系统：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/lib/modules/`uname -r`/kernel/fs<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-3-2-1-Linux-常用文件系统"><a href="#4-3-2-1-Linux-常用文件系统" class="headerlink" title="4.3.2.1. Linux 常用文件系统"></a>4.3.2.1. Linux 常用文件系统</h4><ul>
<li>ext2：Extended file system 适用于那些分区容量不是太大，更新也不频繁的情况，例如 /boot 分区</li>
<li>ext3：是 ext2 的改进版本，其支持日志功能，能够帮助系统从非正常关机导致的异常中恢复<br>ext4：是 ext 文件系统的最新版。提供了很多新的特性，包括纳秒级时间戳、创建和使用巨型文件(16TB)、最大1EB的文件系统，以及速度的提升</li>
<li>xfs：SGI，支持最大8EB的文件系统<br>swap</li>
<li>iso9660 光盘</li>
<li>btrfs（Oracle）</li>
<li>reiserfs</li>
</ul>
<h4 id="4-3-2-2-Windows-常用文件系统"><a href="#4-3-2-2-Windows-常用文件系统" class="headerlink" title="4.3.2.2. Windows 常用文件系统"></a>4.3.2.2. Windows 常用文件系统</h4><ul>
<li>FAT32</li>
<li>NTFS</li>
<li>exFAT</li>
</ul>
<h4 id="4-3-2-3-Unix："><a href="#4-3-2-3-Unix：" class="headerlink" title="4.3.2.3. Unix："></a>4.3.2.3. Unix：</h4><ul>
<li>FFS（fast）</li>
<li>UFS（unix）</li>
<li>JFS2</li>
</ul>
<h4 id="4-3-2-4-网络文件系统："><a href="#4-3-2-4-网络文件系统：" class="headerlink" title="4.3.2.4. 网络文件系统："></a>4.3.2.4. 网络文件系统：</h4><ul>
<li>NFS</li>
<li>CIFS</li>
</ul>
<h4 id="4-3-2-5-集群文件系统："><a href="#4-3-2-5-集群文件系统：" class="headerlink" title="4.3.2.5. 集群文件系统："></a>4.3.2.5. 集群文件系统：</h4><ul>
<li>GFS2</li>
<li>OCFS2（oracle）</li>
</ul>
<h4 id="4-3-2-6-分布式文件系统："><a href="#4-3-2-6-分布式文件系统：" class="headerlink" title="4.3.2.6. 分布式文件系统："></a>4.3.2.6. 分布式文件系统：</h4><ul>
<li>fastdfs</li>
<li>ceph<br>moosefs</li>
<li>mogilefs</li>
<li>glusterfs<br>Lustre</li>
</ul>
<h4 id="4-3-2-7-RAW："><a href="#4-3-2-7-RAW：" class="headerlink" title="4.3.2.7. RAW："></a>4.3.2.7. RAW：</h4><h4 id="4-3-2-8-裸文件系统-未经处理或者未经格式化产生的文件系统"><a href="#4-3-2-8-裸文件系统-未经处理或者未经格式化产生的文件系统" class="headerlink" title="4.3.2.8. 裸文件系统,未经处理或者未经格式化产生的文件系统"></a>4.3.2.8. 裸文件系统,未经处理或者未经格式化产生的文件系统</h4><h4 id="4-3-2-9-常用的文件系统特性："><a href="#4-3-2-9-常用的文件系统特性：" class="headerlink" title="4.3.2.9. 常用的文件系统特性："></a>4.3.2.9. 常用的文件系统特性：</h4><ul>
<li><p>FAT32</p>
<ul>
<li>最多只能支持16TB的文件系统和4GB的文件</li>
</ul>
</li>
<li><p>NTFS</p>
<ul>
<li>最多只能支持16EB的文件系统和16EB的文件</li>
</ul>
</li>
<li><p>EXT3</p>
<ul>
<li>最多只能支持32TB的文件系统和2TB的文件，实际只能容纳2TB的文件系统和16GB的文件</li>
<li>Ext3目前只支持32000个子目录</li>
<li>Ext3文件系统使用32位空间记录块数量和 inode数量</li>
<li>当数据写入到Ext3文件系统中时，Ext3的数据块分配器每次只能分配一个4KB的块</li>
</ul>
</li>
<li><p>EXT4：</p>
<ul>
<li>EXT4是Linux系统下的日志文件系统，是EXT3文件系统的后继版本</li>
<li>Ext4的文件系统容量达到1EB，而支持单个文件则达到16TB</li>
<li>理论上支持无限数量的子目录</li>
<li>Ext4文件系统使用64位空间记录块数量</li>
<li>和 inode数量<br>Ext4的多块分配器支持一次调用分配多个数据块</li>
<li>修复速度更快</li>
</ul>
</li>
<li><p>XFS</p>
<ul>
<li>根据所记录的日志在很短的时间内迅速恢复磁盘文件内容</li>
<li>用优化算法，日志记录对整体文件操作影响非常小</li>
<li>是一个全64-bit的文件系统，最大可以支持8EB的文件系统，而支持单个文件则达到8EB</li>
<li>能以接近裸设备I/O的性能存储数据</li>
</ul>
</li>
<li><p>查前支持的文件系统：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">cat /proc/filesystems<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-4-创建文件系统和挂载"><a href="#4-4-创建文件系统和挂载" class="headerlink" title="4.4. 创建文件系统和挂载"></a>4.4. 创建文件系统和挂载</h2><h3 id="4-4-1-创建文件系统"><a href="#4-4-1-创建文件系统" class="headerlink" title="4.4.1. 创建文件系统"></a>4.4.1. 创建文件系统</h3><ul>
<li><p>mkfs命令：</p>
<ul>
<li>(1) mkfs.FS_TYPE /dev/DEVICE</li>
<li>ext4</li>
<li>xfs</li>
<li>btrfs</li>
<li>vfat</li>
<li>(2) mkfs -t FS_TYPE /dev/DEVICE</li>
<li>-L ‘LABEL’ 设定卷标</li>
<li>mke2fs：ext系列文件系统专用管理工具</li>
</ul>
</li>
<li><p>常用选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http">-t &#123;ext2|ext3|ext4|xfs&#125; 指定文件系统类型<br>-b &#123;1024|2048|4096&#125; 指定块 block 大小<br>-L ‘LABEL’ 设置卷标<br>-j 相当于 -t ext3， mkfs.ext3 = mkfs -t ext3 = mke2fs -j = mke2fs -t ext3<br>-i # 为数据空间中每多少个字节创建一个inode；不应该小于block大<br>小<br>-N # 指定分区中创建多少个inode<br>-I 一个inode记录占用的磁盘空间大小，128---4096<br>-m # 默认5%,为管理人员预留空间占总空间的百分比<br>-O FEATURE[,...] 启用指定特性<br>-O ^FEATURE<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-4-2-挂载文件系统-mount"><a href="#4-4-2-挂载文件系统-mount" class="headerlink" title="4.4.2. 挂载文件系统 mount"></a>4.4.2. 挂载文件系统 mount</h3><ul>
<li><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">mount [-fnrsvw] [-t vfstype] [-o options] device mountpoint<br></code></pre></td></tr></table></figure></li>
<li><p>device：指明要挂载的设备</p>
<ul>
<li>设备文件：例如:/dev/sda5</li>
<li>卷标：-L ‘LABEL’, 例如 -L ‘MYDATA’</li>
<li>UUID： -U ‘UUID’：例如 -U ‘0c50523c-43f1-45e7-85c0-a126711d406e’</li>
<li>伪文件系统名称：proc, sysfs, devtmpfs, configfs</li>
</ul>
</li>
<li><p>mountpoint：挂载点目录必须事先存在，建议使用空目录</p>
</li>
<li><p>mount 常用命令选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http">-t fstype 指定要挂载的设备上的文件系统类型,如:ext4,xfs<br>-r readonly，只读挂载<br>-w read and write, 读写挂载,此为默认设置,可省略<br>-n 不更新/etc/mtab，mount不可见<br>-a 自动挂载所有支持自动挂载的设备(定义在了/etc/fstab文件中，且挂载选项中有<br>auto功能)<br>-L &#x27;LABEL&#x27; 以卷标指定挂载设备<br>-U &#x27;UUID&#x27; 以UUID指定要挂载的设备<br>-B, --bind 绑定目录到另一个目录上<br>-o options：(挂载文件系统的选项)，多个选项使用逗号分隔<br>async 异步模式,内存更改时,写入缓存区buffer,过一段时间再写到磁盘中，效率高，但不安全<br>sync 同步模式,内存更改时，同时写磁盘，安全，但效率低下<br>atime/noatime 包含目录和文件<br>diratime/nodiratime 目录的访问时间戳<br>auto/noauto 是否支持开机自动挂载，是否支持-a选项<br>exec/noexec 是否支持将文件系统上运行应用程序<br>dev/nodev 是否支持在此文件系统上使用设备文件<br>suid/nosuid 是否支持suid和sgid权限<br>remount 重新挂载<br>ro/rw 只读、读写<br>user/nouser 是否允许普通用户挂载此设备，/etc/fstab使用<br>acl/noacl 启用此文件系统上的acl功能<br>loop 使用loop设备<br>_netdev 当网络可用时才对网络资源进行挂载，如：NFS文件系统<br>defaults 相当于rw, suid, dev, exec, auto, nouser, async<br></code></pre></td></tr></table></figure></li>
<li><p>挂载规则:</p>
<ul>
<li>一个挂载点同一时间只能挂载一个设备</li>
<li>一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设</li>
<li>备上的数据将被隐藏</li>
<li>一个设备可以同时挂载到多个挂载点</li>
<li>通常挂载点一般是已存在空的目录</li>
</ul>
</li>
</ul>
<h2 id="4-5-永久挂载和swap管理"><a href="#4-5-永久挂载和swap管理" class="headerlink" title="4.5. 永久挂载和swap管理"></a>4.5. 永久挂载和swap管理</h2><h3 id="4-5-1-持久挂载"><a href="#4-5-1-持久挂载" class="headerlink" title="4.5.1. 持久挂载"></a>4.5.1. 持久挂载</h3><ul>
<li><p>说明：将挂载保存到 /etc/fstab 中可以下次开机时，自动启用挂载：</p>
</li>
<li><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">man 5 fstab<br>/etc/fstab<br></code></pre></td></tr></table></figure></li>
<li><p>每行定义一个要挂载的文件系统,，其中包括共 6 项</p>
<ul>
<li>要挂载的设备或伪文件系统<ul>
<li>设备文件</li>
<li>LABEL：LABEL=””</li>
<li>UUID：UUID=””</li>
<li>伪文件系统名称：proc, sysfs</li>
</ul>
</li>
<li>挂载点：必须是事先存在的目录</li>
<li>文件系统类型：ext4，xfs，iso9660，nfs，none</li>
<li>挂载选项：defaults ，acl，bind</li>
<li>转储频率：0：不做备份 1：每天转储 2：每隔一天转储</li>
<li>fsck检查的文件系统的顺序：允许的数字是0 1 2</li>
<li>0：不自检 ，1：首先自检；一般只有rootfs才用 2：非rootfs使用</li>
</ul>
</li>
<li><p>添加新的挂载项，需要执行下面命令生效</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">mount -a<br></code></pre></td></tr></table></figure></li>
<li><p>案例：：centos7, 8 /etc/fstab 的分区UUID错误，无法启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">自动进入emergency mode,输入root 密码<br><span class="hljs-comment">#cat /proc/mounts 可以查看到/ 以rw方式挂载</span><br><span class="hljs-comment">#vim /etc/fstab</span><br><span class="hljs-comment">#reboot</span><br></code></pre></td></tr></table></figure></li>
<li><p>案例2：centos 6 /etc/fstab 的分区UUID错误，无法启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">如果/etc/fstab 的挂载设备出错，比如文件系统故障，并且文件系统检测项（即第6项为非0），将导致无<br>法启动<br>自动进入emergency mode,输入root 密码<br><span class="hljs-comment">#cat /proc/mounts 可以查看到/ 以ro方式挂载，无法直接修改配置文件</span><br><span class="hljs-comment">#mount -o remount,rw /</span><br><span class="hljs-comment">#vim /etc/fstab</span><br>将故障行的最后1项，即第6项修改为0，开机不检测此项挂载设备的健康性，从而忽略错误，能实现启动<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：/etc/fstab格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /etc/fstab</span><br>UUID=cb7cae1e-d227-4f64-872b-cd6cce20c911 /data/mysql ext4 noatime<br>0 0<br>/disk.img /data/disk xfs loop<br>0 0<br>/etc /mnt/etc none <span class="hljs-built_in">bind</span><br>0 0<br>[root@centos6 ~]<span class="hljs-comment">#cat /etc/fstab</span><br>/disk.img /mnt/disk ext4 loop 0 0<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-5-2-swap管理"><a href="#4-5-2-swap管理" class="headerlink" title="4.5.2. swap管理"></a>4.5.2. swap管理</h3><ul>
<li><p>swap 介绍</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">swap交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据<br>时会将数据写入 swap 分区，当系统缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。配置过多 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露<br>注意：为优化性能，可以将swap 分布存放，或高性能磁盘存放<br></code></pre></td></tr></table></figure></li>
<li><p>Redhat 官方推荐推荐系统 swap 空间</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">https://access.redhat.com/documentation/zhcn/<br>red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioningsetup-<br>ppc#sect-recommended-partitioning-scheme-ppc<br></code></pre></td></tr></table></figure>

<p><img src="image-20220808202630521.png" srcset="/img/loading.gif" lazyload alt="image-20220808202630521"></p>
</li>
</ul>
<h4 id="4-5-2-1-交换分区实现过程"><a href="#4-5-2-1-交换分区实现过程" class="headerlink" title="4.5.2.1. 交换分区实现过程"></a>4.5.2.1. 交换分区实现过程</h4><ol>
<li>创建交换分区或者文件</li>
<li>使用mkswap写入特殊签名</li>
<li>在/etc/fstab文件中添加适当的条目</li>
<li>使用swapon -a 激活交换空间</li>
</ol>
<ul>
<li><p>启用swap分区</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">swapon [OPTION]... [DEVICE]<br></code></pre></td></tr></table></figure></li>
<li><p>选项</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">-a #激活所有的交换分区<br>-p PRIORITY #指定优先级(-1到32767之间)，值越大,优先级越高.也可在/etc/fstab文件中的第4列指<br>定：pri=value<br></code></pre></td></tr></table></figure></li>
<li><p>案例1：创建swap分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#echo -e &#x27;n\np\n\n\n+2G\nt\n82\nw\n&#x27; | fdisk /dev/sdc</span><br>[root@centos8 ~]<span class="hljs-comment">#mkswap /dev/sdc1</span><br>Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)<br>no label, UUID=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f<br>[root@centos8 ~]<span class="hljs-comment">#blkid /dev/sdc1</span><br>/dev/sdc1: UUID=<span class="hljs-string">&quot;d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f&quot;</span> TYPE=<span class="hljs-string">&quot;swap&quot;</span><br>PARTUUID=<span class="hljs-string">&quot;b094d43d-01</span><br><span class="hljs-string">[root@centos8 ~]#vim /etc/fstab</span><br><span class="hljs-string">UUID=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f swap swap defaults 0 0</span><br><span class="hljs-string">[root@centos8 ~]#swapon -a</span><br><span class="hljs-string">[root@centos8 ~]#free -h</span><br><span class="hljs-string">total used free shared buff/cache available</span><br><span class="hljs-string">Mem: 3.7Gi 264Mi 3.2Gi 9.0Mi 261Mi 3.2Gi</span><br><span class="hljs-string">Swap: 4.0Gi 0B 4.0Gi</span><br><span class="hljs-string">[root@centos8 ~]#cat /proc/swaps</span><br><span class="hljs-string">Filename Type Size Used Priority</span><br><span class="hljs-string">/dev/sda5 partition 2097148 0 -2</span><br><span class="hljs-string">/dev/sdc1 partition 2097148 0 -3</span><br></code></pre></td></tr></table></figure></li>
<li><p>禁用swap分区</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">swapoff [OPTION]... [DEVICE]<br></code></pre></td></tr></table></figure></li>
<li><p>案例2：禁用swap分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#sed -i.bak &#x27;/swap/d&#x27; /etc/fstab</span><br>[root@centos8 ~]<span class="hljs-comment">#swapoff -a</span><br></code></pre></td></tr></table></figure></li>
<li><p>SWAP的优先级</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">可以指定<span class="hljs-keyword">swap</span>分区<span class="hljs-number">0</span>到<span class="hljs-number">32767</span>的优先级，值越大优先级越高<br>如果用户没有指定，那么核心会自动给<span class="hljs-keyword">swap</span>指定一个优先级，这个优先级从<span class="hljs-number">-1</span>开始，每加入一个新的<br>没有用户指定优先级的<span class="hljs-keyword">swap</span>，会给这个优先级减一<br>先添加的<span class="hljs-keyword">swap</span>的缺省优先级比较高，除非用户自己指定一个优先级，而用户指定的优先级(是正数)永远<br>高于核心缺省指定的优先级(是负数)<br></code></pre></td></tr></table></figure></li>
<li><p>案例3：修改swap分区的优先级</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#cat /etc/fstab</span><br><span class="hljs-comment">#</span><br>UUID=acf9bd1f-caae-4e28-87be-e53afec61347 / xfs defaults<br>0 0<br>UUID=1770b87e-db5a-445e-bff1-1653ac64b3d6 /boot ext4 defaults<br>1 2<br>UUID=ffffd919-d674-44d9-a4e7-402874f0a1f0 /data xfs defaults<br>0 0<br>UUID=409e36d2-ac5e-423f-ad78-9b12db4576bd swap swap defaults<br>0 0<br>UUID=509ee336-6aec-48b0-b390-12c1f9889520 swap swap pri=100<br>0 0<br></code></pre></td></tr></table></figure></li>
<li><p>案例4：以文件实现swap功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#dd if=/dev/zero of=/swapfile bs=1M count=1024</span><br>[root@centos8 ~]<span class="hljs-comment">#mkswap /swapfile</span><br>[root@centos8 ~]<span class="hljs-comment">#blkid /swapfile &gt;&gt; /etc/fstab</span><br>[root@centos8 ~]<span class="hljs-comment">#/etc/fstab</span><br>/swapfile swap swap defaults 0 0 <span class="hljs-comment">#不要用</span><br>UUID,使用文件的路径<br>[root@centos8 ~]<span class="hljs-comment">#chmod 600 /swapfile</span><br>[root@centos8 ~]<span class="hljs-comment">#swapon -a</span><br>[root@centos8 ~]<span class="hljs-comment">#swapon -s</span><br>Filename Type Size Used Priority<br>/dev/sda5 partition 2097148 0 -2<br>/swapfile file 1048572 0 -3<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-5-2-2-swap的使用策略"><a href="#4-5-2-2-swap的使用策略" class="headerlink" title="4.5.2.2. swap的使用策略"></a>4.5.2.2. swap的使用策略</h4><ul>
<li><p>说明：/proc/sys/vm/swappiness 的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间</p>
</li>
<li><p>使用规则</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">当内存使用率达到<span class="hljs-number">100</span>-swappiness时,会启用交换分区<br>简单地说这个参数定义了系统对<span class="hljs-keyword">swap</span>的使用倾向，此值越大表示越倾向于使用<span class="hljs-keyword">swap</span>。<br>可以设为<span class="hljs-number">0</span>，这样做并不会禁止对<span class="hljs-keyword">swap</span>的使用，只是最大限度地降低了使用<span class="hljs-keyword">swap</span>的可能性<br></code></pre></td></tr></table></figure></li>
<li><p>案例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#说明：CentOS7和8默认值为30，内存在使用到100-30=70%的时候，就开始出现有交换分区的使用。</span><br>[root@centos8 ~]<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>30<br>[root@centos7 ~]<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>30<br>[root@centos6 ~]<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>60<br>[root@rhel5 ~]<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>60<br>root@ubuntu2004:~<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>60<br>[root@ubuntu1804 ~]<span class="hljs-comment"># cat /proc/sys/vm/swappiness</span><br>60<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-6-RAID磁盘冗余技术各种级别和实现"><a href="#4-6-RAID磁盘冗余技术各种级别和实现" class="headerlink" title="4.6. RAID磁盘冗余技术各种级别和实现"></a>4.6. RAID磁盘冗余技术各种级别和实现</h2><h3 id="4-6-1-什么是RAID"><a href="#4-6-1-什么是RAID" class="headerlink" title="4.6.1. 什么是RAID"></a>4.6.1. 什么是RAID</h3><ul>
<li><p>“RAID”一词是由David Patterson, Garth A. Gibson, Randy Katz 于1987年在加州大学伯克利分校发明的.当时性能最好的大型机不断增长的个人电脑市场开发的一系列廉价驱动器的性能所击败。尽管故障与驱动器数量的比例会上升，但通过配置冗余，阵列的可靠性可能远远超过任何大型单个驱动器的可靠性。</p>
</li>
<li><p>独立硬盘冗余阵列（RAID, Redundant Array of Independent Disks），旧称廉价磁盘冗余阵列（Redundant Array of Inexpensive Disks），简称磁盘阵列。利用虚拟化存储技术把多个硬盘组合起来，成为一个或多个硬盘阵列组，目的为提升性能或数据冗余，或是两者同时提升.</p>
</li>
<li><p>RAID 层级不同，数据会以多种模式分散于各个硬盘，RAID 层级的命名会以 RAID 开头并带数字，例如：RAID 0、RAID 1、RAID 5、RAID 6、RAID 7、RAID 01、RAID 10、RAID 50、RAID 60。每种等级都有其理论上的优缺点，不同的等级在两个目标间获取平衡，分别是增加数据可靠性以及增加存储器（群）读写性能。</p>
</li>
<li><p>RAID功能实现</p>
<ul>
<li>提高IO能力,磁盘并行读写</li>
<li>提高耐用性,磁盘冗余算法来实现</li>
</ul>
</li>
<li><p>RAID实现的方式</p>
<ul>
<li>外接式磁盘阵列：通过扩展卡提供适配能力</li>
<li>内接式RAID：主板集成RAID控制器，安装OS前在BIOS里配置</li>
<li>软件RAID：通过OS实现，比如：群晖的NAS</li>
</ul>
</li>
</ul>
<h3 id="4-6-2-RAID级别"><a href="#4-6-2-RAID级别" class="headerlink" title="4.6.2. RAID级别"></a>4.6.2. RAID级别</h3><ul>
<li><p>说明</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs subunit">RAID<span class="hljs-string">-0</span>：条带卷，strip<br>RAID<span class="hljs-string">-1</span>：镜像卷，mirror<br>RAID<span class="hljs-string">-2</span><br>......<br>RAID<span class="hljs-string">-5</span><br>RAID<span class="hljs-string">-6</span><br>RAID<span class="hljs-string">-7</span><br>RAID<span class="hljs-string">-10</span><br>RAID<span class="hljs-string">-01</span><br>RAID<span class="hljs-string">-50</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-6-2-1-RAID-0"><a href="#4-6-2-1-RAID-0" class="headerlink" title="4.6.2.1. RAID-0"></a>4.6.2.1. RAID-0</h4><ul>
<li><p>说明</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">以 chunk 单位,读写数据,因为读写时都可以并行处理，所以在所有的级别中，RAID <span class="hljs-number">0</span>的速度是最快的。但是RAID <span class="hljs-number">0</span>既没有冗余功能，也不具备容错能力，如果一个磁盘（物理）损坏，所有数据都会丢失读、写性能提升可用空间：N*min(<span class="hljs-built_in">S1</span>,<span class="hljs-built_in">S2</span>,...)无容错能力最少磁盘数：<span class="hljs-number">1</span>+<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204528987.png" srcset="/img/loading.gif" lazyload alt="image-20220808204528987"></p>
</li>
</ul>
<h4 id="RAID-1"><a href="#RAID-1" class="headerlink" title="RAID-1"></a>RAID-1</h4><ul>
<li><p>说明</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">也称为镜像, 两组以上的N个磁盘相互作镜像，在一些多线程操作系统中能有很好的读取速度，理论上读取速度等于硬盘数量的倍数，与RAID <span class="hljs-number">0</span>相同。另外写入速度有微小的降低。读性能提升、写性能略有下降可用空间：<span class="hljs-number">1</span>*min(<span class="hljs-built_in">S1</span>,<span class="hljs-built_in">S2</span>,...)、磁盘利用率、<span class="hljs-number">50</span>%有冗余能力、最少磁盘数：<span class="hljs-number">2</span>+<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204519244.png" srcset="/img/loading.gif" lazyload alt="image-20220808204519244"></p>
</li>
</ul>
<h4 id="4-6-2-2-RAID-4"><a href="#4-6-2-2-RAID-4" class="headerlink" title="4.6.2.2. RAID-4"></a>4.6.2.2. RAID-4</h4><ul>
<li><p>说明</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs excel">多块数据盘异或运算值存于专用校验盘<br>磁盘利用率 (<span class="hljs-built_in">N</span>-<span class="hljs-number">1</span>)/<span class="hljs-built_in">N</span><br>有冗余能力<br>至少<span class="hljs-number">3</span>块硬盘才可以实现<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204506716.png" srcset="/img/loading.gif" lazyload alt="image-20220808204506716"></p>
</li>
</ul>
<h4 id="4-6-2-3-RAID-5"><a href="#4-6-2-3-RAID-5" class="headerlink" title="4.6.2.3. RAID-5"></a>4.6.2.3. RAID-5</h4><ul>
<li><p>说明</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">读、写性能提升<br>可用空间：(N-<span class="hljs-number">1</span>)*<span class="hljs-built_in">min</span>(S1,S2,...)<br>有容错能力：允许最多<span class="hljs-number">1</span>块磁盘损坏<br>最少磁盘数：<span class="hljs-number">3</span>, <span class="hljs-number">3</span>+<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204455966.png" srcset="/img/loading.gif" lazyload alt="image-20220808204455966"></p>
</li>
</ul>
<h4 id="4-6-2-4-RAID-6"><a href="#4-6-2-4-RAID-6" class="headerlink" title="4.6.2.4. RAID-6"></a>4.6.2.4. RAID-6</h4><ul>
<li><p>说明</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">双份校验位,算法更复杂<br>读、写性能提升<br>可用空间：(N-<span class="hljs-number">2</span>)*<span class="hljs-built_in">min</span>(S1,S2,...)<br>有容错能力：允许最多<span class="hljs-number">2</span>块磁盘损坏<br>最少磁盘数：<span class="hljs-number">4</span>, <span class="hljs-number">4</span>+<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204332052.png" srcset="/img/loading.gif" lazyload alt="image-20220808204332052"></p>
</li>
</ul>
<h4 id="4-6-2-5-RAID-10"><a href="#4-6-2-5-RAID-10" class="headerlink" title="4.6.2.5. RAID-10"></a>4.6.2.5. RAID-10</h4><ul>
<li><p>说明</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">读、写性能提升<br>可用空间：N*min(<span class="hljs-built_in">S1</span>,<span class="hljs-built_in">S2</span>,...)/<span class="hljs-number">2</span><br>有容错能力：每组镜像最多只能坏一块<br>最少磁盘数：<span class="hljs-number">4</span>, <span class="hljs-number">4</span>+<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204444295.png" srcset="/img/loading.gif" lazyload alt="image-20220808204444295"></p>
</li>
</ul>
<h4 id="4-6-2-6-RAID-01"><a href="#4-6-2-6-RAID-01" class="headerlink" title="4.6.2.6. RAID-01"></a>4.6.2.6. RAID-01</h4><ul>
<li><p>说明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">多块磁盘先实现RAID0,再组合成RAID1<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204627603.png" srcset="/img/loading.gif" lazyload alt="image-20220808204627603"></p>
</li>
</ul>
<h4 id="4-6-2-7-RAID-50"><a href="#4-6-2-7-RAID-50" class="headerlink" title="4.6.2.7. RAID-50"></a>4.6.2.7. RAID-50</h4><ul>
<li><p>说明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">多块磁盘先实现RAID5,再组合成RAID0<br></code></pre></td></tr></table></figure></li>
<li><p>结构</p>
<p><img src="image-20220808204707557.png" srcset="/img/loading.gif" lazyload alt="image-20220808204707557"></p>
</li>
</ul>
<h4 id="4-6-2-8-RAID-60"><a href="#4-6-2-8-RAID-60" class="headerlink" title="4.6.2.8. RAID-60"></a>4.6.2.8. RAID-60</h4><ul>
<li><p>结构</p>
<p><img src="image-20220808204750255.png" srcset="/img/loading.gif" lazyload alt="image-20220808204750255"></p>
</li>
</ul>
<h3 id="4-6-3-RAID-总结"><a href="#4-6-3-RAID-总结" class="headerlink" title="4.6.3. RAID 总结"></a>4.6.3. RAID 总结</h3><ul>
<li><p>常用级别：RAID-0, RAID-1, RAID-5, RAID-10, RAID-50,RAID-60</p>
<p><img src="image-20220808204844236.png" srcset="/img/loading.gif" lazyload alt="image-20220808204844236"></p>
</li>
<li><p>磁盘阵列比较表</p>
</li>
</ul>
<p><img src="image-20220808205033306.png" srcset="/img/loading.gif" lazyload alt="image-20220808205033306"></p>
<h2 id="4-7-逻辑卷快照管理"><a href="#4-7-逻辑卷快照管理" class="headerlink" title="4.7. 逻辑卷快照管理"></a>4.7. 逻辑卷快照管理</h2><h3 id="4-7-1-逻辑卷快照原理"><a href="#4-7-1-逻辑卷快照原理" class="headerlink" title="4.7.1. 逻辑卷快照原理"></a>4.7.1. 逻辑卷快照原理</h3><ul>
<li><p>说明</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">快照是特殊的逻辑卷，它是在生成快照时存在的逻辑卷的准确拷贝,对于需要备份或者复制的现有数据临时拷贝以及其它操作来说，快照是最合适的选择,快照只有在它们和原来的逻辑卷不同时才会消耗空间，建立快照的卷大小小于等于原始逻辑卷,也可以使用lvextend扩展快照<br>逻辑卷管理器快照<br>快照就是将当时的系统信息记录下来，就好像照相一般，若将来有任何数据改动了，则原始数据会被移动到快照区，没有改动的区域则由快照区和文件系统共享<br></code></pre></td></tr></table></figure></li>
<li><p>逻辑卷快照工作原理</p>
<ul>
<li>在生成快照时会分配给它一定的空间，但只有在原来的逻辑卷或者快照有所改变才会使用这些空间</li>
<li>当原来的逻辑卷中有所改变时，会将旧的数据复制到快照中</li>
<li>快照中只含有原来的逻辑卷中更改的数据或者自生成快照后的快照中更改的数据</li>
</ul>
</li>
<li><p>快照特点</p>
<ul>
<li>备份速度快，瞬间完</li>
<li>应用场景是测试环境，不能完成代替备份</li>
<li>快照后，逻辑卷的修改速度会一定有影响</li>
</ul>
</li>
</ul>
<h3 id="4-7-2-实现逻辑卷快照"><a href="#4-7-2-实现逻辑卷快照" class="headerlink" title="4.7.2. 实现逻辑卷快照"></a>4.7.2. 实现逻辑卷快照</h3><ul>
<li><p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">mkfs.xfs /dev/vg0/data<br>mount /dev/vg0/data/ /mnt/data<br><span class="hljs-comment">#为现有逻辑卷创建快照,注意ext4建议使用-p r 实现只读</span><br>lvcreate -l 64 -s -n data-snapshot /dev/vg0/data<br><span class="hljs-comment">#挂载快照,xfs注意要使用-o ro实现只读,防止快照被修改</span><br><span class="hljs-built_in">mkdir</span> -p /mnt/snap<br>mount -o ro,nouuid /dev/vg0/data-snapshot /mnt/snap<br><span class="hljs-comment">#恢复快照</span><br>umount /dev/vg0/data-snapshot<br>umount /dev/vg0/data<br>lvconvert --merge /dev/vg0/data-snapshot<br><span class="hljs-comment">#删除快照</span><br>umount /mnt/snap<br>lvremove /dev/vg0/data-snapshot<br></code></pre></td></tr></table></figure></li>
<li></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/06/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">shell脚本编程</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/02/Jira%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">
                        <span class="hidden-mobile">Jira安装教程</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
